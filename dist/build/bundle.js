var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function r(t){t.forEach(e)}function a(t){return"function"==typeof t}function i(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function o(t,e){t.appendChild(e)}function l(t,e,n){t.insertBefore(e,n||null)}function s(t){t.parentNode.removeChild(t)}function c(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function u(t){return document.createElement(t)}function h(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function d(t){return document.createTextNode(t)}function f(){return d(" ")}function p(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function g(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function y(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function v(t,e,n,r){t.style.setProperty(e,n,r?"important":"")}function m(t,e,n){t.classList[n?"add":"remove"](e)}let x;function w(t){x=t}function k(){if(!x)throw new Error("Function called outside component initialization");return x}function b(t){k().$$.on_mount.push(t)}function _(){const t=k();return(e,n)=>{const r=t.$$.callbacks[e];if(r){const a=function(t,e){const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,e),n}(e,n);r.slice().forEach((e=>{e.call(t,a)}))}}}const $=[],M=[],A=[],N=[],E=Promise.resolve();let j=!1;function S(t){A.push(t)}let z=!1;const L=new Set;function T(){if(!z){z=!0;do{for(let t=0;t<$.length;t+=1){const e=$[t];w(e),H(e.$$)}for(w(null),$.length=0;M.length;)M.pop()();for(let t=0;t<A.length;t+=1){const e=A[t];L.has(e)||(L.add(e),e())}A.length=0}while($.length);for(;N.length;)N.pop()();j=!1,z=!1,L.clear()}}function H(t){if(null!==t.fragment){t.update(),r(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(S)}}const q=new Set;function P(t,e){t&&t.i&&(q.delete(t),t.i(e))}function C(t,e,n,r){if(t&&t.o){if(q.has(t))return;q.add(t),undefined.c.push((()=>{q.delete(t),r&&(n&&t.d(1),r())})),t.o(e)}}function B(t){t&&t.c()}function I(t,n,i){const{fragment:o,on_mount:l,on_destroy:s,after_update:c}=t.$$;o&&o.m(n,i),S((()=>{const n=l.map(e).filter(a);s?s.push(...n):r(n),t.$$.on_mount=[]})),c.forEach(S)}function W(t,e){const n=t.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function O(t,e){-1===t.$$.dirty[0]&&($.push(t),j||(j=!0,E.then(T)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function X(e,a,i,o,l,c,u=[-1]){const h=x;w(e);const d=a.props||{},f=e.$$={fragment:null,ctx:null,props:c,update:t,not_equal:l,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(h?h.$$.context:[]),callbacks:n(),dirty:u,skip_bound:!1};let p=!1;if(f.ctx=i?i(e,d,((t,n,...r)=>{const a=r.length?r[0]:n;return f.ctx&&l(f.ctx[t],f.ctx[t]=a)&&(!f.skip_bound&&f.bound[t]&&f.bound[t](a),p&&O(e,t)),n})):[],f.update(),p=!0,r(f.before_update),f.fragment=!!o&&o(f.ctx),a.target){if(a.hydrate){const t=function(t){return Array.from(t.childNodes)}(a.target);f.fragment&&f.fragment.l(t),t.forEach(s)}else f.fragment&&f.fragment.c();a.intro&&P(e.$$.fragment),I(e,a.target,a.anchor),T()}w(h)}class R{$destroy(){W(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function Y(e){let n;return{c(){n=u("div"),n.innerHTML='<div id="logo" class="svelte-1s4ld6u"><div id="logo-text" class="svelte-1s4ld6u">Dodrio</div> \n    \n    <div id="logo-tagline" class="svelte-1s4ld6u">Exploring transformer models in your browser!</div></div> \n\n  <div class="icons svelte-1s4ld6u"><a class="icon-a svelte-1s4ld6u" target="_blank" href="https://arxiv.org/abs/2004.15004"><div class="icon svelte-1s4ld6u" title="Research paper"><i class="fas fa-file-pdf svelte-1s4ld6u"></i></div></a> \n\n    <a target="_blank" href="https://youtu.be/HnWIHWFbuUQ" class="svelte-1s4ld6u"><div class="icon svelte-1s4ld6u" title="Demo video"><i class="fab fa-youtube svelte-1s4ld6u"></i></div></a> \n\n    <a target="_blank" href="https://github.com/poloclub/cnn-explainer" class="svelte-1s4ld6u"><div class="icon svelte-1s4ld6u" title="Open-source code"><i class="fab fa-github svelte-1s4ld6u"></i></div></a></div>',g(n,"id","header"),g(n,"class","svelte-1s4ld6u")},m(t,e){l(t,n,e)},p:t,i:t,o:t,d(t){t&&s(n)}}}class D extends R{constructor(t){super(),X(this,t,null,Y,i,{})}}const F=[];function U(e,n=t){let r;const a=[];function o(t){if(i(e,t)&&(e=t,r)){const t=!F.length;for(let t=0;t<a.length;t+=1){const n=a[t];n[1](),F.push(n,e)}if(t){for(let t=0;t<F.length;t+=2)F[t][0](F[t+1]);F.length=0}}}return{set:o,update:function(t){o(t(e))},subscribe:function(i,l=t){const s=[i,l];return a.push(s),1===a.length&&(r=n(o)||t),i(e),()=>{const t=a.indexOf(s);-1!==t&&a.splice(t,1),0===a.length&&(r(),r=null)}}}}const V=U({}),G=U({}),Q=U({}),K=U({}),Z=U({}),J=U({}),tt=U({show:!1,html:"",left:0,top:0,width:0,maxWidth:0,fontSize:"1em"}),et=U({inComparison:!1,height:0}),nt=U(1562),rt=U(1562),at=U(),it=U({}),ot=U({}),lt=U({show:!1,attention:null,layer:null,head:null}),st=U({show:!1,attention:null,layer:null,head:null}),ct=U({show:!1,attention:null,layer:null,head:null}),ut=U({layer:9,head:8});function ht(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function dt(t){let e=t,n=t;function r(t,e,r,a){for(null==r&&(r=0),null==a&&(a=t.length);r<a;){const i=r+a>>>1;n(t[i],e)<0?r=i+1:a=i}return r}return 1===t.length&&(e=(e,n)=>t(e)-n,n=function(t){return(e,n)=>ht(t(e),n)}(t)),{left:r,center:function(t,n,a,i){null==a&&(a=0),null==i&&(i=t.length);const o=r(t,n,a,i-1);return o>a&&e(t[o-1],n)>-e(t[o],n)?o-1:o},right:function(t,e,r,a){for(null==r&&(r=0),null==a&&(a=t.length);r<a;){const i=r+a>>>1;n(t[i],e)>0?a=i:r=i+1}return r}}}const ft=dt(ht).right;dt((function(t){return null===t?NaN:+t})).center;function pt(t,e){let n,r;if(void 0===e)for(const e of t)null!=e&&(void 0===n?e>=e&&(n=r=e):(n>e&&(n=e),r<e&&(r=e)));else{let a=-1;for(let i of t)null!=(i=e(i,++a,t))&&(void 0===n?i>=i&&(n=r=i):(n>i&&(n=i),r<i&&(r=i)))}return[n,r]}var gt=Math.sqrt(50),yt=Math.sqrt(10),vt=Math.sqrt(2);function mt(t,e,n){var r=(e-t)/Math.max(0,n),a=Math.floor(Math.log(r)/Math.LN10),i=r/Math.pow(10,a);return a>=0?(i>=gt?10:i>=yt?5:i>=vt?2:1)*Math.pow(10,a):-Math.pow(10,-a)/(i>=gt?10:i>=yt?5:i>=vt?2:1)}function xt(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n<e||void 0===n&&e>=e)&&(n=e);else{let r=-1;for(let a of t)null!=(a=e(a,++r,t))&&(n<a||void 0===n&&a>=a)&&(n=a)}return n}var wt=Array.prototype.slice;function kt(t){return t}var bt=1e-6;function _t(t){return"translate("+(t+.5)+",0)"}function $t(t){return"translate(0,"+(t+.5)+")"}function Mt(t){return e=>+t(e)}function At(t){var e=Math.max(0,t.bandwidth()-1)/2;return t.round()&&(e=Math.round(e)),function(n){return+t(n)+e}}function Nt(){return!this.__axis}function Et(t,e){var n=[],r=null,a=null,i=6,o=6,l=3,s=1===t||4===t?-1:1,c=4===t||2===t?"x":"y",u=1===t||3===t?_t:$t;function h(h){var d=null==r?e.ticks?e.ticks.apply(e,n):e.domain():r,f=null==a?e.tickFormat?e.tickFormat.apply(e,n):kt:a,p=Math.max(i,0)+l,g=e.range(),y=+g[0]+.5,v=+g[g.length-1]+.5,m=(e.bandwidth?At:Mt)(e.copy()),x=h.selection?h.selection():h,w=x.selectAll(".domain").data([null]),k=x.selectAll(".tick").data(d,e).order(),b=k.exit(),_=k.enter().append("g").attr("class","tick"),$=k.select("line"),M=k.select("text");w=w.merge(w.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),k=k.merge(_),$=$.merge(_.append("line").attr("stroke","currentColor").attr(c+"2",s*i)),M=M.merge(_.append("text").attr("fill","currentColor").attr(c,s*p).attr("dy",1===t?"0em":3===t?"0.71em":"0.32em")),h!==x&&(w=w.transition(h),k=k.transition(h),$=$.transition(h),M=M.transition(h),b=b.transition(h).attr("opacity",bt).attr("transform",(function(t){return isFinite(t=m(t))?u(t):this.getAttribute("transform")})),_.attr("opacity",bt).attr("transform",(function(t){var e=this.parentNode.__axis;return u(e&&isFinite(e=e(t))?e:m(t))}))),b.remove(),w.attr("d",4===t||2==t?o?"M"+s*o+","+y+"H0.5V"+v+"H"+s*o:"M0.5,"+y+"V"+v:o?"M"+y+","+s*o+"V0.5H"+v+"V"+s*o:"M"+y+",0.5H"+v),k.attr("opacity",1).attr("transform",(function(t){return u(m(t))})),$.attr(c+"2",s*i),M.attr(c,s*p).text(f),x.filter(Nt).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",2===t?"start":4===t?"end":"middle"),x.each((function(){this.__axis=m}))}return h.scale=function(t){return arguments.length?(e=t,h):e},h.ticks=function(){return n=wt.call(arguments),h},h.tickArguments=function(t){return arguments.length?(n=null==t?[]:wt.call(t),h):n.slice()},h.tickValues=function(t){return arguments.length?(r=null==t?null:wt.call(t),h):r&&r.slice()},h.tickFormat=function(t){return arguments.length?(a=t,h):a},h.tickSize=function(t){return arguments.length?(i=o=+t,h):i},h.tickSizeInner=function(t){return arguments.length?(i=+t,h):i},h.tickSizeOuter=function(t){return arguments.length?(o=+t,h):o},h.tickPadding=function(t){return arguments.length?(l=+t,h):l},h}function jt(t){return Et(2,t)}var St={value:()=>{}};function zt(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r||/[\s.]/.test(t))throw new Error("illegal type: "+t);r[t]=[]}return new Lt(r)}function Lt(t){this._=t}function Tt(t,e){return t.trim().split(/^|\s+/).map((function(t){var n="",r=t.indexOf(".");if(r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}}))}function Ht(t,e){for(var n,r=0,a=t.length;r<a;++r)if((n=t[r]).name===e)return n.value}function qt(t,e,n){for(var r=0,a=t.length;r<a;++r)if(t[r].name===e){t[r]=St,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}Lt.prototype=zt.prototype={constructor:Lt,on:function(t,e){var n,r=this._,a=Tt(t+"",r),i=-1,o=a.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++i<o;)if(n=(t=a[i]).type)r[n]=qt(r[n],t.name,e);else if(null==e)for(n in r)r[n]=qt(r[n],t.name,null);return this}for(;++i<o;)if((n=(t=a[i]).type)&&(n=Ht(r[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Lt(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,a=new Array(n),i=0;i<n;++i)a[i]=arguments[i+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(i=0,n=(r=this._[t]).length;i<n;++i)r[i].value.apply(e,a)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],a=0,i=r.length;a<i;++a)r[a].value.apply(e,n)}};var Pt="http://www.w3.org/1999/xhtml",Ct={svg:"http://www.w3.org/2000/svg",xhtml:Pt,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Bt(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),Ct.hasOwnProperty(e)?{space:Ct[e],local:t}:t}function It(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===Pt&&e.documentElement.namespaceURI===Pt?e.createElement(t):e.createElementNS(n,t)}}function Wt(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Ot(t){var e=Bt(t);return(e.local?Wt:It)(e)}function Xt(){}function Rt(t){return null==t?Xt:function(){return this.querySelector(t)}}function Yt(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function Dt(){return[]}function Ft(t){return null==t?Dt:function(){return this.querySelectorAll(t)}}function Ut(t){return function(){return this.matches(t)}}function Vt(t){return function(e){return e.matches(t)}}var Gt=Array.prototype.find;function Qt(){return this.firstElementChild}var Kt=Array.prototype.filter;function Zt(){return this.children}function Jt(t){return new Array(t.length)}function te(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function ee(t){return function(){return t}}function ne(t,e,n,r,a,i){for(var o,l=0,s=e.length,c=i.length;l<c;++l)(o=e[l])?(o.__data__=i[l],r[l]=o):n[l]=new te(t,i[l]);for(;l<s;++l)(o=e[l])&&(a[l]=o)}function re(t,e,n,r,a,i,o){var l,s,c,u=new Map,h=e.length,d=i.length,f=new Array(h);for(l=0;l<h;++l)(s=e[l])&&(f[l]=c=o.call(s,s.__data__,l,e)+"",u.has(c)?a[l]=s:u.set(c,s));for(l=0;l<d;++l)c=o.call(t,i[l],l,i)+"",(s=u.get(c))?(r[l]=s,s.__data__=i[l],u.delete(c)):n[l]=new te(t,i[l]);for(l=0;l<h;++l)(s=e[l])&&u.get(f[l])===s&&(a[l]=s)}function ae(t){return t.__data__}function ie(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function oe(t){return function(){this.removeAttribute(t)}}function le(t){return function(){this.removeAttributeNS(t.space,t.local)}}function se(t,e){return function(){this.setAttribute(t,e)}}function ce(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function ue(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function he(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function de(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function fe(t){return function(){this.style.removeProperty(t)}}function pe(t,e,n){return function(){this.style.setProperty(t,e,n)}}function ge(t,e,n){return function(){var r=e.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function ye(t,e){return t.style.getPropertyValue(e)||de(t).getComputedStyle(t,null).getPropertyValue(e)}function ve(t){return function(){delete this[t]}}function me(t,e){return function(){this[t]=e}}function xe(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function we(t){return t.trim().split(/^|\s+/)}function ke(t){return t.classList||new be(t)}function be(t){this._node=t,this._names=we(t.getAttribute("class")||"")}function _e(t,e){for(var n=ke(t),r=-1,a=e.length;++r<a;)n.add(e[r])}function $e(t,e){for(var n=ke(t),r=-1,a=e.length;++r<a;)n.remove(e[r])}function Me(t){return function(){_e(this,t)}}function Ae(t){return function(){$e(this,t)}}function Ne(t,e){return function(){(e.apply(this,arguments)?_e:$e)(this,t)}}function Ee(){this.textContent=""}function je(t){return function(){this.textContent=t}}function Se(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function ze(){this.innerHTML=""}function Le(t){return function(){this.innerHTML=t}}function Te(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function He(){this.nextSibling&&this.parentNode.appendChild(this)}function qe(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Pe(){return null}function Ce(){var t=this.parentNode;t&&t.removeChild(this)}function Be(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Ie(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function We(t){return t.trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}}))}function Oe(t){return function(){var e=this.__on;if(e){for(var n,r=0,a=-1,i=e.length;r<i;++r)n=e[r],t.type&&n.type!==t.type||n.name!==t.name?e[++a]=n:this.removeEventListener(n.type,n.listener,n.options);++a?e.length=a:delete this.__on}}}function Xe(t,e,n){return function(){var r,a=this.__on,i=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(a)for(var o=0,l=a.length;o<l;++o)if((r=a[o]).type===t.type&&r.name===t.name)return this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=i,r.options=n),void(r.value=e);this.addEventListener(t.type,i,n),r={type:t.type,name:t.name,value:e,listener:i,options:n},a?a.push(r):this.__on=[r]}}function Re(t,e,n){var r=de(t),a=r.CustomEvent;"function"==typeof a?a=new a(e,n):(a=r.document.createEvent("Event"),n?(a.initEvent(e,n.bubbles,n.cancelable),a.detail=n.detail):a.initEvent(e,!1,!1)),t.dispatchEvent(a)}function Ye(t,e){return function(){return Re(this,t,e)}}function De(t,e){return function(){return Re(this,t,e.apply(this,arguments))}}te.prototype={constructor:te,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}},be.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var Fe=[null];function Ue(t,e){this._groups=t,this._parents=e}function Ve(){return new Ue([[document.documentElement]],Fe)}function Ge(t){return"string"==typeof t?new Ue([[document.querySelector(t)]],[document.documentElement]):new Ue([[t]],Fe)}function Qe(t,e){if(t=function(t){let e;for(;e=t.sourceEvent;)t=e;return t}(t),void 0===e&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,[(r=r.matrixTransform(e.getScreenCTM().inverse())).x,r.y]}if(e.getBoundingClientRect){var a=e.getBoundingClientRect();return[t.clientX-a.left-e.clientLeft,t.clientY-a.top-e.clientTop]}}return[t.pageX,t.pageY]}function Ke(t){return"string"==typeof t?new Ue([document.querySelectorAll(t)],[document.documentElement]):new Ue([null==t?[]:Yt(t)],Fe)}function Ze(t){t.stopImmediatePropagation()}function Je(t){t.preventDefault(),t.stopImmediatePropagation()}function tn(t){var e=t.document.documentElement,n=Ge(t).on("dragstart.drag",Je,!0);"onselectstart"in e?n.on("selectstart.drag",Je,!0):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function en(t,e){var n=t.document.documentElement,r=Ge(t).on("dragstart.drag",null);e&&(r.on("click.drag",Je,!0),setTimeout((function(){r.on("click.drag",null)}),0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}Ue.prototype=Ve.prototype={constructor:Ue,select:function(t){"function"!=typeof t&&(t=Rt(t));for(var e=this._groups,n=e.length,r=new Array(n),a=0;a<n;++a)for(var i,o,l=e[a],s=l.length,c=r[a]=new Array(s),u=0;u<s;++u)(i=l[u])&&(o=t.call(i,i.__data__,u,l))&&("__data__"in i&&(o.__data__=i.__data__),c[u]=o);return new Ue(r,this._parents)},selectAll:function(t){t="function"==typeof t?function(t){return function(){var e=t.apply(this,arguments);return null==e?[]:Yt(e)}}(t):Ft(t);for(var e=this._groups,n=e.length,r=[],a=[],i=0;i<n;++i)for(var o,l=e[i],s=l.length,c=0;c<s;++c)(o=l[c])&&(r.push(t.call(o,o.__data__,c,l)),a.push(o));return new Ue(r,a)},selectChild:function(t){return this.select(null==t?Qt:function(t){return function(){return Gt.call(this.children,t)}}("function"==typeof t?t:Vt(t)))},selectChildren:function(t){return this.selectAll(null==t?Zt:function(t){return function(){return Kt.call(this.children,t)}}("function"==typeof t?t:Vt(t)))},filter:function(t){"function"!=typeof t&&(t=Ut(t));for(var e=this._groups,n=e.length,r=new Array(n),a=0;a<n;++a)for(var i,o=e[a],l=o.length,s=r[a]=[],c=0;c<l;++c)(i=o[c])&&t.call(i,i.__data__,c,o)&&s.push(i);return new Ue(r,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,ae);var n=e?re:ne,r=this._parents,a=this._groups;"function"!=typeof t&&(t=ee(t));for(var i=a.length,o=new Array(i),l=new Array(i),s=new Array(i),c=0;c<i;++c){var u=r[c],h=a[c],d=h.length,f=Yt(t.call(u,u&&u.__data__,c,r)),p=f.length,g=l[c]=new Array(p),y=o[c]=new Array(p),v=s[c]=new Array(d);n(u,h,g,y,v,f,e);for(var m,x,w=0,k=0;w<p;++w)if(m=g[w]){for(w>=k&&(k=w+1);!(x=y[k])&&++k<p;);m._next=x||null}}return(o=new Ue(o,r))._enter=l,o._exit=s,o},enter:function(){return new Ue(this._enter||this._groups.map(Jt),this._parents)},exit:function(){return new Ue(this._exit||this._groups.map(Jt),this._parents)},join:function(t,e,n){var r=this.enter(),a=this,i=this.exit();return r="function"==typeof t?t(r):r.append(t+""),null!=e&&(a=e(a)),null==n?i.remove():n(i),r&&a?r.merge(a).order():a},merge:function(t){if(!(t instanceof Ue))throw new Error("invalid merge");for(var e=this._groups,n=t._groups,r=e.length,a=n.length,i=Math.min(r,a),o=new Array(r),l=0;l<i;++l)for(var s,c=e[l],u=n[l],h=c.length,d=o[l]=new Array(h),f=0;f<h;++f)(s=c[f]||u[f])&&(d[f]=s);for(;l<r;++l)o[l]=e[l];return new Ue(o,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r,a=t[e],i=a.length-1,o=a[i];--i>=0;)(r=a[i])&&(o&&4^r.compareDocumentPosition(o)&&o.parentNode.insertBefore(r,o),o=r);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=ie);for(var n=this._groups,r=n.length,a=new Array(r),i=0;i<r;++i){for(var o,l=n[i],s=l.length,c=a[i]=new Array(s),u=0;u<s;++u)(o=l[u])&&(c[u]=o);c.sort(e)}return new Ue(a,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],a=0,i=r.length;a<i;++a){var o=r[a];if(o)return o}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var a,i=e[n],o=0,l=i.length;o<l;++o)(a=i[o])&&t.call(a,a.__data__,o,i);return this},attr:function(t,e){var n=Bt(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==e?n.local?le:oe:"function"==typeof e?n.local?he:ue:n.local?ce:se)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?fe:"function"==typeof e?ge:pe)(t,e,null==n?"":n)):ye(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?ve:"function"==typeof e?xe:me)(t,e)):this.node()[t]},classed:function(t,e){var n=we(t+"");if(arguments.length<2){for(var r=ke(this.node()),a=-1,i=n.length;++a<i;)if(!r.contains(n[a]))return!1;return!0}return this.each(("function"==typeof e?Ne:e?Me:Ae)(n,e))},text:function(t){return arguments.length?this.each(null==t?Ee:("function"==typeof t?Se:je)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?ze:("function"==typeof t?Te:Le)(t)):this.node().innerHTML},raise:function(){return this.each(He)},lower:function(){return this.each(qe)},append:function(t){var e="function"==typeof t?t:Ot(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var n="function"==typeof t?t:Ot(t),r=null==e?Pe:"function"==typeof e?e:Rt(e);return this.select((function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)}))},remove:function(){return this.each(Ce)},clone:function(t){return this.select(t?Ie:Be)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var r,a,i=We(t+""),o=i.length;if(!(arguments.length<2)){for(l=e?Xe:Oe,r=0;r<o;++r)this.each(l(i[r],e,n));return this}var l=this.node().__on;if(l)for(var s,c=0,u=l.length;c<u;++c)for(r=0,s=l[c];r<o;++r)if((a=i[r]).type===s.type&&a.name===s.name)return s.value},dispatch:function(t,e){return this.each(("function"==typeof e?De:Ye)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r,a=t[e],i=0,o=a.length;i<o;++i)(r=a[i])&&(yield r)}};var nn=t=>()=>t;function rn(t,{sourceEvent:e,subject:n,target:r,identifier:a,active:i,x:o,y:l,dx:s,dy:c,dispatch:u}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:a,enumerable:!0,configurable:!0},active:{value:i,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:l,enumerable:!0,configurable:!0},dx:{value:s,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:u}})}function an(t){return!t.ctrlKey&&!t.button}function on(){return this.parentNode}function ln(t,e){return null==e?{x:t.x,y:t.y}:e}function sn(){return navigator.maxTouchPoints||"ontouchstart"in this}function cn(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function un(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function hn(){}rn.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};var dn=.7,fn=1/dn,pn="\\s*([+-]?\\d+)\\s*",gn="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",yn="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",vn=/^#([0-9a-f]{3,8})$/,mn=new RegExp("^rgb\\("+[pn,pn,pn]+"\\)$"),xn=new RegExp("^rgb\\("+[yn,yn,yn]+"\\)$"),wn=new RegExp("^rgba\\("+[pn,pn,pn,gn]+"\\)$"),kn=new RegExp("^rgba\\("+[yn,yn,yn,gn]+"\\)$"),bn=new RegExp("^hsl\\("+[gn,yn,yn]+"\\)$"),_n=new RegExp("^hsla\\("+[gn,yn,yn,gn]+"\\)$"),$n={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Mn(){return this.rgb().formatHex()}function An(){return this.rgb().formatRgb()}function Nn(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=vn.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?En(e):3===n?new Ln(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?jn(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?jn(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=mn.exec(t))?new Ln(e[1],e[2],e[3],1):(e=xn.exec(t))?new Ln(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=wn.exec(t))?jn(e[1],e[2],e[3],e[4]):(e=kn.exec(t))?jn(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=bn.exec(t))?Pn(e[1],e[2]/100,e[3]/100,1):(e=_n.exec(t))?Pn(e[1],e[2]/100,e[3]/100,e[4]):$n.hasOwnProperty(t)?En($n[t]):"transparent"===t?new Ln(NaN,NaN,NaN,0):null}function En(t){return new Ln(t>>16&255,t>>8&255,255&t,1)}function jn(t,e,n,r){return r<=0&&(t=e=n=NaN),new Ln(t,e,n,r)}function Sn(t){return t instanceof hn||(t=Nn(t)),t?new Ln((t=t.rgb()).r,t.g,t.b,t.opacity):new Ln}function zn(t,e,n,r){return 1===arguments.length?Sn(t):new Ln(t,e,n,null==r?1:r)}function Ln(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function Tn(){return"#"+qn(this.r)+qn(this.g)+qn(this.b)}function Hn(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function qn(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function Pn(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Bn(t,e,n,r)}function Cn(t){if(t instanceof Bn)return new Bn(t.h,t.s,t.l,t.opacity);if(t instanceof hn||(t=Nn(t)),!t)return new Bn;if(t instanceof Bn)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,a=Math.min(e,n,r),i=Math.max(e,n,r),o=NaN,l=i-a,s=(i+a)/2;return l?(o=e===i?(n-r)/l+6*(n<r):n===i?(r-e)/l+2:(e-n)/l+4,l/=s<.5?i+a:2-i-a,o*=60):l=s>0&&s<1?0:o,new Bn(o,l,s,t.opacity)}function Bn(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function In(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}cn(hn,Nn,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:Mn,formatHex:Mn,formatHsl:function(){return Cn(this).formatHsl()},formatRgb:An,toString:An}),cn(Ln,zn,un(hn,{brighter:function(t){return t=null==t?fn:Math.pow(fn,t),new Ln(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?dn:Math.pow(dn,t),new Ln(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Tn,formatHex:Tn,formatRgb:Hn,toString:Hn})),cn(Bn,(function(t,e,n,r){return 1===arguments.length?Cn(t):new Bn(t,e,n,null==r?1:r)}),un(hn,{brighter:function(t){return t=null==t?fn:Math.pow(fn,t),new Bn(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?dn:Math.pow(dn,t),new Bn(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,a=2*n-r;return new Ln(In(t>=240?t-240:t+120,a,r),In(t,a,r),In(t<120?t+240:t-120,a,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}));const Wn=Math.PI/180,On=180/Math.PI,Xn=.96422,Rn=.82521,Yn=4/29,Dn=6/29,Fn=3*Dn*Dn;function Un(t){if(t instanceof Vn)return new Vn(t.l,t.a,t.b,t.opacity);if(t instanceof er)return nr(t);t instanceof Ln||(t=Sn(t));var e,n,r=Zn(t.r),a=Zn(t.g),i=Zn(t.b),o=Gn((.2225045*r+.7168786*a+.0606169*i)/1);return r===a&&a===i?e=n=o:(e=Gn((.4360747*r+.3850649*a+.1430804*i)/Xn),n=Gn((.0139322*r+.0971045*a+.7141733*i)/Rn)),new Vn(116*o-16,500*(e-o),200*(o-n),t.opacity)}function Vn(t,e,n,r){this.l=+t,this.a=+e,this.b=+n,this.opacity=+r}function Gn(t){return t>.008856451679035631?Math.pow(t,1/3):t/Fn+Yn}function Qn(t){return t>Dn?t*t*t:Fn*(t-Yn)}function Kn(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Zn(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Jn(t){if(t instanceof er)return new er(t.h,t.c,t.l,t.opacity);if(t instanceof Vn||(t=Un(t)),0===t.a&&0===t.b)return new er(NaN,0<t.l&&t.l<100?0:NaN,t.l,t.opacity);var e=Math.atan2(t.b,t.a)*On;return new er(e<0?e+360:e,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}function tr(t,e,n,r){return 1===arguments.length?Jn(t):new er(t,e,n,null==r?1:r)}function er(t,e,n,r){this.h=+t,this.c=+e,this.l=+n,this.opacity=+r}function nr(t){if(isNaN(t.h))return new Vn(t.l,0,0,t.opacity);var e=t.h*Wn;return new Vn(t.l,Math.cos(e)*t.c,Math.sin(e)*t.c,t.opacity)}cn(Vn,(function(t,e,n,r){return 1===arguments.length?Un(t):new Vn(t,e,n,null==r?1:r)}),un(hn,{brighter:function(t){return new Vn(this.l+18*(null==t?1:t),this.a,this.b,this.opacity)},darker:function(t){return new Vn(this.l-18*(null==t?1:t),this.a,this.b,this.opacity)},rgb:function(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,n=isNaN(this.b)?t:t-this.b/200;return new Ln(Kn(3.1338561*(e=Xn*Qn(e))-1.6168667*(t=1*Qn(t))-.4906146*(n=Rn*Qn(n))),Kn(-.9787684*e+1.9161415*t+.033454*n),Kn(.0719453*e-.2289914*t+1.4052427*n),this.opacity)}})),cn(er,tr,un(hn,{brighter:function(t){return new er(this.h,this.c,this.l+18*(null==t?1:t),this.opacity)},darker:function(t){return new er(this.h,this.c,this.l-18*(null==t?1:t),this.opacity)},rgb:function(){return nr(this).rgb()}}));var rr=t=>()=>t;function ar(t){return 1==(t=+t)?ir:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}(e,n,t):rr(isNaN(e)?n:e)}}function ir(t,e){var n=e-t;return n?function(t,e){return function(n){return t+n*e}}(t,n):rr(isNaN(t)?e:t)}var or=function t(e){var n=ar(e);function r(t,e){var r=n((t=zn(t)).r,(e=zn(e)).r),a=n(t.g,e.g),i=n(t.b,e.b),o=ir(t.opacity,e.opacity);return function(e){return t.r=r(e),t.g=a(e),t.b=i(e),t.opacity=o(e),t+""}}return r.gamma=t,r}(1);function lr(t,e){e||(e=[]);var n,r=t?Math.min(e.length,t.length):0,a=e.slice();return function(i){for(n=0;n<r;++n)a[n]=t[n]*(1-i)+e[n]*i;return a}}function sr(t,e){var n,r=e?e.length:0,a=t?Math.min(r,t.length):0,i=new Array(a),o=new Array(r);for(n=0;n<a;++n)i[n]=gr(t[n],e[n]);for(;n<r;++n)o[n]=e[n];return function(t){for(n=0;n<a;++n)o[n]=i[n](t);return o}}function cr(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function ur(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function hr(t,e){var n,r={},a={};for(n in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)n in t?r[n]=gr(t[n],e[n]):a[n]=e[n];return function(t){for(n in r)a[n]=r[n](t);return a}}var dr=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,fr=new RegExp(dr.source,"g");function pr(t,e){var n,r,a,i=dr.lastIndex=fr.lastIndex=0,o=-1,l=[],s=[];for(t+="",e+="";(n=dr.exec(t))&&(r=fr.exec(e));)(a=r.index)>i&&(a=e.slice(i,a),l[o]?l[o]+=a:l[++o]=a),(n=n[0])===(r=r[0])?l[o]?l[o]+=r:l[++o]=r:(l[++o]=null,s.push({i:o,x:ur(n,r)})),i=fr.lastIndex;return i<e.length&&(a=e.slice(i),l[o]?l[o]+=a:l[++o]=a),l.length<2?s[0]?function(t){return function(e){return t(e)+""}}(s[0].x):function(t){return function(){return t}}(e):(e=s.length,function(t){for(var n,r=0;r<e;++r)l[(n=s[r]).i]=n.x(t);return l.join("")})}function gr(t,e){var n,r=typeof e;return null==e||"boolean"===r?rr(e):("number"===r?ur:"string"===r?(n=Nn(e))?(e=n,or):pr:e instanceof Nn?or:e instanceof Date?cr:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}(e)?lr:Array.isArray(e)?sr:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?hr:ur)(t,e)}function yr(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var vr,mr=180/Math.PI,xr={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function wr(t,e,n,r,a,i){var o,l,s;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(s=t*n+e*r)&&(n-=t*s,r-=e*s),(l=Math.sqrt(n*n+r*r))&&(n/=l,r/=l,s/=l),t*r<e*n&&(t=-t,e=-e,s=-s,o=-o),{translateX:a,translateY:i,rotate:Math.atan2(e,t)*mr,skewX:Math.atan(s)*mr,scaleX:o,scaleY:l}}function kr(t,e,n,r){function a(t){return t.length?t.pop()+" ":""}return function(i,o){var l=[],s=[];return i=t(i),o=t(o),function(t,r,a,i,o,l){if(t!==a||r!==i){var s=o.push("translate(",null,e,null,n);l.push({i:s-4,x:ur(t,a)},{i:s-2,x:ur(r,i)})}else(a||i)&&o.push("translate("+a+e+i+n)}(i.translateX,i.translateY,o.translateX,o.translateY,l,s),function(t,e,n,i){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),i.push({i:n.push(a(n)+"rotate(",null,r)-2,x:ur(t,e)})):e&&n.push(a(n)+"rotate("+e+r)}(i.rotate,o.rotate,l,s),function(t,e,n,i){t!==e?i.push({i:n.push(a(n)+"skewX(",null,r)-2,x:ur(t,e)}):e&&n.push(a(n)+"skewX("+e+r)}(i.skewX,o.skewX,l,s),function(t,e,n,r,i,o){if(t!==n||e!==r){var l=i.push(a(i)+"scale(",null,",",null,")");o.push({i:l-4,x:ur(t,n)},{i:l-2,x:ur(e,r)})}else 1===n&&1===r||i.push(a(i)+"scale("+n+","+r+")")}(i.scaleX,i.scaleY,o.scaleX,o.scaleY,l,s),i=o=null,function(t){for(var e,n=-1,r=s.length;++n<r;)l[(e=s[n]).i]=e.x(t);return l.join("")}}}var br=kr((function(t){const e=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?xr:wr(e.a,e.b,e.c,e.d,e.e,e.f)}),"px, ","px)","deg)"),_r=kr((function(t){return null==t?xr:(vr||(vr=document.createElementNS("http://www.w3.org/2000/svg","g")),vr.setAttribute("transform",t),(t=vr.transform.baseVal.consolidate())?wr((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):xr)}),", ",")",")");function $r(t){return((t=Math.exp(t))+1/t)/2}var Mr,Ar,Nr=function t(e,n,r){function a(t,a){var i,o,l=t[0],s=t[1],c=t[2],u=a[0],h=a[1],d=a[2],f=u-l,p=h-s,g=f*f+p*p;if(g<1e-12)o=Math.log(d/c)/e,i=function(t){return[l+t*f,s+t*p,c*Math.exp(e*t*o)]};else{var y=Math.sqrt(g),v=(d*d-c*c+r*g)/(2*c*n*y),m=(d*d-c*c-r*g)/(2*d*n*y),x=Math.log(Math.sqrt(v*v+1)-v),w=Math.log(Math.sqrt(m*m+1)-m);o=(w-x)/e,i=function(t){var r=t*o,a=$r(x),i=c/(n*y)*(a*function(t){return((t=Math.exp(2*t))-1)/(t+1)}(e*r+x)-function(t){return((t=Math.exp(t))-1/t)/2}(x));return[l+i*f,s+i*p,c*a/$r(e*r+x)]}}return i.duration=1e3*o*e/Math.SQRT2,i}return a.rho=function(e){var n=Math.max(.001,+e),r=n*n;return t(n,r,r*r)},a}(Math.SQRT2,2,4),Er=0,jr=0,Sr=0,zr=0,Lr=0,Tr=0,Hr="object"==typeof performance&&performance.now?performance:Date,qr="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Pr(){return Lr||(qr(Cr),Lr=Hr.now()+Tr)}function Cr(){Lr=0}function Br(){this._call=this._time=this._next=null}function Ir(t,e,n){var r=new Br;return r.restart(t,e,n),r}function Wr(){Lr=(zr=Hr.now())+Tr,Er=jr=0;try{!function(){Pr(),++Er;for(var t,e=Mr;e;)(t=Lr-e._time)>=0&&e._call.call(null,t),e=e._next;--Er}()}finally{Er=0,function(){var t,e,n=Mr,r=1/0;for(;n;)n._call?(r>n._time&&(r=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:Mr=e);Ar=t,Xr(r)}(),Lr=0}}function Or(){var t=Hr.now(),e=t-zr;e>1e3&&(Tr-=e,zr=t)}function Xr(t){Er||(jr&&(jr=clearTimeout(jr)),t-Lr>24?(t<1/0&&(jr=setTimeout(Wr,t-Hr.now()-Tr)),Sr&&(Sr=clearInterval(Sr))):(Sr||(zr=Hr.now(),Sr=setInterval(Or,1e3)),Er=1,qr(Wr)))}function Rr(t,e,n){var r=new Br;return e=null==e?0:+e,r.restart((n=>{r.stop(),t(n+e)}),e,n),r}Br.prototype=Ir.prototype={constructor:Br,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?Pr():+n)+(null==e?0:+e),this._next||Ar===this||(Ar?Ar._next=this:Mr=this,Ar=this),this._call=t,this._time=n,Xr()},stop:function(){this._call&&(this._call=null,this._time=1/0,Xr())}};var Yr=zt("start","end","cancel","interrupt"),Dr=[];function Fr(t,e,n,r,a,i){var o=t.__transition;if(o){if(n in o)return}else t.__transition={};!function(t,e,n){var r,a=t.__transition;function i(t){n.state=1,n.timer.restart(o,n.delay,n.time),n.delay<=t&&o(t-n.delay)}function o(i){var c,u,h,d;if(1!==n.state)return s();for(c in a)if((d=a[c]).name===n.name){if(3===d.state)return Rr(o);4===d.state?(d.state=6,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete a[c]):+c<e&&(d.state=6,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete a[c])}if(Rr((function(){3===n.state&&(n.state=4,n.timer.restart(l,n.delay,n.time),l(i))})),n.state=2,n.on.call("start",t,t.__data__,n.index,n.group),2===n.state){for(n.state=3,r=new Array(h=n.tween.length),c=0,u=-1;c<h;++c)(d=n.tween[c].value.call(t,t.__data__,n.index,n.group))&&(r[++u]=d);r.length=u+1}}function l(e){for(var a=e<n.duration?n.ease.call(null,e/n.duration):(n.timer.restart(s),n.state=5,1),i=-1,o=r.length;++i<o;)r[i].call(t,a);5===n.state&&(n.on.call("end",t,t.__data__,n.index,n.group),s())}function s(){for(var r in n.state=6,n.timer.stop(),delete a[e],a)return;delete t.__transition}a[e]=n,n.timer=Ir(i,0,n.time)}(t,n,{name:e,index:r,group:a,on:Yr,tween:Dr,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:0})}function Ur(t,e){var n=Gr(t,e);if(n.state>0)throw new Error("too late; already scheduled");return n}function Vr(t,e){var n=Gr(t,e);if(n.state>3)throw new Error("too late; already running");return n}function Gr(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function Qr(t,e){var n,r,a,i=t.__transition,o=!0;if(i){for(a in e=null==e?null:e+"",i)(n=i[a]).name===e?(r=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(r?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete i[a]):o=!1;o&&delete t.__transition}}function Kr(t,e){var n,r;return function(){var a=Vr(this,t),i=a.tween;if(i!==n)for(var o=0,l=(r=n=i).length;o<l;++o)if(r[o].name===e){(r=r.slice()).splice(o,1);break}a.tween=r}}function Zr(t,e,n){var r,a;if("function"!=typeof n)throw new Error;return function(){var i=Vr(this,t),o=i.tween;if(o!==r){a=(r=o).slice();for(var l={name:e,value:n},s=0,c=a.length;s<c;++s)if(a[s].name===e){a[s]=l;break}s===c&&a.push(l)}i.tween=a}}function Jr(t,e,n){var r=t._id;return t.each((function(){var t=Vr(this,r);(t.value||(t.value={}))[e]=n.apply(this,arguments)})),function(t){return Gr(t,r).value[e]}}function ta(t,e){var n;return("number"==typeof e?ur:e instanceof Nn?or:(n=Nn(e))?(e=n,or):pr)(t,e)}function ea(t){return function(){this.removeAttribute(t)}}function na(t){return function(){this.removeAttributeNS(t.space,t.local)}}function ra(t,e,n){var r,a,i=n+"";return function(){var o=this.getAttribute(t);return o===i?null:o===r?a:a=e(r=o,n)}}function aa(t,e,n){var r,a,i=n+"";return function(){var o=this.getAttributeNS(t.space,t.local);return o===i?null:o===r?a:a=e(r=o,n)}}function ia(t,e,n){var r,a,i;return function(){var o,l,s=n(this);if(null!=s)return(o=this.getAttribute(t))===(l=s+"")?null:o===r&&l===a?i:(a=l,i=e(r=o,s));this.removeAttribute(t)}}function oa(t,e,n){var r,a,i;return function(){var o,l,s=n(this);if(null!=s)return(o=this.getAttributeNS(t.space,t.local))===(l=s+"")?null:o===r&&l===a?i:(a=l,i=e(r=o,s));this.removeAttributeNS(t.space,t.local)}}function la(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function sa(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function ca(t,e){var n,r;function a(){var a=e.apply(this,arguments);return a!==r&&(n=(r=a)&&sa(t,a)),n}return a._value=e,a}function ua(t,e){var n,r;function a(){var a=e.apply(this,arguments);return a!==r&&(n=(r=a)&&la(t,a)),n}return a._value=e,a}function ha(t,e){return function(){Ur(this,t).delay=+e.apply(this,arguments)}}function da(t,e){return e=+e,function(){Ur(this,t).delay=e}}function fa(t,e){return function(){Vr(this,t).duration=+e.apply(this,arguments)}}function pa(t,e){return e=+e,function(){Vr(this,t).duration=e}}function ga(t,e){if("function"!=typeof e)throw new Error;return function(){Vr(this,t).ease=e}}function ya(t,e,n){var r,a,i=function(t){return(t+"").trim().split(/^|\s+/).every((function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t}))}(e)?Ur:Vr;return function(){var o=i(this,t),l=o.on;l!==r&&(a=(r=l).copy()).on(e,n),o.on=a}}var va=Ve.prototype.constructor;function ma(t){return function(){this.style.removeProperty(t)}}function xa(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function wa(t,e,n){var r,a;function i(){var i=e.apply(this,arguments);return i!==a&&(r=(a=i)&&xa(t,i,n)),r}return i._value=e,i}function ka(t){return function(e){this.textContent=t.call(this,e)}}function ba(t){var e,n;function r(){var r=t.apply(this,arguments);return r!==n&&(e=(n=r)&&ka(r)),e}return r._value=t,r}var _a=0;function $a(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function Ma(){return++_a}var Aa=Ve.prototype;function Na(t){return((t*=2)<=1?t*t:--t*(2-t)+1)/2}function Ea(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}$a.prototype=function(t){return Ve().transition(t)}.prototype={constructor:$a,select:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=Rt(t));for(var r=this._groups,a=r.length,i=new Array(a),o=0;o<a;++o)for(var l,s,c=r[o],u=c.length,h=i[o]=new Array(u),d=0;d<u;++d)(l=c[d])&&(s=t.call(l,l.__data__,d,c))&&("__data__"in l&&(s.__data__=l.__data__),h[d]=s,Fr(h[d],e,n,d,h,Gr(l,n)));return new $a(i,this._parents,e,n)},selectAll:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=Ft(t));for(var r=this._groups,a=r.length,i=[],o=[],l=0;l<a;++l)for(var s,c=r[l],u=c.length,h=0;h<u;++h)if(s=c[h]){for(var d,f=t.call(s,s.__data__,h,c),p=Gr(s,n),g=0,y=f.length;g<y;++g)(d=f[g])&&Fr(d,e,n,g,f,p);i.push(f),o.push(s)}return new $a(i,o,e,n)},filter:function(t){"function"!=typeof t&&(t=Ut(t));for(var e=this._groups,n=e.length,r=new Array(n),a=0;a<n;++a)for(var i,o=e[a],l=o.length,s=r[a]=[],c=0;c<l;++c)(i=o[c])&&t.call(i,i.__data__,c,o)&&s.push(i);return new $a(r,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,a=n.length,i=Math.min(r,a),o=new Array(r),l=0;l<i;++l)for(var s,c=e[l],u=n[l],h=c.length,d=o[l]=new Array(h),f=0;f<h;++f)(s=c[f]||u[f])&&(d[f]=s);for(;l<r;++l)o[l]=e[l];return new $a(o,this._parents,this._name,this._id)},selection:function(){return new va(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,n=Ma(),r=this._groups,a=r.length,i=0;i<a;++i)for(var o,l=r[i],s=l.length,c=0;c<s;++c)if(o=l[c]){var u=Gr(o,e);Fr(o,t,n,c,l,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new $a(r,this._parents,t,n)},call:Aa.call,nodes:Aa.nodes,node:Aa.node,size:Aa.size,empty:Aa.empty,each:Aa.each,on:function(t,e){var n=this._id;return arguments.length<2?Gr(this.node(),n).on.on(t):this.each(ya(n,t,e))},attr:function(t,e){var n=Bt(t),r="transform"===n?_r:ta;return this.attrTween(t,"function"==typeof e?(n.local?oa:ia)(n,r,Jr(this,"attr."+t,e)):null==e?(n.local?na:ea)(n):(n.local?aa:ra)(n,r,e))},attrTween:function(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;var r=Bt(t);return this.tween(n,(r.local?ca:ua)(r,e))},style:function(t,e,n){var r="transform"==(t+="")?br:ta;return null==e?this.styleTween(t,function(t,e){var n,r,a;return function(){var i=ye(this,t),o=(this.style.removeProperty(t),ye(this,t));return i===o?null:i===n&&o===r?a:a=e(n=i,r=o)}}(t,r)).on("end.style."+t,ma(t)):"function"==typeof e?this.styleTween(t,function(t,e,n){var r,a,i;return function(){var o=ye(this,t),l=n(this),s=l+"";return null==l&&(this.style.removeProperty(t),s=l=ye(this,t)),o===s?null:o===r&&s===a?i:(a=s,i=e(r=o,l))}}(t,r,Jr(this,"style."+t,e))).each(function(t,e){var n,r,a,i,o="style."+e,l="end."+o;return function(){var s=Vr(this,t),c=s.on,u=null==s.value[o]?i||(i=ma(e)):void 0;c===n&&a===u||(r=(n=c).copy()).on(l,a=u),s.on=r}}(this._id,t)):this.styleTween(t,function(t,e,n){var r,a,i=n+"";return function(){var o=ye(this,t);return o===i?null:o===r?a:a=e(r=o,n)}}(t,r,e),n).on("end.style."+t,null)},styleTween:function(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==e)return this.tween(r,null);if("function"!=typeof e)throw new Error;return this.tween(r,wa(t,e,null==n?"":n))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(Jr(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!=typeof t)throw new Error;return this.tween(e,ba(t))},remove:function(){return this.on("end.remove",function(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}(this._id))},tween:function(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r,a=Gr(this.node(),n).tween,i=0,o=a.length;i<o;++i)if((r=a[i]).name===t)return r.value;return null}return this.each((null==e?Kr:Zr)(n,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?ha:da)(e,t)):Gr(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?fa:pa)(e,t)):Gr(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(ga(e,t)):Gr(this.node(),e).ease},easeVarying:function(t){if("function"!=typeof t)throw new Error;return this.each(function(t,e){return function(){var n=e.apply(this,arguments);if("function"!=typeof n)throw new Error;Vr(this,t).ease=n}}(this._id,t))},end:function(){var t,e,n=this,r=n._id,a=n.size();return new Promise((function(i,o){var l={value:o},s={value:function(){0==--a&&i()}};n.each((function(){var n=Vr(this,r),a=n.on;a!==t&&((e=(t=a).copy())._.cancel.push(l),e._.interrupt.push(l),e._.end.push(s)),n.on=e})),0===a&&i()}))},[Symbol.iterator]:Aa[Symbol.iterator]};var ja={time:null,delay:0,duration:250,ease:Ea};function Sa(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}Ve.prototype.interrupt=function(t){return this.each((function(){Qr(this,t)}))},Ve.prototype.transition=function(t){var e,n;t instanceof $a?(e=t._id,t=t._name):(e=Ma(),(n=ja).time=Pr(),t=null==t?null:t+"");for(var r=this._groups,a=r.length,i=0;i<a;++i)for(var o,l=r[i],s=l.length,c=0;c<s;++c)(o=l[c])&&Fr(o,t,e,c,l,n||Sa(o,e));return new $a(r,this._parents,t,e)};const za=Math.PI,La=2*za,Ta=1e-6,Ha=La-Ta;function qa(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function Pa(){return new qa}function Ca(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);if(204!==t.status&&205!==t.status)return t.json()}function Ba(t,e){return fetch(t,e).then(Ca)}function Ia(t,e,n,r){if(isNaN(e)||isNaN(n))return t;var a,i,o,l,s,c,u,h,d,f=t._root,p={data:r},g=t._x0,y=t._y0,v=t._x1,m=t._y1;if(!f)return t._root=p,t;for(;f.length;)if((c=e>=(i=(g+v)/2))?g=i:v=i,(u=n>=(o=(y+m)/2))?y=o:m=o,a=f,!(f=f[h=u<<1|c]))return a[h]=p,t;if(l=+t._x.call(null,f.data),s=+t._y.call(null,f.data),e===l&&n===s)return p.next=f,a?a[h]=p:t._root=p,t;do{a=a?a[h]=new Array(4):t._root=new Array(4),(c=e>=(i=(g+v)/2))?g=i:v=i,(u=n>=(o=(y+m)/2))?y=o:m=o}while((h=u<<1|c)==(d=(s>=o)<<1|l>=i));return a[d]=f,a[h]=p,t}function Wa(t,e,n,r,a){this.node=t,this.x0=e,this.y0=n,this.x1=r,this.y1=a}function Oa(t){return t[0]}function Xa(t){return t[1]}function Ra(t,e,n){var r=new Ya(null==e?Oa:e,null==n?Xa:n,NaN,NaN,NaN,NaN);return null==t?r:r.addAll(t)}function Ya(t,e,n,r,a,i){this._x=t,this._y=e,this._x0=n,this._y0=r,this._x1=a,this._y1=i,this._root=void 0}function Da(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}qa.prototype=Pa.prototype={constructor:qa,moveTo:function(t,e){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,e){this._+="L"+(this._x1=+t)+","+(this._y1=+e)},quadraticCurveTo:function(t,e,n,r){this._+="Q"+ +t+","+ +e+","+(this._x1=+n)+","+(this._y1=+r)},bezierCurveTo:function(t,e,n,r,a,i){this._+="C"+ +t+","+ +e+","+ +n+","+ +r+","+(this._x1=+a)+","+(this._y1=+i)},arcTo:function(t,e,n,r,a){t=+t,e=+e,n=+n,r=+r,a=+a;var i=this._x1,o=this._y1,l=n-t,s=r-e,c=i-t,u=o-e,h=c*c+u*u;if(a<0)throw new Error("negative radius: "+a);if(null===this._x1)this._+="M"+(this._x1=t)+","+(this._y1=e);else if(h>Ta)if(Math.abs(u*l-s*c)>Ta&&a){var d=n-i,f=r-o,p=l*l+s*s,g=d*d+f*f,y=Math.sqrt(p),v=Math.sqrt(h),m=a*Math.tan((za-Math.acos((p+h-g)/(2*y*v)))/2),x=m/v,w=m/y;Math.abs(x-1)>Ta&&(this._+="L"+(t+x*c)+","+(e+x*u)),this._+="A"+a+","+a+",0,0,"+ +(u*d>c*f)+","+(this._x1=t+w*l)+","+(this._y1=e+w*s)}else this._+="L"+(this._x1=t)+","+(this._y1=e);else;},arc:function(t,e,n,r,a,i){t=+t,e=+e,i=!!i;var o=(n=+n)*Math.cos(r),l=n*Math.sin(r),s=t+o,c=e+l,u=1^i,h=i?r-a:a-r;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+s+","+c:(Math.abs(this._x1-s)>Ta||Math.abs(this._y1-c)>Ta)&&(this._+="L"+s+","+c),n&&(h<0&&(h=h%La+La),h>Ha?this._+="A"+n+","+n+",0,1,"+u+","+(t-o)+","+(e-l)+"A"+n+","+n+",0,1,"+u+","+(this._x1=s)+","+(this._y1=c):h>Ta&&(this._+="A"+n+","+n+",0,"+ +(h>=za)+","+u+","+(this._x1=t+n*Math.cos(a))+","+(this._y1=e+n*Math.sin(a))))},rect:function(t,e,n,r){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)+"h"+ +n+"v"+ +r+"h"+-n+"Z"},toString:function(){return this._}};var Fa=Ra.prototype=Ya.prototype;function Ua(t){return function(){return t}}function Va(t){return 1e-6*(t()-.5)}function Ga(t){return t.x+t.vx}function Qa(t){return t.y+t.vy}function Ka(t){return t.index}function Za(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}function Ja(t){var e,n,r,a,i,o,l=Ka,s=function(t){return 1/Math.min(a[t.source.index],a[t.target.index])},c=Ua(30),u=1;function h(r){for(var a=0,l=t.length;a<u;++a)for(var s,c,h,d,f,p,g,y=0;y<l;++y)c=(s=t[y]).source,d=(h=s.target).x+h.vx-c.x-c.vx||Va(o),f=h.y+h.vy-c.y-c.vy||Va(o),d*=p=((p=Math.sqrt(d*d+f*f))-n[y])/p*r*e[y],f*=p,h.vx-=d*(g=i[y]),h.vy-=f*g,c.vx+=d*(g=1-g),c.vy+=f*g}function d(){if(r){var o,s,c=r.length,u=t.length,h=new Map(r.map(((t,e)=>[l(t,e,r),t])));for(o=0,a=new Array(c);o<u;++o)(s=t[o]).index=o,"object"!=typeof s.source&&(s.source=Za(h,s.source)),"object"!=typeof s.target&&(s.target=Za(h,s.target)),a[s.source.index]=(a[s.source.index]||0)+1,a[s.target.index]=(a[s.target.index]||0)+1;for(o=0,i=new Array(u);o<u;++o)s=t[o],i[o]=a[s.source.index]/(a[s.source.index]+a[s.target.index]);e=new Array(u),f(),n=new Array(u),p()}}function f(){if(r)for(var n=0,a=t.length;n<a;++n)e[n]=+s(t[n],n,t)}function p(){if(r)for(var e=0,a=t.length;e<a;++e)n[e]=+c(t[e],e,t)}return null==t&&(t=[]),h.initialize=function(t,e){r=t,o=e,d()},h.links=function(e){return arguments.length?(t=e,d(),h):t},h.id=function(t){return arguments.length?(l=t,h):l},h.iterations=function(t){return arguments.length?(u=+t,h):u},h.strength=function(t){return arguments.length?(s="function"==typeof t?t:Ua(+t),f(),h):s},h.distance=function(t){return arguments.length?(c="function"==typeof t?t:Ua(+t),p(),h):c},h}Fa.copy=function(){var t,e,n=new Ya(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=Da(r),n;for(t=[{source:r,target:n._root=new Array(4)}];r=t.pop();)for(var a=0;a<4;++a)(e=r.source[a])&&(e.length?t.push({source:e,target:r.target[a]=new Array(4)}):r.target[a]=Da(e));return n},Fa.add=function(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return Ia(this.cover(e,n),e,n,t)},Fa.addAll=function(t){var e,n,r,a,i=t.length,o=new Array(i),l=new Array(i),s=1/0,c=1/0,u=-1/0,h=-1/0;for(n=0;n<i;++n)isNaN(r=+this._x.call(null,e=t[n]))||isNaN(a=+this._y.call(null,e))||(o[n]=r,l[n]=a,r<s&&(s=r),r>u&&(u=r),a<c&&(c=a),a>h&&(h=a));if(s>u||c>h)return this;for(this.cover(s,c).cover(u,h),n=0;n<i;++n)Ia(this,o[n],l[n],t[n]);return this},Fa.cover=function(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,r=this._y0,a=this._x1,i=this._y1;if(isNaN(n))a=(n=Math.floor(t))+1,i=(r=Math.floor(e))+1;else{for(var o,l,s=a-n||1,c=this._root;n>t||t>=a||r>e||e>=i;)switch(l=(e<r)<<1|t<n,(o=new Array(4))[l]=c,c=o,s*=2,l){case 0:a=n+s,i=r+s;break;case 1:n=a-s,i=r+s;break;case 2:a=n+s,r=i-s;break;case 3:n=a-s,r=i-s}this._root&&this._root.length&&(this._root=c)}return this._x0=n,this._y0=r,this._x1=a,this._y1=i,this},Fa.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},Fa.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},Fa.find=function(t,e,n){var r,a,i,o,l,s,c,u=this._x0,h=this._y0,d=this._x1,f=this._y1,p=[],g=this._root;for(g&&p.push(new Wa(g,u,h,d,f)),null==n?n=1/0:(u=t-n,h=e-n,d=t+n,f=e+n,n*=n);s=p.pop();)if(!(!(g=s.node)||(a=s.x0)>d||(i=s.y0)>f||(o=s.x1)<u||(l=s.y1)<h))if(g.length){var y=(a+o)/2,v=(i+l)/2;p.push(new Wa(g[3],y,v,o,l),new Wa(g[2],a,v,y,l),new Wa(g[1],y,i,o,v),new Wa(g[0],a,i,y,v)),(c=(e>=v)<<1|t>=y)&&(s=p[p.length-1],p[p.length-1]=p[p.length-1-c],p[p.length-1-c]=s)}else{var m=t-+this._x.call(null,g.data),x=e-+this._y.call(null,g.data),w=m*m+x*x;if(w<n){var k=Math.sqrt(n=w);u=t-k,h=e-k,d=t+k,f=e+k,r=g.data}}return r},Fa.remove=function(t){if(isNaN(i=+this._x.call(null,t))||isNaN(o=+this._y.call(null,t)))return this;var e,n,r,a,i,o,l,s,c,u,h,d,f=this._root,p=this._x0,g=this._y0,y=this._x1,v=this._y1;if(!f)return this;if(f.length)for(;;){if((c=i>=(l=(p+y)/2))?p=l:y=l,(u=o>=(s=(g+v)/2))?g=s:v=s,e=f,!(f=f[h=u<<1|c]))return this;if(!f.length)break;(e[h+1&3]||e[h+2&3]||e[h+3&3])&&(n=e,d=h)}for(;f.data!==t;)if(r=f,!(f=f.next))return this;return(a=f.next)&&delete f.next,r?(a?r.next=a:delete r.next,this):e?(a?e[h]=a:delete e[h],(f=e[0]||e[1]||e[2]||e[3])&&f===(e[3]||e[2]||e[1]||e[0])&&!f.length&&(n?n[d]=f:this._root=f),this):(this._root=a,this)},Fa.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},Fa.root=function(){return this._root},Fa.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},Fa.visit=function(t){var e,n,r,a,i,o,l=[],s=this._root;for(s&&l.push(new Wa(s,this._x0,this._y0,this._x1,this._y1));e=l.pop();)if(!t(s=e.node,r=e.x0,a=e.y0,i=e.x1,o=e.y1)&&s.length){var c=(r+i)/2,u=(a+o)/2;(n=s[3])&&l.push(new Wa(n,c,u,i,o)),(n=s[2])&&l.push(new Wa(n,r,u,c,o)),(n=s[1])&&l.push(new Wa(n,c,a,i,u)),(n=s[0])&&l.push(new Wa(n,r,a,c,u))}return this},Fa.visitAfter=function(t){var e,n=[],r=[];for(this._root&&n.push(new Wa(this._root,this._x0,this._y0,this._x1,this._y1));e=n.pop();){var a=e.node;if(a.length){var i,o=e.x0,l=e.y0,s=e.x1,c=e.y1,u=(o+s)/2,h=(l+c)/2;(i=a[0])&&n.push(new Wa(i,o,l,u,h)),(i=a[1])&&n.push(new Wa(i,u,l,s,h)),(i=a[2])&&n.push(new Wa(i,o,h,u,c)),(i=a[3])&&n.push(new Wa(i,u,h,s,c))}r.push(e)}for(;e=r.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this},Fa.x=function(t){return arguments.length?(this._x=t,this):this._x},Fa.y=function(t){return arguments.length?(this._y=t,this):this._y};const ti=4294967296;function ei(t){return t.x}function ni(t){return t.y}var ri=Math.PI*(3-Math.sqrt(5));function ai(t){var e,n=1,r=.001,a=1-Math.pow(r,1/300),i=0,o=.6,l=new Map,s=Ir(h),c=zt("tick","end"),u=function(){let t=1;return()=>(t=(1664525*t+1013904223)%ti)/ti}();function h(){d(),c.call("tick",e),n<r&&(s.stop(),c.call("end",e))}function d(r){var s,c,u=t.length;void 0===r&&(r=1);for(var h=0;h<r;++h)for(n+=(i-n)*a,l.forEach((function(t){t(n)})),s=0;s<u;++s)null==(c=t[s]).fx?c.x+=c.vx*=o:(c.x=c.fx,c.vx=0),null==c.fy?c.y+=c.vy*=o:(c.y=c.fy,c.vy=0);return e}function f(){for(var e,n=0,r=t.length;n<r;++n){if((e=t[n]).index=n,null!=e.fx&&(e.x=e.fx),null!=e.fy&&(e.y=e.fy),isNaN(e.x)||isNaN(e.y)){var a=10*Math.sqrt(.5+n),i=n*ri;e.x=a*Math.cos(i),e.y=a*Math.sin(i)}(isNaN(e.vx)||isNaN(e.vy))&&(e.vx=e.vy=0)}}function p(e){return e.initialize&&e.initialize(t,u),e}return null==t&&(t=[]),f(),e={tick:d,restart:function(){return s.restart(h),e},stop:function(){return s.stop(),e},nodes:function(n){return arguments.length?(t=n,f(),l.forEach(p),e):t},alpha:function(t){return arguments.length?(n=+t,e):n},alphaMin:function(t){return arguments.length?(r=+t,e):r},alphaDecay:function(t){return arguments.length?(a=+t,e):+a},alphaTarget:function(t){return arguments.length?(i=+t,e):i},velocityDecay:function(t){return arguments.length?(o=1-t,e):1-o},randomSource:function(t){return arguments.length?(u=t,l.forEach(p),e):u},force:function(t,n){return arguments.length>1?(null==n?l.delete(t):l.set(t,p(n)),e):l.get(t)},find:function(e,n,r){var a,i,o,l,s,c=0,u=t.length;for(null==r?r=1/0:r*=r,c=0;c<u;++c)(o=(a=e-(l=t[c]).x)*a+(i=n-l.y)*i)<r&&(s=l,r=o);return s},on:function(t,n){return arguments.length>1?(c.on(t,n),e):c.on(t)}}}function ii(t){var e,n,r,a=Ua(.1);function i(t){for(var a,i=0,o=e.length;i<o;++i)(a=e[i]).vx+=(r[i]-a.x)*n[i]*t}function o(){if(e){var i,o=e.length;for(n=new Array(o),r=new Array(o),i=0;i<o;++i)n[i]=isNaN(r[i]=+t(e[i],i,e))?0:+a(e[i],i,e)}}return"function"!=typeof t&&(t=Ua(null==t?0:+t)),i.initialize=function(t){e=t,o()},i.strength=function(t){return arguments.length?(a="function"==typeof t?t:Ua(+t),o(),i):a},i.x=function(e){return arguments.length?(t="function"==typeof e?e:Ua(+e),o(),i):t},i}function oi(t){var e,n,r,a=Ua(.1);function i(t){for(var a,i=0,o=e.length;i<o;++i)(a=e[i]).vy+=(r[i]-a.y)*n[i]*t}function o(){if(e){var i,o=e.length;for(n=new Array(o),r=new Array(o),i=0;i<o;++i)n[i]=isNaN(r[i]=+t(e[i],i,e))?0:+a(e[i],i,e)}}return"function"!=typeof t&&(t=Ua(null==t?0:+t)),i.initialize=function(t){e=t,o()},i.strength=function(t){return arguments.length?(a="function"==typeof t?t:Ua(+t),o(),i):a},i.y=function(e){return arguments.length?(t="function"==typeof e?e:Ua(+e),o(),i):t},i}function li(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function si(t){return(t=li(Math.abs(t)))?t[1]:NaN}var ci,ui=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function hi(t){if(!(e=ui.exec(t)))throw new Error("invalid format: "+t);var e;return new di({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function di(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function fi(t,e){var n=li(t,e);if(!n)return t+"";var r=n[0],a=n[1];return a<0?"0."+new Array(-a).join("0")+r:r.length>a+1?r.slice(0,a+1)+"."+r.slice(a+1):r+new Array(a-r.length+2).join("0")}hi.prototype=di.prototype,di.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var pi={"%":(t,e)=>(100*t).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:function(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)},e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>fi(100*t,e),r:fi,s:function(t,e){var n=li(t,e);if(!n)return t+"";var r=n[0],a=n[1],i=a-(ci=3*Math.max(-8,Math.min(8,Math.floor(a/3))))+1,o=r.length;return i===o?r:i>o?r+new Array(i-o+1).join("0"):i>0?r.slice(0,i)+"."+r.slice(i):"0."+new Array(1-i).join("0")+li(t,Math.max(0,e+i-1))[0]},X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function gi(t){return t}var yi,vi,mi,xi=Array.prototype.map,wi=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function ki(t){var e,n,r=void 0===t.grouping||void 0===t.thousands?gi:(e=xi.call(t.grouping,Number),n=t.thousands+"",function(t,r){for(var a=t.length,i=[],o=0,l=e[0],s=0;a>0&&l>0&&(s+l+1>r&&(l=Math.max(1,r-s)),i.push(t.substring(a-=l,a+l)),!((s+=l+1)>r));)l=e[o=(o+1)%e.length];return i.reverse().join(n)}),a=void 0===t.currency?"":t.currency[0]+"",i=void 0===t.currency?"":t.currency[1]+"",o=void 0===t.decimal?".":t.decimal+"",l=void 0===t.numerals?gi:function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(xi.call(t.numerals,String)),s=void 0===t.percent?"%":t.percent+"",c=void 0===t.minus?"−":t.minus+"",u=void 0===t.nan?"NaN":t.nan+"";function h(t){var e=(t=hi(t)).fill,n=t.align,h=t.sign,d=t.symbol,f=t.zero,p=t.width,g=t.comma,y=t.precision,v=t.trim,m=t.type;"n"===m?(g=!0,m="g"):pi[m]||(void 0===y&&(y=12),v=!0,m="g"),(f||"0"===e&&"="===n)&&(f=!0,e="0",n="=");var x="$"===d?a:"#"===d&&/[boxX]/.test(m)?"0"+m.toLowerCase():"",w="$"===d?i:/[%p]/.test(m)?s:"",k=pi[m],b=/[defgprs%]/.test(m);function _(t){var a,i,s,d=x,_=w;if("c"===m)_=k(t)+_,t="";else{var $=(t=+t)<0||1/t<0;if(t=isNaN(t)?u:k(Math.abs(t),y),v&&(t=function(t){t:for(var e,n=t.length,r=1,a=-1;r<n;++r)switch(t[r]){case".":a=e=r;break;case"0":0===a&&(a=r),e=r;break;default:if(!+t[r])break t;a>0&&(a=0)}return a>0?t.slice(0,a)+t.slice(e+1):t}(t)),$&&0==+t&&"+"!==h&&($=!1),d=($?"("===h?h:c:"-"===h||"("===h?"":h)+d,_=("s"===m?wi[8+ci/3]:"")+_+($&&"("===h?")":""),b)for(a=-1,i=t.length;++a<i;)if(48>(s=t.charCodeAt(a))||s>57){_=(46===s?o+t.slice(a+1):t.slice(a))+_,t=t.slice(0,a);break}}g&&!f&&(t=r(t,1/0));var M=d.length+t.length+_.length,A=M<p?new Array(p-M+1).join(e):"";switch(g&&f&&(t=r(A+t,A.length?p-_.length:1/0),A=""),n){case"<":t=d+t+_+A;break;case"=":t=d+A+t+_;break;case"^":t=A.slice(0,M=A.length>>1)+d+t+_+A.slice(M);break;default:t=A+d+t+_}return l(t)}return y=void 0===y?6:/[gprs]/.test(m)?Math.max(1,Math.min(21,y)):Math.max(0,Math.min(20,y)),_.toString=function(){return t+""},_}return{format:h,formatPrefix:function(t,e){var n=h(((t=hi(t)).type="f",t)),r=3*Math.max(-8,Math.min(8,Math.floor(si(e)/3))),a=Math.pow(10,-r),i=wi[8+r/3];return function(t){return n(a*t)+i}}}}function bi(t){var e=0,n=t.children,r=n&&n.length;if(r)for(;--r>=0;)e+=n[r].value;else e=1;t.value=e}function _i(t,e){t instanceof Map?(t=[void 0,t],void 0===e&&(e=Mi)):void 0===e&&(e=$i);for(var n,r,a,i,o,l=new Ei(t),s=[l];n=s.pop();)if((a=e(n.data))&&(o=(a=Array.from(a)).length))for(n.children=a,i=o-1;i>=0;--i)s.push(r=a[i]=new Ei(a[i])),r.parent=n,r.depth=n.depth+1;return l.eachBefore(Ni)}function $i(t){return t.children}function Mi(t){return Array.isArray(t)?t[1]:null}function Ai(t){void 0!==t.data.value&&(t.value=t.data.value),t.data=t.data.data}function Ni(t){var e=0;do{t.height=e}while((t=t.parent)&&t.height<++e)}function Ei(t){this.data=t,this.depth=this.height=0,this.parent=null}function ji(t){if("function"!=typeof t)throw new Error;return t}yi=ki({thousands:",",grouping:[3],currency:["$",""]}),vi=yi.format,mi=yi.formatPrefix,Ei.prototype=_i.prototype={constructor:Ei,count:function(){return this.eachAfter(bi)},each:function(t,e){let n=-1;for(const r of this)t.call(e,r,++n,this);return this},eachAfter:function(t,e){for(var n,r,a,i=this,o=[i],l=[],s=-1;i=o.pop();)if(l.push(i),n=i.children)for(r=0,a=n.length;r<a;++r)o.push(n[r]);for(;i=l.pop();)t.call(e,i,++s,this);return this},eachBefore:function(t,e){for(var n,r,a=this,i=[a],o=-1;a=i.pop();)if(t.call(e,a,++o,this),n=a.children)for(r=n.length-1;r>=0;--r)i.push(n[r]);return this},find:function(t,e){let n=-1;for(const r of this)if(t.call(e,r,++n,this))return r},sum:function(t){return this.eachAfter((function(e){for(var n=+t(e.data)||0,r=e.children,a=r&&r.length;--a>=0;)n+=r[a].value;e.value=n}))},sort:function(t){return this.eachBefore((function(e){e.children&&e.children.sort(t)}))},path:function(t){for(var e=this,n=function(t,e){if(t===e)return t;var n=t.ancestors(),r=e.ancestors(),a=null;t=n.pop(),e=r.pop();for(;t===e;)a=t,t=n.pop(),e=r.pop();return a}(e,t),r=[e];e!==n;)e=e.parent,r.push(e);for(var a=r.length;t!==n;)r.splice(a,0,t),t=t.parent;return r},ancestors:function(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e},descendants:function(){return Array.from(this)},leaves:function(){var t=[];return this.eachBefore((function(e){e.children||t.push(e)})),t},links:function(){var t=this,e=[];return t.each((function(n){n!==t&&e.push({source:n.parent,target:n})})),e},copy:function(){return _i(this).eachBefore(Ai)},[Symbol.iterator]:function*(){var t,e,n,r,a=this,i=[a];do{for(t=i.reverse(),i=[];a=t.pop();)if(yield a,e=a.children)for(n=0,r=e.length;n<r;++n)i.push(e[n])}while(i.length)}};var Si={depth:-1},zi={};function Li(t){return t.id}function Ti(t){return t.parentId}function Hi(t,e){return t.parent===e.parent?1:2}function qi(t){var e=t.children;return e?e[0]:t.t}function Pi(t){var e=t.children;return e?e[e.length-1]:t.t}function Ci(t,e,n){var r=n/(e.i-t.i);e.c-=r,e.s+=n,t.c+=r,e.z+=n,e.m+=n}function Bi(t,e,n){return t.a.parent===e.parent?t.a:n}function Ii(t,e){this._=t,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=e}function Wi(){var t=Hi,e=1,n=1,r=null;function a(a){var s=function(t){for(var e,n,r,a,i,o=new Ii(t,0),l=[o];e=l.pop();)if(r=e._.children)for(e.children=new Array(i=r.length),a=i-1;a>=0;--a)l.push(n=e.children[a]=new Ii(r[a],a)),n.parent=e;return(o.parent=new Ii(null,0)).children=[o],o}(a);if(s.eachAfter(i),s.parent.m=-s.z,s.eachBefore(o),r)a.eachBefore(l);else{var c=a,u=a,h=a;a.eachBefore((function(t){t.x<c.x&&(c=t),t.x>u.x&&(u=t),t.depth>h.depth&&(h=t)}));var d=c===u?1:t(c,u)/2,f=d-c.x,p=e/(u.x+d+f),g=n/(h.depth||1);a.eachBefore((function(t){t.x=(t.x+f)*p,t.y=t.depth*g}))}return a}function i(e){var n=e.children,r=e.parent.children,a=e.i?r[e.i-1]:null;if(n){!function(t){for(var e,n=0,r=0,a=t.children,i=a.length;--i>=0;)(e=a[i]).z+=n,e.m+=n,n+=e.s+(r+=e.c)}(e);var i=(n[0].z+n[n.length-1].z)/2;a?(e.z=a.z+t(e._,a._),e.m=e.z-i):e.z=i}else a&&(e.z=a.z+t(e._,a._));e.parent.A=function(e,n,r){if(n){for(var a,i=e,o=e,l=n,s=i.parent.children[0],c=i.m,u=o.m,h=l.m,d=s.m;l=Pi(l),i=qi(i),l&&i;)s=qi(s),(o=Pi(o)).a=e,(a=l.z+h-i.z-c+t(l._,i._))>0&&(Ci(Bi(l,e,r),e,a),c+=a,u+=a),h+=l.m,c+=i.m,d+=s.m,u+=o.m;l&&!Pi(o)&&(o.t=l,o.m+=h-u),i&&!qi(s)&&(s.t=i,s.m+=c-d,r=e)}return r}(e,a,e.parent.A||r[0])}function o(t){t._.x=t.z+t.parent.m,t.m+=t.parent.m}function l(t){t.x*=e,t.y=t.depth*n}return a.separation=function(e){return arguments.length?(t=e,a):t},a.size=function(t){return arguments.length?(r=!1,e=+t[0],n=+t[1],a):r?null:[e,n]},a.nodeSize=function(t){return arguments.length?(r=!0,e=+t[0],n=+t[1],a):r?[e,n]:null},a}function Oi(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}function Xi(t){return+t}Ii.prototype=Object.create(Ei.prototype);var Ri=[0,1];function Yi(t){return t}function Di(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:function(t){return function(){return t}}(isNaN(e)?NaN:.5)}function Fi(t,e,n){var r=t[0],a=t[1],i=e[0],o=e[1];return a<r?(r=Di(a,r),i=n(o,i)):(r=Di(r,a),i=n(i,o)),function(t){return i(r(t))}}function Ui(t,e,n){var r=Math.min(t.length,e.length)-1,a=new Array(r),i=new Array(r),o=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<r;)a[o]=Di(t[o],t[o+1]),i[o]=n(e[o],e[o+1]);return function(e){var n=ft(t,e,1,r)-1;return i[n](a[n](e))}}function Vi(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Gi(){var t,e,n,r,a,i,o=Ri,l=Ri,s=gr,c=Yi;function u(){var t=Math.min(o.length,l.length);return c!==Yi&&(c=function(t,e){var n;return t>e&&(n=t,t=e,e=n),function(n){return Math.max(t,Math.min(e,n))}}(o[0],o[t-1])),r=t>2?Ui:Fi,a=i=null,h}function h(e){return isNaN(e=+e)?n:(a||(a=r(o.map(t),l,s)))(t(c(e)))}return h.invert=function(n){return c(e((i||(i=r(l,o.map(t),ur)))(n)))},h.domain=function(t){return arguments.length?(o=Array.from(t,Xi),u()):o.slice()},h.range=function(t){return arguments.length?(l=Array.from(t),u()):l.slice()},h.rangeRound=function(t){return l=Array.from(t),s=yr,u()},h.clamp=function(t){return arguments.length?(c=!!t||Yi,u()):c!==Yi},h.interpolate=function(t){return arguments.length?(s=t,u()):s},h.unknown=function(t){return arguments.length?(n=t,h):n},function(n,r){return t=n,e=r,u()}}function Qi(){return Gi()(Yi,Yi)}function Ki(t,e,n,r){var a,i=function(t,e,n){var r=Math.abs(e-t)/Math.max(0,n),a=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),i=r/a;return i>=gt?a*=10:i>=yt?a*=5:i>=vt&&(a*=2),e<t?-a:a}(t,e,n);switch((r=hi(null==r?",f":r)).type){case"s":var o=Math.max(Math.abs(t),Math.abs(e));return null!=r.precision||isNaN(a=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(si(e)/3)))-si(Math.abs(t)))}(i,o))||(r.precision=a),mi(r,o);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(a=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,si(e)-si(t))+1}(i,Math.max(Math.abs(t),Math.abs(e))))||(r.precision=a-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(a=function(t){return Math.max(0,-si(Math.abs(t)))}(i))||(r.precision=a-2*("%"===r.type))}return vi(r)}function Zi(t){var e=t.domain;return t.ticks=function(t){var n=e();return function(t,e,n){var r,a,i,o,l=-1;if(n=+n,(t=+t)==(e=+e)&&n>0)return[t];if((r=e<t)&&(a=t,t=e,e=a),0===(o=mt(t,e,n))||!isFinite(o))return[];if(o>0)for(t=Math.ceil(t/o),e=Math.floor(e/o),i=new Array(a=Math.ceil(e-t+1));++l<a;)i[l]=(t+l)*o;else for(o=-o,t=Math.ceil(t*o),e=Math.floor(e*o),i=new Array(a=Math.ceil(e-t+1));++l<a;)i[l]=(t+l)/o;return r&&i.reverse(),i}(n[0],n[n.length-1],null==t?10:t)},t.tickFormat=function(t,n){var r=e();return Ki(r[0],r[r.length-1],null==t?10:t,n)},t.nice=function(n){null==n&&(n=10);var r,a,i=e(),o=0,l=i.length-1,s=i[o],c=i[l],u=10;for(c<s&&(a=s,s=c,c=a,a=o,o=l,l=a);u-- >0;){if((a=mt(s,c,n))===r)return i[o]=s,i[l]=c,e(i);if(a>0)s=Math.floor(s/a)*a,c=Math.ceil(c/a)*a;else{if(!(a<0))break;s=Math.ceil(s*a)/a,c=Math.floor(c*a)/a}r=a}return t},t}function Ji(){var t=Qi();return t.copy=function(){return Vi(t,Ji())},Oi.apply(t,arguments),Zi(t)}function to(t){return function(){return t}}var eo=Math.abs,no=Math.atan2,ro=Math.cos,ao=Math.max,io=Math.min,oo=Math.sin,lo=Math.sqrt,so=1e-12,co=Math.PI,uo=co/2,ho=2*co;function fo(t){return t>1?0:t<-1?co:Math.acos(t)}function po(t){return t>=1?uo:t<=-1?-uo:Math.asin(t)}function go(t){return t.innerRadius}function yo(t){return t.outerRadius}function vo(t){return t.startAngle}function mo(t){return t.endAngle}function xo(t){return t&&t.padAngle}function wo(t,e,n,r,a,i,o,l){var s=n-t,c=r-e,u=o-a,h=l-i,d=h*s-u*c;if(!(d*d<so))return[t+(d=(u*(e-i)-h*(t-a))/d)*s,e+d*c]}function ko(t,e,n,r,a,i,o){var l=t-n,s=e-r,c=(o?i:-i)/lo(l*l+s*s),u=c*s,h=-c*l,d=t+u,f=e+h,p=n+u,g=r+h,y=(d+p)/2,v=(f+g)/2,m=p-d,x=g-f,w=m*m+x*x,k=a-i,b=d*g-p*f,_=(x<0?-1:1)*lo(ao(0,k*k*w-b*b)),$=(b*x-m*_)/w,M=(-b*m-x*_)/w,A=(b*x+m*_)/w,N=(-b*m+x*_)/w,E=$-y,j=M-v,S=A-y,z=N-v;return E*E+j*j>S*S+z*z&&($=A,M=N),{cx:$,cy:M,x01:-u,y01:-h,x11:$*(a/k-1),y11:M*(a/k-1)}}function bo(){var t=go,e=yo,n=to(0),r=null,a=vo,i=mo,o=xo,l=null;function s(){var s,c,u=+t.apply(this,arguments),h=+e.apply(this,arguments),d=a.apply(this,arguments)-uo,f=i.apply(this,arguments)-uo,p=eo(f-d),g=f>d;if(l||(l=s=Pa()),h<u&&(c=h,h=u,u=c),h>so)if(p>ho-so)l.moveTo(h*ro(d),h*oo(d)),l.arc(0,0,h,d,f,!g),u>so&&(l.moveTo(u*ro(f),u*oo(f)),l.arc(0,0,u,f,d,g));else{var y,v,m=d,x=f,w=d,k=f,b=p,_=p,$=o.apply(this,arguments)/2,M=$>so&&(r?+r.apply(this,arguments):lo(u*u+h*h)),A=io(eo(h-u)/2,+n.apply(this,arguments)),N=A,E=A;if(M>so){var j=po(M/u*oo($)),S=po(M/h*oo($));(b-=2*j)>so?(w+=j*=g?1:-1,k-=j):(b=0,w=k=(d+f)/2),(_-=2*S)>so?(m+=S*=g?1:-1,x-=S):(_=0,m=x=(d+f)/2)}var z=h*ro(m),L=h*oo(m),T=u*ro(k),H=u*oo(k);if(A>so){var q,P=h*ro(x),C=h*oo(x),B=u*ro(w),I=u*oo(w);if(p<co&&(q=wo(z,L,B,I,P,C,T,H))){var W=z-q[0],O=L-q[1],X=P-q[0],R=C-q[1],Y=1/oo(fo((W*X+O*R)/(lo(W*W+O*O)*lo(X*X+R*R)))/2),D=lo(q[0]*q[0]+q[1]*q[1]);N=io(A,(u-D)/(Y-1)),E=io(A,(h-D)/(Y+1))}}_>so?E>so?(y=ko(B,I,z,L,h,E,g),v=ko(P,C,T,H,h,E,g),l.moveTo(y.cx+y.x01,y.cy+y.y01),E<A?l.arc(y.cx,y.cy,E,no(y.y01,y.x01),no(v.y01,v.x01),!g):(l.arc(y.cx,y.cy,E,no(y.y01,y.x01),no(y.y11,y.x11),!g),l.arc(0,0,h,no(y.cy+y.y11,y.cx+y.x11),no(v.cy+v.y11,v.cx+v.x11),!g),l.arc(v.cx,v.cy,E,no(v.y11,v.x11),no(v.y01,v.x01),!g))):(l.moveTo(z,L),l.arc(0,0,h,m,x,!g)):l.moveTo(z,L),u>so&&b>so?N>so?(y=ko(T,H,P,C,u,-N,g),v=ko(z,L,B,I,u,-N,g),l.lineTo(y.cx+y.x01,y.cy+y.y01),N<A?l.arc(y.cx,y.cy,N,no(y.y01,y.x01),no(v.y01,v.x01),!g):(l.arc(y.cx,y.cy,N,no(y.y01,y.x01),no(y.y11,y.x11),!g),l.arc(0,0,u,no(y.cy+y.y11,y.cx+y.x11),no(v.cy+v.y11,v.cx+v.x11),g),l.arc(v.cx,v.cy,N,no(v.y11,v.x11),no(v.y01,v.x01),!g))):l.arc(0,0,u,k,w,g):l.lineTo(T,H)}else l.moveTo(0,0);if(l.closePath(),s)return l=null,s+""||null}return s.centroid=function(){var n=(+t.apply(this,arguments)+ +e.apply(this,arguments))/2,r=(+a.apply(this,arguments)+ +i.apply(this,arguments))/2-co/2;return[ro(r)*n,oo(r)*n]},s.innerRadius=function(e){return arguments.length?(t="function"==typeof e?e:to(+e),s):t},s.outerRadius=function(t){return arguments.length?(e="function"==typeof t?t:to(+t),s):e},s.cornerRadius=function(t){return arguments.length?(n="function"==typeof t?t:to(+t),s):n},s.padRadius=function(t){return arguments.length?(r=null==t?null:"function"==typeof t?t:to(+t),s):r},s.startAngle=function(t){return arguments.length?(a="function"==typeof t?t:to(+t),s):a},s.endAngle=function(t){return arguments.length?(i="function"==typeof t?t:to(+t),s):i},s.padAngle=function(t){return arguments.length?(o="function"==typeof t?t:to(+t),s):o},s.context=function(t){return arguments.length?(l=null==t?null:t,s):l},s}var _o=Array.prototype.slice;function $o(t){return t[0]}function Mo(t){return t[1]}function Ao(t){return t.source}function No(t){return t.target}function Eo(t,e,n,r,a){t.moveTo(e,n),t.bezierCurveTo(e,n=(n+a)/2,r,n,r,a)}function jo(){return function(t){var e=Ao,n=No,r=$o,a=Mo,i=null;function o(){var o,l=_o.call(arguments),s=e.apply(this,l),c=n.apply(this,l);if(i||(i=o=Pa()),t(i,+r.apply(this,(l[0]=s,l)),+a.apply(this,l),+r.apply(this,(l[0]=c,l)),+a.apply(this,l)),o)return i=null,o+""||null}return o.source=function(t){return arguments.length?(e=t,o):e},o.target=function(t){return arguments.length?(n=t,o):n},o.x=function(t){return arguments.length?(r="function"==typeof t?t:to(+t),o):r},o.y=function(t){return arguments.length?(a="function"==typeof t?t:to(+t),o):a},o.context=function(t){return arguments.length?(i=null==t?null:t,o):i},o}(Eo)}var So=t=>()=>t;function zo(t,{sourceEvent:e,target:n,transform:r,dispatch:a}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:a}})}function Lo(t,e,n){this.k=t,this.x=e,this.y=n}Lo.prototype={constructor:Lo,scale:function(t){return 1===t?this:new Lo(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new Lo(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var To=new Lo(1,0,0);function Ho(t){t.stopImmediatePropagation()}function qo(t){t.preventDefault(),t.stopImmediatePropagation()}function Po(t){return!(t.ctrlKey&&"wheel"!==t.type||t.button)}function Co(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t).hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]:[[0,0],[t.clientWidth,t.clientHeight]]}function Bo(){return this.__zoom||To}function Io(t){return-t.deltaY*(1===t.deltaMode?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function Wo(){return navigator.maxTouchPoints||"ontouchstart"in this}function Oo(t,e,n){var r=t.invertX(e[0][0])-n[0][0],a=t.invertX(e[1][0])-n[1][0],i=t.invertY(e[0][1])-n[0][1],o=t.invertY(e[1][1])-n[1][1];return t.translate(a>r?(r+a)/2:Math.min(0,r)||Math.max(0,a),o>i?(i+o)/2:Math.min(0,i)||Math.max(0,o))}function Xo(t,e,n){const r=t.slice();return r[63]=e[n],r}function Ro(t,e,n){const r=t.slice();return r[66]=e[n],r}function Yo(t,e,n){const r=t.slice();return r[66]=e[n],r}function Do(e){let n,r,a,i=e[66]+1+"";return{c(){n=u("option"),r=d(i),n.__value=a=e[66],n.value=n.__value},m(t,e){l(t,n,e),o(n,r)},p:t,d(t){t&&s(n)}}}function Fo(e){let n,r,a,i=e[66]+1+"";return{c(){n=u("option"),r=d(i),n.__value=a=e[66],n.value=n.__value},m(t,e){l(t,n,e),o(n,r)},p:t,d(t){t&&s(n)}}}function Uo(e){let n,r,a,i=e[63].name+"";return{c(){n=u("option"),r=d(i),n.__value=a=e[63].value,n.value=n.__value},m(t,e){l(t,n,e),o(n,r)},p:t,d(t){t&&s(n)}}}function Vo(e){let n,r,a,i,v,x,w,k,b,_,$,M,A,N,E,j,S,z,L,T,H,q,P,C,B,I,W,O,X,R,Y,D,F,U,V,G,Q,K,Z,J,tt,et,nt,rt,at,it,ot,lt,st,ct,ut,ht,dt,ft,pt,gt,yt,vt,mt,xt,wt,kt,bt,_t,$t,Mt,At,Nt,Et,jt,St,zt,Lt,Tt,Ht,qt,Pt,Ct,Bt,It,Wt,Ot,Xt,Rt,Yt,Dt=(e[3].autoAttention?"auto":e[6](e[4].force.attention,2))+"",Ft=e[6](e[4].force.textOrder,2)+"",Ut=e[6](e[4].force.manyBody,2)+"",Vt=e[6](e[4].force.collideRadius,2)+"",Gt=e[6](e[1],2)+"",Qt=[...Array(12).keys()],Kt=[];for(let t=0;t<Qt.length;t+=1)Kt[t]=Do(Yo(e,Qt,t));let Zt=[...Array(12).keys()],Jt=[];for(let t=0;t<Zt.length;t+=1)Jt[t]=Fo(Ro(e,Zt,t));let te=Object.values(e[5]),ee=[];for(let t=0;t<te.length;t+=1)ee[t]=Uo(Xo(e,te,t));return{c(){n=u("div"),r=u("div"),a=u("div"),a.textContent="Semantic Attention Graph",i=f(),v=u("div"),x=u("div"),w=u("div"),k=d("Layer \n          "),b=u("div"),_=u("select");for(let t=0;t<Kt.length;t+=1)Kt[t].c();$=f(),M=u("div"),A=d("Head\n          "),N=u("div"),E=u("select");for(let t=0;t<Jt.length;t+=1)Jt[t].c();j=f(),S=u("div"),z=f(),L=u("div"),T=u("div"),T.innerHTML='<i class="fas fa-sliders-h"></i>',H=f(),q=u("div"),P=f(),C=u("div"),B=u("select");for(let t=0;t<ee.length;t+=1)ee[t].c();I=f(),W=u("div"),O=u("div"),X=f(),R=u("div"),R.textContent="Edge Force",Y=f(),D=u("div"),F=f(),U=u("div"),V=u("div"),G=u("label"),G.textContent="Attention",Q=f(),K=u("div"),Z=d(Dt),J=f(),tt=u("input"),et=f(),nt=u("div"),rt=u("div"),at=u("label"),at.textContent="Text Order",it=f(),ot=u("div"),lt=d(Ft),st=f(),ct=u("input"),ut=f(),ht=u("div"),dt=u("div"),ft=u("label"),ft.textContent="ManyBody",pt=f(),gt=u("div"),yt=d(Ut),vt=f(),mt=u("input"),xt=f(),wt=u("div"),kt=u("div"),bt=u("label"),bt.textContent="Node Distance",_t=f(),$t=u("div"),Mt=d(Vt),At=f(),Nt=u("input"),Et=f(),jt=u("div"),jt.textContent="Edge Threshold",St=f(),zt=u("div"),Lt=f(),Tt=u("div"),Ht=u("div"),qt=u("label"),qt.textContent="Attention >",Pt=f(),Ct=u("div"),Bt=d(Gt),It=f(),Wt=u("input"),Ot=f(),Xt=h("svg"),g(a,"class","graph-label svelte-fod5ym"),g(_,"name","layer"),g(_,"class","select-num svelte-fod5ym"),g(_,"id","select-layer"),g(b,"class","select select-num-div svelte-fod5ym"),g(E,"name","layer"),g(E,"class","select-num svelte-fod5ym"),g(E,"id","select-head"),g(N,"class","select select-num-div svelte-fod5ym"),g(x,"class","name svelte-fod5ym"),g(S,"class","sep-line-horizontal svelte-fod5ym"),g(T,"class","setting-icon svelte-fod5ym"),m(T,"active",e[2]),g(q,"class","sep-line-vertical svelte-fod5ym"),g(B,"name","layout"),g(B,"id","select-layout"),g(B,"class","svelte-fod5ym"),g(C,"class","select svelte-fod5ym"),g(L,"class","select-row svelte-fod5ym"),g(O,"class","sep-line-horizontal longer-line svelte-fod5ym"),g(R,"class","slider-title svelte-fod5ym"),g(D,"class","sep-line-horizontal svelte-fod5ym"),g(G,"for","attention"),g(G,"class","svelte-fod5ym"),g(K,"class","slider-value svelte-fod5ym"),g(V,"class","slider-text svelte-fod5ym"),g(tt,"type","range"),g(tt,"min","0"),g(tt,"max","1000"),tt.value="500",g(tt,"class","slider svelte-fod5ym"),g(tt,"id","attention"),g(U,"class","slider svelte-fod5ym"),g(at,"for","textOrder"),g(at,"class","svelte-fod5ym"),g(ot,"class","slider-value svelte-fod5ym"),g(rt,"class","slider-text svelte-fod5ym"),g(ct,"type","range"),g(ct,"min","0"),g(ct,"max","1000"),ct.value="500",g(ct,"class","slider svelte-fod5ym"),g(ct,"id","textOrder"),g(nt,"class","slider svelte-fod5ym"),g(ft,"for","manyBody"),g(ft,"class","svelte-fod5ym"),g(gt,"class","slider-value svelte-fod5ym"),g(dt,"class","slider-text svelte-fod5ym"),g(mt,"type","range"),g(mt,"min","0"),g(mt,"max","1000"),mt.value="500",g(mt,"class","slider svelte-fod5ym"),g(mt,"id","manyBody"),g(ht,"class","slider svelte-fod5ym"),g(bt,"for","collide"),g(bt,"class","svelte-fod5ym"),g($t,"class","slider-value svelte-fod5ym"),g(kt,"class","slider-text svelte-fod5ym"),g(Nt,"type","range"),g(Nt,"min","0"),g(Nt,"max","1000"),Nt.value="500",g(Nt,"class","slider svelte-fod5ym"),g(Nt,"id","collideRadius"),g(wt,"class","slider svelte-fod5ym"),g(jt,"class","slider-title svelte-fod5ym"),g(zt,"class","sep-line-horizontal svelte-fod5ym"),g(qt,"for","threshold"),g(qt,"class","svelte-fod5ym"),g(Ct,"class","slider-value svelte-fod5ym"),g(Ht,"class","slider-text svelte-fod5ym"),g(Wt,"type","range"),g(Wt,"min","0"),g(Wt,"max","1000"),Wt.value="500",g(Wt,"step","200"),g(Wt,"class","slider svelte-fod5ym"),g(Wt,"id","threshold"),g(Tt,"class","slider svelte-fod5ym"),g(W,"class","slider-container svelte-fod5ym"),m(W,"active",e[2]),g(v,"class","svg-control-panel svelte-fod5ym"),g(Xt,"class","graph-svg"),g(r,"class","svg-container svelte-fod5ym"),g(n,"class","graph-view svelte-fod5ym")},m(t,s){l(t,n,s),o(n,r),o(r,a),o(r,i),o(r,v),o(v,x),o(x,w),o(w,k),o(w,b),o(b,_);for(let t=0;t<Kt.length;t+=1)Kt[t].m(_,null);o(x,$),o(x,M),o(M,A),o(M,N),o(N,E);for(let t=0;t<Jt.length;t+=1)Jt[t].m(E,null);o(v,j),o(v,S),o(v,z),o(v,L),o(L,T),o(L,H),o(L,q),o(L,P),o(L,C),o(C,B);for(let t=0;t<ee.length;t+=1)ee[t].m(B,null);o(v,I),o(v,W),o(W,O),o(W,X),o(W,R),o(W,Y),o(W,D),o(W,F),o(W,U),o(U,V),o(V,G),o(V,Q),o(V,K),o(K,Z),o(U,J),o(U,tt),o(W,et),o(W,nt),o(nt,rt),o(rt,at),o(rt,it),o(rt,ot),o(ot,lt),o(nt,st),o(nt,ct),o(W,ut),o(W,ht),o(ht,dt),o(dt,ft),o(dt,pt),o(dt,gt),o(gt,yt),o(ht,vt),o(ht,mt),o(W,xt),o(W,wt),o(wt,kt),o(kt,bt),o(kt,_t),o(kt,$t),o($t,Mt),o(wt,At),o(wt,Nt),o(W,Et),o(W,jt),o(W,St),o(W,zt),o(W,Lt),o(W,Tt),o(Tt,Ht),o(Ht,qt),o(Ht,Pt),o(Ht,Ct),o(Ct,Bt),o(Tt,It),o(Tt,Wt),o(r,Ot),o(r,Xt),e[8](Xt),Rt||(Yt=p(T,"click",e[7]),Rt=!0)},p(t,e){if(0&e){let n;for(Qt=[...Array(12).keys()],n=0;n<Qt.length;n+=1){const r=Yo(t,Qt,n);Kt[n]?Kt[n].p(r,e):(Kt[n]=Do(r),Kt[n].c(),Kt[n].m(_,null))}for(;n<Kt.length;n+=1)Kt[n].d(1);Kt.length=Qt.length}if(0&e){let n;for(Zt=[...Array(12).keys()],n=0;n<Zt.length;n+=1){const r=Ro(t,Zt,n);Jt[n]?Jt[n].p(r,e):(Jt[n]=Fo(r),Jt[n].c(),Jt[n].m(E,null))}for(;n<Jt.length;n+=1)Jt[n].d(1);Jt.length=Zt.length}if(4&e[0]&&m(T,"active",t[2]),32&e[0]){let n;for(te=Object.values(t[5]),n=0;n<te.length;n+=1){const r=Xo(t,te,n);ee[n]?ee[n].p(r,e):(ee[n]=Uo(r),ee[n].c(),ee[n].m(B,null))}for(;n<ee.length;n+=1)ee[n].d(1);ee.length=te.length}24&e[0]&&Dt!==(Dt=(t[3].autoAttention?"auto":t[6](t[4].force.attention,2))+"")&&y(Z,Dt),16&e[0]&&Ft!==(Ft=t[6](t[4].force.textOrder,2)+"")&&y(lt,Ft),16&e[0]&&Ut!==(Ut=t[6](t[4].force.manyBody,2)+"")&&y(yt,Ut),16&e[0]&&Vt!==(Vt=t[6](t[4].force.collideRadius,2)+"")&&y(Mt,Vt),2&e[0]&&Gt!==(Gt=t[6](t[1],2)+"")&&y(Bt,Gt),4&e[0]&&m(W,"active",t[2])},i:t,o:t,d(t){t&&s(n),c(Kt,t),c(Jt,t),c(ee,t),e[8](null),Rt=!1,Yt()}}}const Go=19,Qo=.3;let Ko=.02,Zo="hsl(0, 0%, 76%)",Jo="hsl(36, 100%, 55%)";function tl(t,e,n){let r=void 0,a=1562,i=9,o=8,l={layer:9,head:8},s=null,c=null,u=null,h=null,d=void 0,f=void 0,p=null;const g=3,y=3,v=3,m=3;let x=null,w=null,k=1,_=.016,$=Ko+_*k,A={},N=null,E=new Map,j=null,S=null,z=!1,L=null;const T=Ea,H={force:{value:"force",name:"Force Layout"},radial:{value:"radial",name:"Radial Layout"},grid:{value:"grid",name:"Grid Layout"}};let q={borderConstraint:!0,showHiddenLink:!1,showHiddenNode:!1,autoAttention:!0,defaultLayout:H.radial},P={force:{manyBody:-840,attention:.5,textOrder:1.6,collideRadius:1},radial:{textOrder:.5,radial:1},grid:{collideRadius:7}},C=q.defaultLayout;const B=(t,e)=>Math.round((t+Number.EPSILON)*10**e)/10**e,I=(t,e)=>Array(Math.max(e-String(t).length+1,0)).join(0)+t,W=()=>function(){var t,e,n,r,a=an,i=on,o=ln,l=sn,s={},c=zt("start","drag","end"),u=0,h=0;function d(t){t.on("mousedown.drag",f).filter(l).on("touchstart.drag",y).on("touchmove.drag",v).on("touchend.drag touchcancel.drag",m).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function f(o,l){if(!r&&a.call(this,o,l)){var s=x(this,i.call(this,o,l),o,l,"mouse");s&&(Ge(o.view).on("mousemove.drag",p,!0).on("mouseup.drag",g,!0),tn(o.view),Ze(o),n=!1,t=o.clientX,e=o.clientY,s("start",o))}}function p(r){if(Je(r),!n){var a=r.clientX-t,i=r.clientY-e;n=a*a+i*i>h}s.mouse("drag",r)}function g(t){Ge(t.view).on("mousemove.drag mouseup.drag",null),en(t.view,n),Je(t),s.mouse("end",t)}function y(t,e){if(a.call(this,t,e)){var n,r,o=t.changedTouches,l=i.call(this,t,e),s=o.length;for(n=0;n<s;++n)(r=x(this,l,t,e,o[n].identifier,o[n]))&&(Ze(t),r("start",t,o[n]))}}function v(t){var e,n,r=t.changedTouches,a=r.length;for(e=0;e<a;++e)(n=s[r[e].identifier])&&(Je(t),n("drag",t,r[e]))}function m(t){var e,n,a=t.changedTouches,i=a.length;for(r&&clearTimeout(r),r=setTimeout((function(){r=null}),500),e=0;e<i;++e)(n=s[a[e].identifier])&&(Ze(t),n("end",t,a[e]))}function x(t,e,n,r,a,i){var l,h,f,p=c.copy(),g=Qe(i||n,e);if(null!=(f=o.call(t,new rn("beforestart",{sourceEvent:n,target:d,identifier:a,active:u,x:g[0],y:g[1],dx:0,dy:0,dispatch:p}),r)))return l=f.x-g[0]||0,h=f.y-g[1]||0,function n(i,o,c){var y,v=g;switch(i){case"start":s[a]=n,y=u++;break;case"end":delete s[a],--u;case"drag":g=Qe(c||o,e),y=u}p.call(i,t,new rn(i,{sourceEvent:o,subject:f,target:d,identifier:a,active:y,x:g[0]+l,y:g[1]+h,dx:g[0]-v[0],dy:g[1]-v[1],dispatch:p}),r)}}return d.filter=function(t){return arguments.length?(a="function"==typeof t?t:nn(!!t),d):a},d.container=function(t){return arguments.length?(i="function"==typeof t?t:nn(t),d):i},d.subject=function(t){return arguments.length?(o="function"==typeof t?t:nn(t),d):o},d.touchable=function(t){return arguments.length?(l="function"==typeof t?t:nn(!!t),d):l},d.on=function(){var t=c.on.apply(c,arguments);return t===c?d:t},d.clickDistance=function(t){return arguments.length?(h=(t=+t)*t,d):Math.sqrt(h)},d}().on("start",(t=>{t.active||N.alphaTarget(.3).restart(),t.subject.fx=t.subject.x,t.subject.fy=t.subject.y,Ge(t.sourceEvent.originalTarget.parentNode).append("rect").attr("class","fixed-marker").attr("x",-3).attr("y",6).attr("width",6).attr("height",5).style("fill","white")})).on("drag",(t=>{t.subject.fx=t.x,t.subject.fy=t.y})).on("end",(t=>{t.active||N.alphaTarget(0)})),O=(t,e)=>{let n=Go;t.hidden||(n=e(+t.saliency));let r=d-y-v,a=f-g-m;const i=Math.max(y+n,Math.min(r-n,t.x)),o=Math.max(g+n,Math.min(a-n,t.y));return q.borderConstraint?{top:o,left:i}:{top:t.y,left:t.x}},X=(t,e,r,a,i=null)=>{let o=Ge("#"+t).property("value",(a-e)/(r-e)*1e3);o.on("input",(()=>{let a=+o.property("value"),l=a/1e3*(r-e)+e,s=a/200;switch(n(4,P.force[t]=l,P),t){case"attention":N.force("attentionLink").strength(l),Ge("#checkbox-auto-attention").property("checked",!1),n(3,q.autoAttention=!1,q);break;case"textOrder":N.force("textLink").strength((t=>0===t.target.index?0:l));break;case"manyBody":N.force("charge").strength(l);break;case"collideRadius":N.force("collide").radius((t=>i(t.saliency)+l));break;case"threshold":n(1,$=Ko+s*_),G(s)}N.restart()})),o.on("mousedown",(t=>{t.active||N.alphaTarget(.2).restart()})),o.on("mouseup",(t=>{t.active||N.alphaTarget(0)}))},R=t=>{C=q.defaultLayout;let e=Ge("#select-layout").property("value",q.defaultLayout.value);e.on("change",(()=>{let n=e.property("value");if(n!==C.value){switch(N.force("collide",null),N.force("attentionLink",null),N.force("charge",null),N.force("center",null),N.force("textLink",null),N.force("hiddenTextLink",null),N.force("posX",null),N.force("posY",null),N.force("grid",null),n){case"force":C=H.force,D(t),N.alpha(1).restart();break;case"radial":C=H.radial,F(),N.alpha(1).restart();break;case"grid":C=H.grid,U(),N.alpha(1).restart()}Y(t)}N.alpha(1).restart()}))};ut.subscribe((t=>{l=t,l.layer===i&&l.head===o||(Ge("#select-layer").property("value",l.layer),Ge("#select-head").property("value",l.head),i=l.layer,o=l.head,et())}));const Y=t=>{Ge(s).select("g.node-group").selectAll("circle").transition("node-radius").duration(300).ease(T).attr("r",(e=>"force"===C.value?t(+e.saliency):Go))},D=t=>{N.force("charge",function(){var t,e,n,r,a,i=Ua(-30),o=1,l=1/0,s=.81;function c(n){var a,i=t.length,o=Ra(t,ei,ni).visitAfter(h);for(r=n,a=0;a<i;++a)e=t[a],o.visit(d)}function u(){if(t){var e,n,r=t.length;for(a=new Array(r),e=0;e<r;++e)n=t[e],a[n.index]=+i(n,e,t)}}function h(t){var e,n,r,i,o,l=0,s=0;if(t.length){for(r=i=o=0;o<4;++o)(e=t[o])&&(n=Math.abs(e.value))&&(l+=e.value,s+=n,r+=n*e.x,i+=n*e.y);t.x=r/s,t.y=i/s}else{(e=t).x=e.data.x,e.y=e.data.y;do{l+=a[e.data.index]}while(e=e.next)}t.value=l}function d(t,i,c,u){if(!t.value)return!0;var h=t.x-e.x,d=t.y-e.y,f=u-i,p=h*h+d*d;if(f*f/s<p)return p<l&&(0===h&&(p+=(h=Va(n))*h),0===d&&(p+=(d=Va(n))*d),p<o&&(p=Math.sqrt(o*p)),e.vx+=h*t.value*r/p,e.vy+=d*t.value*r/p),!0;if(!(t.length||p>=l)){(t.data!==e||t.next)&&(0===h&&(p+=(h=Va(n))*h),0===d&&(p+=(d=Va(n))*d),p<o&&(p=Math.sqrt(o*p)));do{t.data!==e&&(f=a[t.data.index]*r/p,e.vx+=h*f,e.vy+=d*f)}while(t=t.next)}}return c.initialize=function(e,r){t=e,n=r,u()},c.strength=function(t){return arguments.length?(i="function"==typeof t?t:Ua(+t),u(),c):i},c.distanceMin=function(t){return arguments.length?(o=t*t,c):Math.sqrt(o)},c.distanceMax=function(t){return arguments.length?(l=t*t,c):Math.sqrt(l)},c.theta=function(t){return arguments.length?(s=t*t,c):Math.sqrt(s)},c}().strength(P.force.manyBody)),N.force("center",function(t,e){var n,r=1;function a(){var a,i,o=n.length,l=0,s=0;for(a=0;a<o;++a)l+=(i=n[a]).x,s+=i.y;for(l=(l/o-t)*r,s=(s/o-e)*r,a=0;a<o;++a)(i=n[a]).x-=l,i.y-=s}return null==t&&(t=0),null==e&&(e=0),a.initialize=function(t){n=t},a.x=function(e){return arguments.length?(t=+e,a):t},a.y=function(t){return arguments.length?(e=+t,a):e},a.strength=function(t){return arguments.length?(r=+t,a):r},a}(d/2,f/2)),N.force("attentionLink",Ja(A[k].links).id((t=>t.id))),N.force("textLink",Ja(A[k].hiddenLinks).id((t=>t.id)).strength((t=>0===t.target.index?0:P.force.textOrder))),N.force("collide",function(t){var e,n,r,a=1,i=1;function o(){for(var t,o,s,c,u,h,d,f=e.length,p=0;p<i;++p)for(o=Ra(e,Ga,Qa).visitAfter(l),t=0;t<f;++t)s=e[t],h=n[s.index],d=h*h,c=s.x+s.vx,u=s.y+s.vy,o.visit(g);function g(t,e,n,i,o){var l=t.data,f=t.r,p=h+f;if(!l)return e>c+p||i<c-p||n>u+p||o<u-p;if(l.index>s.index){var g=c-l.x-l.vx,y=u-l.y-l.vy,v=g*g+y*y;v<p*p&&(0===g&&(v+=(g=Va(r))*g),0===y&&(v+=(y=Va(r))*y),v=(p-(v=Math.sqrt(v)))/v*a,s.vx+=(g*=v)*(p=(f*=f)/(d+f)),s.vy+=(y*=v)*p,l.vx-=g*(p=1-p),l.vy-=y*p)}}}function l(t){if(t.data)return t.r=n[t.data.index];for(var e=t.r=0;e<4;++e)t[e]&&t[e].r>t.r&&(t.r=t[e].r)}function s(){if(e){var r,a,i=e.length;for(n=new Array(i),r=0;r<i;++r)a=e[r],n[a.index]=+t(a,r,e)}}return"function"!=typeof t&&(t=Ua(null==t?1:+t)),o.initialize=function(t,n){e=t,r=n,s()},o.iterations=function(t){return arguments.length?(i=+t,o):i},o.strength=function(t){return arguments.length?(a=+t,o):a},o.radius=function(e){return arguments.length?(t="function"==typeof e?e:Ua(+e),s(),o):t},o}().radius((e=>t(e.saliency)+P.force.collideRadius)))},F=()=>{N.force("textLink",Ja(A[k].hiddenLinks).id((t=>t.id)).strength(P.radial.textOrder)),N.force("posY",oi().y(((t,e)=>{let n=w.filter((t=>!t.hidden)).length,r=-Math.PI/2+e*(2*Math.PI/n);return f/2+225*Math.sin(r)})).strength(P.radial.radial)),N.force("posX",ii().x(((t,e)=>{let n=w.filter((t=>!t.hidden)).length,r=-Math.PI/2+e*(2*Math.PI/n);return d/2+225*Math.cos(r)})).strength(P.radial.radial))},U=()=>{let t=8,e=Math.ceil(x/t),n=549,r=2*e*Go+35*(e-1);for(;r>f;)if(t=9,n=549,r=2*e*Go+35*(e-1),n>d){console.log("Failed to initialize grid layout");break}let a=Math.floor((d-n)/2),i=Math.floor((f-r)/2);N.force("grid",Ja(A[k].gridLinks).iterations(80).distance(50).id((t=>t.id))),N.force("posX",ii().x(((t,e)=>a+e%8*73+Go)).strength((t=>void 0===t.id?0:1))),N.force("posY",oi().y(((t,e)=>i+73*Math.floor(e/8)+Go)).strength((t=>void 0===t.id?0:1)))},G=t=>{k=t;let e=Ge(s).select("g.attention-link-group").selectAll("path.link").data(A[k].biLinks,(t=>`${t[0].id}-${t[1].id}`));e.enter().append("path").attr("marker-end","url(#arrow)").attr("class","link").attr("id",(t=>`link-${t[0].id}-${t[1].id}`)).style("stroke","hsl(150, 74%, 51%)").style("stroke-width",(t=>j(t.attention))).transition().duration(900).ease(T).style("stroke",Zo),e.exit().style("stroke","hsl(349, 81%, 57%)").transition().duration(900).ease(T).style("opacity",0).on("end",((t,e,n)=>{Ge(n[e]).remove()})),N.nodes(A[k].nodes),N.alpha(1).restart()},Q=(t,e,n)=>{t=t.map((t=>Object.create(t)));let r=w.slice(),a=[];for(let t=0;t<r.length-1;t++){let e={source:+r[t].id,target:+r[t+1].id};a.push(e)}a.push({source:+r[r.length-1].id,target:r[0].id}),a=a.map((t=>Object.create(t)));let i=[];t.forEach((n=>{let a=e.get(n.source),o=e.get(n.target),l=[a,o];if(l.selfLoop=!1,l.attention=+n.weight,a===o){l.selfLoop=!0;let e={hidden:!0};E.has(a)?e=E.get(a):E.set(a,e),l.push(e),r.push(e),t.push({source:e,target:a})}i.push(l)}));let o=[];n.sort(((t,e)=>+t-+e));for(let t=0;t<r.length;t++)t%8!=7&e.has(t+1)&&o.push({source:e.get(t),target:e.get(t+1)}),e.has(t+8)&&o.push({source:e.get(t),target:e.get(t+8)});return{links:t,hiddenLinks:a,biLinks:i,gridLinks:o,nodes:r}},K=(t,e,n,r,a,i,o,l)=>{let s=Ge(t.target).data()[0].id;for(let t=A[k].nodes.length-1;t>=0;t--)A[k].nodes[t].id===s&&A[k].nodes.splice(t,1);e.selectAll("g.node").data(A[k].nodes.filter((t=>void 0!==t.id)),(t=>t.id)).exit().remove();for(let t=A[k].biLinks.length-1;t>=0;t--)A[k].biLinks[t][0].id===s|A[k].biLinks[t][1].id===s&&A[k].biLinks.splice(t,1);for(let t=A[k].links.length-1;t>=0;t--)A[k].links[t].source.id===s|A[k].links[t].target.id===s&&A[k].links.splice(t,1);for(let t=A[k].hiddenLinks.length-1;t>=0;t--)A[k].hiddenLinks[t].source.id===s?A[k].hiddenLinks.splice(t,1):A[k].hiddenLinks[t].target.id===s&&(t+1<A[k].hiddenLinks.length?A[k].hiddenLinks[t].target=A[k].hiddenLinks[t+1].source:A[k].hiddenLinks[t].target=A[k].hiddenLinks[0].source);A[k].gridLinks=[],a=new Set,A[k].nodes.forEach((t=>{void 0!==t.id&&a.add(+t.id)})),(r=Array.from(a)).sort(((t,e)=>+t-+e));for(let t=0;t<r.length-1;t++){let e=r[t];t%8!=7&o.has(r[t+1])&&A[k].gridLinks.push({source:o.get(e),target:o.get(r[t+1])}),o.has(r[t+8])&&A[k].gridLinks.push({source:o.get(e),target:o.get(r[t+8])})}n.selectAll("path.link").data(A[k].biLinks,(t=>`${t[0].id}-${t[1].id}`)).exit().remove(),(t=>{switch(C.value){case"force":D(t);break;case"radial":F();break;case"grid":U()}})(i),l.alpha(.3).restart()},Z=t=>{let e=Ge(s).select("g.attention-link-group").selectAll("path.link");switch(C.value){case"force":e.attr("d",(e=>((t,e)=>{const n=O(t[0],e),r=O(t[1],e);if(t.selfLoop){const a=O(t[2],e);let i=Math.sqrt((r.left-a.left)**2+(r.top-a.top)**2)-e(t[0].saliency);a.left=r.left+(a.left-r.left)/i*80,a.top=r.top+(a.top-r.top)/i*80;const o=[a.left-n.left,a.top-n.top],l=Math.sqrt(o[0]**2+o[1]**2),s=50,c=[-o[1]/l*s,o[0]/l*s],u=[o[1]/l*s,-o[0]/l*s],h=[n.left+o[0]+c[0],n.top+o[1]+c[1]],d=[n.left+o[0]+u[0],n.top+o[1]+u[1]];let f=Math.sqrt((r.left-d[0])**2+(r.top-d[1])**2),p=(e(t[0].saliency)+10)/f,g={left:r.left+(d[0]-r.left)*p,top:r.top+(d[1]-r.top)*p};return"M"+n.left+","+n.top+"C"+h[0]+","+h[1]+" "+d[0]+","+d[1]+" "+g.left+","+g.top}{let a=Math.sqrt((r.left-n.left)**2+(r.top-n.top)**2),i=(e(t[1].saliency)+10)/a,o={left:r.left+(n.left-r.left)*i,top:r.top+(n.top-r.top)*i};return"M"+n.left+","+n.top+"L"+o.left+","+o.top}})(e,t)));break;case"radial":e.attr("d",(e=>((t,e)=>{const n=O(t[0],e),r=O(t[1],e);let a=n.left,i=n.top,o=r.left,l=r.top,s=d/2,c=f/2+40,u=1-29/225,h=s+(o-s)*u,p=c+(l-c)*u,g=s+(a-s)*u,y=c+(i-c)*u;return`M ${g},${y} C${s+(g-s)*Qo}, ${c+(y-s)*Qo},\n      ${s+(h-s)*Qo}, ${c+(p-s)*Qo}, ${h},${p}`})(e,t)));break;case"grid":e.attr("d",(e=>((t,e)=>{const n=O(t[0],e),r=O(t[1],e);let a=29/Math.sqrt((r.left-n.left)**2+(r.top-n.top)**2),i=r.left+(n.left-r.left)*a,o=r.top+(n.top-r.top)*a;return"M"+n.left+","+n.top+"L"+i+","+o})(e,t)));break;default:console.log("Unexpected case.")}Ge(s).select("g.node-group").selectAll("g.node").attr("transform",(e=>((t,e)=>{const n=O(t,e);return`translate(${n.left}, ${n.top})`})(e,t)))},J=()=>{let t=Ge(s),e=c.nodes.map((t=>Object.create(t)));e.sort(((t,e)=>+t.id-+e.id));let n={};e.forEach((t=>{let e=0;void 0===n[t.token]?n[t.token]=e+1:(e=n[t.token],n[t.token]+=1),t.name=`${nt(t.token)}-${e}`})),w=e.slice();let r=new Set;c.nodes.forEach((t=>r.add(+t.id)));let a=Array.from(r),i=new Map(e.map((t=>[t.id,t])));A={};for(let t=0;t<6;t++){let e=B(Ko+t*_,2),n=c.links.filter((t=>t.weight>e)),r=Q(n,i,a);A[t]={links:r.links.slice(),hiddenLinks:r.hiddenLinks.slice(),biLinks:r.biLinks.slice(),gridLinks:r.gridLinks.slice(),nodes:r.nodes.slice()}}let o=e.map((t=>+t.saliency));S=Ji().domain(pt(o)).range([Go,40]).unknown(0).nice();let l=xt(o.map(Math.abs)),u="#E50035",h="#ffffff",g=Ji().domain([0,l]).range([zn(h),zn(u)]).unknown(zn("white")),v=A[0].links.map((t=>+t.weight));j=Ji().domain(pt(v)).range([.5,3]).nice();let m=t.append("g").attr("class","attention-link-group").attr("stroke",Zo);m.selectAll("path.link").data(A[k].biLinks,(t=>`${t[0].id}-${t[1].id}`)).join("path").attr("class","link").attr("id",(t=>`link-${t[0].name}-${t[1].name}`)).attr("marker-end","url(#arrow)").style("stroke-width",(t=>j(t.attention)));let x=t.append("g").attr("class","node-group"),b=x.selectAll("g.node").data(A[k].nodes.filter((t=>void 0!==t.id)),(t=>t.id)).join("g").attr("class","node").attr("id",(t=>"node-"+t.name)).attr("transform",`translate(${d/2}, ${f/2})`).call(W()).on("mouseover",((t,e)=>{p=e.name,at.set(p),ot(p)})).on("mouseleave",(()=>{lt(p),p=null,at.set(p)})).on("click",((t,e)=>{null!==e.fx&&null!==e.fy&&(delete e.fx,delete e.fy,Ge(t.target.parentNode).selectAll("rect.fixed-marker").remove(),N.alpha(.2).restart())})).on("dblclick",(t=>K(t,x,m,a,r,S,i,N)));Ji().domain(pt(r)).range([zn("#D4E5F4"),zn("#1E6CB0")]);b.append("circle").attr("class","node-circle").attr("r",(t=>"force"===C.value?S(+t.saliency):Go)).style("fill",(t=>g(+t.saliency))).style("opacity",1).clone(!0).attr("r",(t=>"force"===C.value?S(+t.saliency):Go)).style("fill",Jo).attr("class","shadow-circle");switch(((t,e,n,r="#eb2f06",a="#4690C2")=>{let i=t.append("defs").append("linearGradient").attr("x1",0).attr("y1",1).attr("x2",0).attr("y2",0).attr("id","legend-gradient-graph");i.append("stop").attr("stop-color",r).attr("offset",0),i.append("stop").attr("stop-color",a).attr("offset",1),t.append("rect").attr("x",0).attr("y",0).attr("width",e.width).attr("height",e.height).style("fill","url(#legend-gradient-graph)").style("stroke","black");let o=Ji().domain([0,n]).range([e.height,0]).nice();t.append("g").attr("transform",`translate(${e.width}, 0)`).call(jt(o).ticks(5)),t.append("text").attr("x",0).attr("y",e.height+8).style("font-size","12px").style("fill","hsl(0, 0%, 40%)").style("dominant-baseline","hanging").style("text-anchor","left").text("Semantic Saliency Score")})(t.append("g").attr("class","legend-group").attr("transform",`translate(${y+3}, ${f-130})`),{width:10,height:100},l,h,u),b.append("text").attr("class","node-text").style("font-weight",600).text((t=>t.token)).filter((t=>tr(g(+t.saliency)).l<66)).clone(!0).lower().style("stroke-linejoin","round").attr("stroke-width",4).attr("stroke","white"),b.selectAll("circle").lower(),b.append("title").text((t=>t.token)),null==N?N=ai(A[k].nodes):(N.nodes(A[k].nodes),N.alpha(1).restart()),C.value){case"force":D(S);break;case"radial":F();break;case"grid":U()}return N.on("tick",(()=>Z(S))),S},tt=()=>{let t=Ge(s).attr("width",d).attr("height",f);t.append("rect").attr("class","border-rect").attr("width",d).attr("height",f).style("stroke","black").style("fill","none"),t.append("defs").append("marker").attr("id","arrow").attr("viewBox",[0,0,10,10]).attr("refX",0).attr("refY",5).attr("markerWidth",12).attr("markerHeight",9).attr("orient","auto").attr("stroke-width",1).attr("markerUnits","userSpaceOnUse").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("stroke",Zo).attr("fill",Zo),t.append("defs").append("marker").attr("id","arrow-hover").attr("viewBox",[0,0,10,10]).attr("refX",0).attr("refY",5).attr("markerWidth",12).attr("markerHeight",9).attr("orient","auto").attr("stroke-width",1).attr("markerUnits","userSpaceOnUse").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("stroke",Jo).attr("fill",Jo),S=J(),X("attention",0,10,P.force.attention),X("textOrder",0,10,P.force.textOrder),X("manyBody",-2e3,0,P.force.manyBody),X("collideRadius",0,20,P.force.collideRadius,S),X("threshold",Ko,.1,$,S),R(S),(()=>{let t=Ge("#select-layer").property("value",i),e=Ge("#select-head").property("value",o);t.on("change",(()=>{let e=t.property("value");e!==i&&(i=e,et(),l.layer=+i,l.head=+o,ut.set(l))})),e.on("change",(()=>{let t=e.property("value");t!==o&&(o=t,et(),l.layer=+i,l.head=+o,ut.set(l))}))})()},et=()=>{Ge(s).select("g.node-group").remove(),Ge(s).select("g.attention-link-group").remove(),Ge(s).select("g.legend-group").remove(),c=st(i,o),J()},nt=t=>null==t?null:t.replace(/\./g,"\\.").replace(/,/g,"\\,").replace(/#/g,"").replace(/\[/g,"\\[").replace(/\]/g,"\\]"),ot=t=>{Ge(s).select(".attention-link-group").selectAll("path.link").style("opacity",.2),Ge(s).select(".attention-link-group").selectAll("path.link").filter(((e,n,r)=>Ge(r[n]).attr("id").includes("-"+t))).attr("marker-end","url(#arrow-hover)").classed("highlighted",!0).style("stroke",null).style("stroke-width",2).style("opacity",.8).raise(),Ge(s).select(".node-group").selectAll(".node").filter(((e,n,r)=>Ge(r[n]).attr("id").includes("-"+t))).raise().select(".shadow-circle").attr("r",(t=>"force"===C.value?S(+t.saliency)+5:24)).style("stroke","white").style("stroke-width",1.5)},lt=t=>{Ge(s).select(".attention-link-group").selectAll("path.link").style("opacity",null),Ge(s).select(".attention-link-group").selectAll("path.link").filter(((e,n,r)=>Ge(r[n]).attr("id").includes("-"+t))).classed("highlighted",!1).attr("marker-end","url(#arrow)").style("stroke",Zo).style("stroke-width",(t=>j(t.attention))).style("opacity",null),Ge(s).select(".node-group").selectAll(".node").filter(((e,n,r)=>Ge(r[n]).attr("id").includes("-"+t))).select(".shadow-circle").attr("r",(t=>"force"===C.value?S(+t.saliency):Go)).style("stroke",null).style("stroke-width",null).lower()},st=(t,e)=>{let n=L[t][e],r={nodes:[],links:[]},i=u[String(a)].meta.predicted_label;u[String(a)].tokens.forEach(((t,e)=>{r.nodes.push({token:t.token,saliency:t[i],id:e})}));for(let t=0;t<r.nodes.length;t++)for(let e=0;e<r.nodes.length;e++)r.links.push({source:t,target:e,weight:n[t][e]});return r};at.subscribe((t=>{null!=t?(p=t,void 0!==h[p.replace(/(.*)-\d*/,"$1")]?h[p.replace(/(.*)-\d*/,"$1")].forEach((t=>{ot(t)})):ot(p)):(null!=p&&(void 0!==h[p.replace(/(.*)-\d*/,"$1")]?h[p.replace(/(.*)-\d*/,"$1")].forEach((t=>{lt(t)})):lt(p)),p=t)}));const ct=async()=>{null==L&&(L=await Ba(`/dodrio/data/sst2-attention-data/attention-${I(a,4)}.json`)),null==u&&(u=await Ba("/dodrio/data/sst2-saliency-list-grad-l1.json"),x=u[a].tokens.length),c=st(i,o),tt()};return b((async()=>{null==L&&(L=await Ba(`/dodrio/data/sst2-attention-data/attention-${I(a,4)}.json`)),null==u&&(u=await Ba("/dodrio/data/sst2-saliency-list-grad-l1.json"),x=u[a].tokens.length)})),V.subscribe((t=>{void 0!==t.compHeight&&void 0!==t.compWidth&&(void 0===r||r.compHeight!==t.compHeight&&r.compWidth!==t.compWidth)&&(r=t,f=r.compHeight,d=r.compWidth,ct())})),it.subscribe((t=>{h=t})),rt.subscribe((t=>{t!==a&&(Ge(s).selectAll("*").remove(),L=null,u=null,a=t,ct())})),[s,$,z,q,P,H,B,()=>{n(2,z=!z)},function(t){M[t?"unshift":"push"]((()=>{s=t,n(0,s)}))}]}class el extends R{constructor(t){super(),X(this,t,tl,Vo,i,{},[-1,-1,-1])}}const nl=(t,e,n="1em")=>{let r={},a=null,i=e.append("g").attr("class","hidden-text").style("opacity",0),o=i.selectAll(".text-token").data(t).join("text").attr("class","text-token").style("font-size",n).text((t=>t));return o.each((function(t,e){let n=this.getBBox();r[e]=+Number(n.width).toFixed(2),null==a&&(a=n.height)})),i.remove(),o.remove(),{textTokenWidths:r,textTokenHeight:a}},rl=t=>null==t?null:t.replace(/\./g,"\\.").replace(/,/g,"\\,").replace(/#/g,"").replace(/\[/g,"\\[").replace(/\]/g,"\\]"),al=t=>"[CLS]"===t||"[SEP]"===t||"[PAD]"===t,il=(t,e)=>{t.attr("width",e).select("rect.border-rect").attr("width",e),Ge(".instance-container").select(".panel-container").style("width",e+"px")},ol=(t,e)=>Math.round((t+Number.EPSILON)*10**e)/10**e,ll=(t,e,n,r,a,i,o,l)=>{if(void 0!==t.tokens[0].id){let e={};t.tokens.forEach((t=>{let n=0;void 0===e[t.token]?e[t.token]=n+1:(n=e[t.token],e[t.token]+=1),t.id=`${rl(t.token)}-${n}`}))}let s=t.tokens,c=t.meta.predicted_label,u=xt(t.tokens.map((t=>Math.abs(t[c])))),h=Ji().domain([0,u]).range([zn("#ffffff"),zn("#E50035")]),d=nl(s.map((t=>t.token)),e),f=d.textTokenWidths,p=d.textTokenHeight,g=.8*n;const y=p+a.top+a.bottom+10;let v=e.append("g").attr("class","token-group-saliency").attr("transform",`translate(${r.left+n*(1-.8)/2},\n      ${r.top+70})`).append("g").attr("class","node-group").selectAll("g").data(s,(t=>t.id)).join("g").attr("class",(t=>{let e="node node-"+t.id;return void 0!==i[t.token]&&i[t.token].forEach((t=>{e+=" node-"+t})),e})).attr("id",(t=>"node-"+t.id)).on("mouseover",o).on("mouseleave",l),m={x:0,y:0},x=Object.keys(f).length;v.each((function(t,e){Ge(this).attr("transform",`translate(${m.x}, ${m.y})`);let n=m.x+f[e]+a.left+a.right+5;e+1<x&&(n+=f[e+1]),n>g?(m.y+=y,m.x=0):m.x=m.x+f[e]+a.left+a.right+5})),v.append("rect").attr("width",((t,e)=>f[e]+a.left+a.right)).attr("height",p+a.top+a.bottom).attr("rx",5).style("fill",(t=>h(+t[c]))).style("stroke","hsl(180, 1%, 80%)"),v.append("text").attr("class","text-token-arc").attr("x",a.left).attr("y",a.top+2).style("pointer-events","none").text((t=>t.token));let w=e.append("g").attr("class","legend-group").attr("transform",`translate(${r.left+10+.9*n},\n      ${r.top+50})`);sl(w,{width:10,height:150},u)},sl=(t,e,n)=>{let r=t.append("defs").append("linearGradient").attr("x1",0).attr("y1",1).attr("x2",0).attr("y2",0).attr("id","legend-gradient");r.append("stop").attr("stop-color","#FFFFFF").attr("offset",0),r.append("stop").attr("stop-color","#E50035").attr("offset",1),t.append("rect").attr("x",0).attr("y",0).attr("width",e.width).attr("height",e.height).style("fill","url(#legend-gradient)").style("stroke","black");let a=Ji().domain([0,n]).range([e.height,0]).nice();t.append("g").attr("transform",`translate(${e.width}, 0)`).call(jt(a).ticks(10)),t.append("text").attr("x",5).attr("y",-15).style("font-size","12px").style("dominant-baseline","end").style("text-anchor","middle").text("Saliency Score")},cl=(t,e,n,r,a,i,o,l,s,c,u)=>{const h=t.list;let d=t.words.map((t=>({token:t})));if(void 0===e.tokens[0].id){let t={};e.tokens.forEach((e=>{let n=0;void 0===t[e.token]?t[e.token]=n+1:(n=t[e.token],t[e.token]+=1),e.id=`${rl(e.token)}-${n}`}))}console.log(e,d),null==n&&(n=u(d,e)),console.log(n);let f={};d.forEach((t=>{let e=0;void 0===f[t.token]?f[t.token]=e+1:(e=f[t.token],f[t.token]+=1),t.id=`${rl(t.token)}-${e}`}));let p=nl(d.map((t=>t.token)),r),g=p.textTokenWidths,y=p.textTokenHeight;a={};let v=0;d.forEach(((t,e)=>{a[e]=v,v+=g[e]+5+i.left+i.right}));let m=v+o.left+o.right-5;il(r,m);let x=r.append("g").attr("class","token-group").attr("transform",`translate(${o.left}, ${o.top})`),w=x.append("g").attr("class","node-group").selectAll("g").data(d).join("g").attr("class",(t=>{let e="node node-"+t.id;return void 0!==n[t.token]&&n[t.token].forEach((t=>{e+=" node-"+t})),e})).attr("id",(t=>"node-"+t.id)).attr("data-id",(t=>t.id)).attr("transform",((t,e)=>`translate(${a[e]}, 0)`)).on("mouseover",s).on("mouseleave",c);w.append("rect").attr("width",((t,e)=>g[e]+i.left+i.right)).attr("height",y+i.top+i.bottom).attr("rx",5),w.append("text").attr("class","text-token-arc").attr("x",i.left).attr("y",i.top+2).style("pointer-events","none").text((t=>t.token));let k=[];h.forEach((t=>{let e=Math.abs(t.child-t.parent),n=void 0,r=void 0,o=void 0;t.parent<t.child?(r=a[t.parent]+i.left+i.right+g[t.parent]-5,o=a[t.child]+5,n=r+(o-r)/2):(r=a[t.parent]+5,o=a[t.child]+i.left+i.right+g[t.child]-5,n=o+(r-o)/2),t.sourceX=r,t.targetX=o,t.middleX=Number.isNaN(n)?0:n,t.gap=e,k.push(t)})),k.sort(((t,e)=>t.gap-e.gap));let b=Array(d.length).fill(1),_={};k.forEach((t=>{if("root"!==t.relation){let e=Math.min(t.child,t.parent),n=Math.max(t.child,t.parent),r=b.slice(e,n+1).reduce(((t,e)=>Math.max(t,e)));b[Math.min(t.child,t.parent)]=r+1,void 0===_[r]&&(_[r]=[]),_[r].push(t)}}));let $=x.append("g").attr("class","arc-group").attr("transform",`translate(0, ${y+i.top+i.bottom})`);return Object.keys(_).forEach(((t,e)=>{$.append("g").attr("class","arc-group-path").selectAll("path.arc-path-"+e).data(_[t],(t=>`${t.parent}-${t.child}`)).join("path").attr("class",(t=>{let r=`arc-path arc-path-${e} arc-path-${d[t.parent].id}-${d[t.child].id}`;return void 0!==n[d[t.parent].token]&&n[d[t.parent].token].forEach((e=>{r+=` arc-path-${e}-${d[t.child].id}`})),void 0!==n[d[t.child].token]&&n[d[t.child].token].forEach((e=>{r+=` arc-path-${d[t.parent].id}-${e}`})),r})).classed("arc-path--lr",(t=>t.parent<t.child)).classed("arc-path--rl",(t=>t.parent>t.child)).attr("id",(t=>`arc-path-${d[t.parent].id}-${d[t.child].id}`)).attr("d",(t=>{let n=t.sourceX,r=t.targetX,a=15*(e+1),i=0===e?5:15;return`M${n} 0\n            L${n} ${a-i}\n            Q${n<r?n+0:n-0} ${a}, ${n<r?n+i:n-i} ${a}\n            L${n<r?r-i:r+i} ${a}\n            Q${n<r?r-0:r+0} ${a}, ${r} ${a-i}\n            L${r} 3`})),$.append("g").attr("class","arc-group-text").selectAll("text.arc-path-text-"+e).data(_[t],(t=>`${t.parent}-${t.child}`)).join("text").attr("class",(t=>{let r=`arc-text arc-path-text-${e} arc-path-text-${d[t.parent].id}-${d[t.child].id}`;return void 0!==n[d[t.parent].token]&&n[d[t.parent].token].forEach((e=>{r+=` arc-path-text-${e}-${d[t.child].id}`})),void 0!==n[d[t.child].token]&&n[d[t.child].token].forEach((e=>{r+=` arc-path-text-${d[t.parent].id}-${e}`})),r})).attr("x",(t=>t.middleX)).attr("y",15*(e+1)-1).text((t=>"root"===t.relation?"":t.relation)).clone(!0).lower().attr("class",`arc-text arc-path-text-${e} shadow`).attr("stroke-width",5).attr("stroke","white"),$.selectAll(".arc-group-path").lower()})),{tokenXs:a,textTokenWidths:g}};let ul={},hl={};lt.subscribe((t=>{hl=t}));let dl=new Map;ot.subscribe((t=>{dl=t}));const fl=(t,e,n,r,a,i=.02)=>{let o=n[t][e],l=new Map,s=new Map,c=r.words.map((t=>({token:t}))),u=0;for(;al(a.tokens[u].token);)u+=1;for(let t=0;t<c.length;t++){if(c[t].token!==a.tokens[u].token){let e=[],n=t+1<c.length?c[t+1].token:null;for(;a.tokens[u].token!==n;)e.push(u),s.set(u,t),u+=1;l.set(e[0],e)}else s.set(u,t),u+=1}let h=[];for(let t=0;t<a.tokens.length;t++){if(al(a.tokens[t].token))continue;let e=null,n=-1,r=o[t];if(l.has(t)){let e=l.get(t);for(let t=0;t<r.length;t++){let n=0;for(let r=0;r<e.length;r++)n+=o[r][t];r[t]=n/e.length}t=e[e.length-1]}for(let t=0;t<a.tokens.length;t++){if(al(a.tokens[t].token))continue;let i=0;l.has(t)?l.get(t).forEach((e=>{t=e,i+=r[t]})):i=r[t],i>n&&(e=s.get(t),n=i)}n>i&&h.push({parent:s.get(t),child:e})}return h},pl=(t,e,n,r)=>{let a=[];t.forEach((t=>{let i=Math.abs(t.child-t.parent),o=void 0,l=void 0,s=void 0;t.parent<t.child?(l=e[t.parent]+n.left+n.right+r[t.parent]-5,s=e[t.child]+5,o=l+(s-l)/2):(l=e[t.parent]+5,s=e[t.child]+n.left+n.right+r[t.child]-5,o=s+(l-s)/2),t.sourceX=ol(l,3),t.targetX=ol(s,3),t.middleX=Number.isNaN(o)?0:o,t.gap=i,a.push(t)})),a.sort(((t,e)=>t.gap-e.gap));let i=Array(Object.keys(e).length).fill(1),o={};return a.forEach((t=>{let e=Math.min(t.child,t.parent),n=Math.max(t.child,t.parent);if(e!==n){let r=i.slice(e,n).reduce(((t,e)=>Math.max(t,e)));for(let t=e;t<n;t++)i[t]=r+1;void 0===o[r]&&(o[r]=[]),o[r].push(t)}})),o},gl=(t,e,n,r,a,i,o)=>{Object.keys(t).forEach(((l,s)=>{e.append("g").attr("class","attention-group-path").selectAll("path.attention-path-"+s).data(t[l],(t=>`${t.parent}-${t.child}`)).join("path").attr("class",(t=>{let e=`attention-path attention-path-${s} attention-path-${o[t.parent].id}-${o[t.child].id}`;return void 0!==i[o[t.parent].token]&&i[o[t.parent].token].forEach((n=>{e+=` attention-path-${n}-${o[t.child].id}`})),void 0!==i[o[t.child].token]&&i[o[t.child].token].forEach((n=>{e+=` attention-path-${o[t.parent].id}-${n}`})),e})).classed("matched-attention-path",(t=>a.has(String([t.parent,t.child])))).classed("attention-path--lr",(t=>t.parent<t.child)).classed("attention-path--rl",(t=>t.parent>t.child)).style("width",.5).attr("d",(t=>{let e=t.sourceX,a=t.targetX,i=r?0:n,o=5*(s+1),l=0===s?4:7;return`M${e} ${i}\n            L${e} ${i+o-l}\n            Q${e<a?e+0:e-0} ${i+o}, ${e<a?e+l:e-l} ${i+o}\n            L${e<a?a-l:a+l} ${i+o}\n            Q${e<a?a-0:a+0} ${i+o}, ${a} ${i+o-l}\n            L${a} ${i}`}))}))},yl=(t,e,n,r,a,i=.02)=>{let o=n[t][e],l=new Map,s=new Map,c=r.words.map((t=>({token:t}))),u=0;for(;al(a.tokens[u].token);)u+=1;for(let t=0;t<c.length;t++){if(c[t].token!==a.tokens[u].token){let e=[],n=t+1<c.length?c[t+1].token:null;for(;a.tokens[u].token!==n;)e.push(u),s.set(u,t),u+=1;l.set(e[0],e)}else s.set(u,t),u+=1}let h=[];for(let t=0;t<a.tokens.length;t++){if(al(a.tokens[t].token))continue;let e=o[t];if(l.has(t)){let n=l.get(t);for(let t=0;t<e.length;t++){let r=0;for(let e=0;e<n.length;e++)r+=o[e][t];e[t]=r/n.length}t=n[n.length-1]}for(let n=0;n<a.tokens.length;n++){if(al(a.tokens[n].token))continue;let r=0;if(l.has(n)?l.get(n).forEach((t=>{n=t,r+=e[n]})):r=e[n],r>i){let e=s.get(n);h.push({parent:s.get(t),child:e,attention:r})}}}return h},vl=(t,e,n,r)=>{let a=[];return t.forEach((t=>{let i=Math.abs(t.child-t.parent),o=e[t.parent]+n.left+r[t.parent]/2,l=e[t.child]+n.left+r[t.child]/2;t.sourceX=ol(o,3),t.targetX=ol(l,3),t.gap=i,a.push(t)})),a},ml=(t,e,n,r,a,i=5,o=70)=>{let l=Ji().domain(pt(t.map((t=>Math.abs(t.parent-t.child))))).range([i,o]),s=(Ji().domain(pt(t.map((t=>t.attention)))).range([.1,.6]),Ji().domain(pt(t.map((t=>t.attention)))).range([.2,2]));e.append("g").attr("class","attention-group-arc attention-group-arc-"+n).style("opacity",0).style("display","none").style("pointer-events","none").selectAll("path.attention-arc-"+n).data(t,(t=>`${t.parent}-${t.child}`)).join("path").attr("class","attention-arc attention-arc-"+n).attr("class",(t=>{let e=`attention-arc attention-arc-${a[t.parent].id}-${a[t.child].id}`;return void 0!==r[a[t.parent].token]&&r[a[t.parent].token].forEach((n=>{e+=` attention-arc-${n}-${a[t.child].id}`})),void 0!==r[a[t.child].token]&&r[a[t.child].token].forEach((n=>{e+=` attention-arc-${a[t.parent].id}-${n}`})),e})).classed("attention-arc--lr",(t=>t.parent<=t.child)).classed("attention-arc--rl",(t=>t.parent>t.child)).style("width",(t=>s(t.attention))).style("opacity",.5).attr("d",(t=>{let e=t.sourceX,n=t.targetX,r=Math.abs((n-e)/2),a=l(Math.abs(t.parent-t.child));if(a=Math.min(a,r),t.parent==t.child){let t=5,n=10;return`M ${e} 0\n            C ${e} 0, ${e-t} ${-n}, ${e} ${-n}\n            C ${e+t} ${-n}, ${e} 0, ${e} -1\n            L ${e} 0`}return`M ${e} 0\n            A ${r} ${a}, 0, 0, ${e<n?1:0} ${n}, 0`}))},xl=t=>{let e=Ge(t.target.parentNode.parentNode.parentNode),n=Ke(".attention-group").size(),r=+e.attr("class").replace(/.*name-group-(\d*).*/,"$1");const a=(t,e,n,r)=>{let a=Ge(n[e]);return`translate(${+a.attr("transform").replace(/translate\((.*),\s.*\)/,"$1")}, ${+a.attr("transform").replace(/translate\(.*,\s(.*)\)/,"$1")+r})`};Ge(".blocker").raise(),Ge(".original-node-group").raise(),Ge(".arc-group").raise(),Ge(t.target).classed("symbol-highlight",null==ul[r]),null==ul[r]?(r<Math.floor(n/2)?(Ke(".attention-group").filter((t=>t>=r)).transition("moveY").duration(500).ease(Ea).attr("transform",((t,e,n)=>a(0,e,n,70))),Ke(".name-group").filter((t=>t>=r)).transition("moveY").duration(500).ease(Ea).attr("transform",((t,e,n)=>a(0,e,n,70))),ul[r]="down"):(Ke(".attention-group").filter((t=>t<r)).transition("moveY").duration(500).ease(Ea).attr("transform",((t,e,n)=>a(0,e,n,-70))),Ke(".name-group").filter((t=>t<r)).transition("moveY").duration(500).ease(Ea).attr("transform",((t,e,n)=>a(0,e,n,-70))),ul[r]="up"),e.append("text").attr("class","arc-label name").attr("x",-8).attr("y",-15).style("fill","hsl(0, 0%, 60%)").text("Attention Weights"),Ge(".attention-group-arc-"+r).style("display",null).transition("opacity").delay(200).duration(300).ease(Ea).style("opacity",1)):(Ge(".attention-group-arc-"+r).transition("opacity").duration(500).ease(Ea).style("opacity",0).on("end",((t,n,r)=>{Ge(r[n]).style("display","none"),e.select(".arc-label").remove()})),"down"===ul[r]?(Ke(".attention-group").filter((t=>t>=r)).transition("moveY").duration(500).ease(Ea).attr("transform",((t,e,n)=>a(0,e,n,-70))),Ke(".name-group").filter((t=>t>=r)).transition("moveY").duration(500).ease(Ea).attr("transform",((t,e,n)=>a(0,e,n,-70))),ul[r]=null):"up"===ul[r]?(Ke(".attention-group").filter((t=>t<r)).transition("moveY").duration(500).ease(Ea).attr("transform",((t,e,n)=>a(0,e,n,70))),Ke(".name-group").filter((t=>t<r)).transition("moveY").duration(500).ease(Ea).attr("transform",((t,e,n)=>a(0,e,n,70))),ul[r]=null):console.error("Unknown case!"))},wl=(t,e,n,r,a)=>{const i=t=>{Ge(t.target).classed("disabled")||Ge(t.target).style("fill","hsla(0, 0%, 0%, 0.2)").style("stroke","hsl(28, 7%, 20%)")},o=t=>{Ge(t.target).classed("symbol-highlight")||Ge(t.target).style("fill","white").style("stroke","hsl(28, 7%, 60%)")};let l=t.append("g").attr("class","symbol-group").attr("transform","translate(16, 19)").append("g").attr("class","radial-symbol").attr("transform","translate(0, 0)");l.append("rect").attr("class","comparison-svg-button").attr("width",20).attr("height",20).attr("rx",3).style("fill","white").style("stroke","hsl(28, 7%, 60%)").style("stroke-width",1).on("mouseover",i).on("mouseleave",o).on("click",(t=>((t,e,n,r,a)=>{hl.show||(hl.show=!0,hl.attention=e[r][a],hl.tokens=n,hl.layer=r,hl.head=a,lt.set(hl),Ke(".radial-symbol").select("rect").classed("disabled",!0),Ge(t.target).classed("disabled",!1).classed("symbol-highlight",!0))})(t,e,n,r,a))),l.append("image").attr("href","/dodrio/figures/radial-symbol.svg").attr("x",2).attr("y",2).attr("height",16).attr("width",16).style("pointer-events","none");let s=l.clone(!0).attr("class","arc-symbol").attr("transform","translate(30, 0)");s.select("rect").on("mouseover",i).on("mouseleave",o).on("click",xl),s.select("image").attr("href","/dodrio/figures/arc-symbol.svg")},kl=(t,e,n,r,a,i,o,l,s,c,u,h,d)=>{let f=i.tokens.map((t=>({token:t.token}))),p=r.words.map((t=>({token:t})));if(void 0===i.tokens[0].id){let t={};i.tokens.forEach((e=>{let n=0;void 0===t[e.token]?t[e.token]=n+1:(n=t[e.token],t[e.token]+=1),e.id=`${rl(e.token)}-${n}`}))}null==h&&(h=d(p,i));let g={};p.forEach((t=>{let e=0;void 0===g[t.token]?g[t.token]=e+1:(e=g[t.token],g[t.token]+=1),t.id=`${rl(t.token)}-${e}`}));let y=e.select(".token-group").attr("transform"),v=+y.replace(/translate\((.*),\s.*\)/,"$1"),m=+y.replace(/translate\(.*,\s(.*)\)/,"$1"),x=100;il(e,+e.attr("width")+x);let w=e.append("g").attr("class","comparison-head-name-group").attr("transform",`translate(${n.left},\n      ${n.top+c.top+4})`).style("opacity",0);w.transition("").duration(500).ease(Ea).style("opacity",1);let k=e.select(".token-group").transition("move-x").duration(500).ease(Ea).attr("transform",`translate(${v+x}, ${m})`).on("end",(()=>{k=e.select(".token-group"),k.append("rect").attr("class","blocker").attr("id","top-blocker").attr("x",0).attr("y",0).attr("width",+e.attr("width")).attr("height",M-5).style("fill","url(#top-opacity-gradient)"),e.append("rect").attr("class","blocker").attr("id","top-left-blocker").attr("x",0).attr("y",0).attr("width",x).attr("height",M+5).style("fill","url(#top-opacity-gradient)"),k.append("rect").attr("class","blocker").attr("id","bottom-blocker").attr("x",0).attr("y",o-10).attr("width",+e.attr("width")).attr("height",10).style("fill","url(#bottom-opacity-gradient)"),e.append("rect").attr("class","blocker").attr("id","bottom-left-blocker").attr("x",0).attr("y",o-10).attr("width",x).attr("height",10).style("fill","url(#bottom-opacity-gradient)"),k.select(".node-group").raise(),k.select(".arc-group").raise()})),b=k.select(".node").node().getBBox().height,_=e.select(".node-group").node().getBBox().height,$=e.select(".arc-group").node().getBBox().height,M=+Ge(".graph-view .svg-container").style("top").replace(/(.*)px/,"$1");M+=$+_+n.top+10,Ge(".comparison-panel-container").style("top",M+"px").classed("hide",!1);let A=0,N=fl(t[0].id.layer,t[0].id.head,a,r,i),E=0,j=null;for(;A<t.length;){let d=0,g=0;0===A?E=$+_+50:(d=+e.select("#attention-group-"+(A-1)).attr("transform").replace(/translate\(.*,\s(.*)\)/,"$1"),g=e.select("#attention-group-"+(A-1)).node().getBBox().height,E=d+g+b+10),j=e.select(".token-group").append("g").datum(A).attr("class","attention-group").attr("id","attention-group-"+A).attr("transform",`translate(0, ${E})`).style("visibility","hidden"),ul[A]=null;let y=e.select(".token-group").select(".node-group").classed("original-node-group",!0).clone(!0).classed("original-node-group",!1).classed("node-group-attention",!0);y.selectAll("g.node").classed("node",!1).classed("node-clone",!0).on("mouseover",(t=>{let e=t.target.parentNode.dataset.id;at.set(e)})).on("mouseleave",(()=>{at.set(null)})),y.selectAll("rect").style("stroke","none"),j.append((()=>y.node())),N=fl(t[A].id.layer,t[A].id.head,a,r,i);let v=pl(N,s,c,u);gl(v,j,b,!1,l,h,p);let m=w.append("g").datum(A).attr("class","name-group name-group-"+A).attr("transform",`translate(0, ${E})`).style("visibility","hidden"),x=dl.get([t[A].id.layer,t[A].id.head].toString());m.append("text").attr("class","name").style("fill",x).text(`layer ${t[A].id.layer}\n          head ${t[A].id.head}`),wl(m,a,f,t[A].id.layer,t[A].id.head);let k=E+e.select("#attention-group-"+A).node().getBBox().height,M=yl(t[0].id.layer,t[0].id.head,a,r,i),S=vl(M,s,c,u);if(ml(S,j,A,h,p),k+n.bottom>o){j.remove(),m.remove();break}j.style("visibility","visible"),m.style("visibility","visible"),A+=1}};function bl(e){let n,r,a,i,c,h,v,x,w,k,b,_,$,M,A,N,E,j=e[1].layer+"",S=e[1].head+"";return{c(){n=u("div"),r=u("div"),a=u("div"),i=u("header"),c=u("div"),h=d("Layer "),v=d(j),x=d(" Head "),w=d(S),k=d(" Attention Wights"),_=f(),$=u("button"),M=f(),A=u("section"),A.innerHTML='<svg class="modal-svg"></svg>',g(c,"class","modal-card-title svelte-hancuc"),g(c,"style",b="color: "+e[3](e[1].layer,e[1].head)),g($,"class","delete"),g($,"aria-label","close"),g(i,"class","modal-card-head svelte-hancuc"),g(A,"class","modal-card-body svelte-hancuc"),g(a,"class","modal-card svelte-hancuc"),g(r,"class","modal svelte-hancuc"),m(r,"is-active",e[1].show),g(n,"class","modal-component")},m(t,s){l(t,n,s),o(n,r),o(r,a),o(a,i),o(i,c),o(c,h),o(c,v),o(c,x),o(c,w),o(c,k),o(i,_),o(i,$),o(a,M),o(a,A),e[4](n),N||(E=p($,"click",e[2]),N=!0)},p(t,[e]){2&e&&j!==(j=t[1].layer+"")&&y(v,j),2&e&&S!==(S=t[1].head+"")&&y(w,S),2&e&&b!==(b="color: "+t[3](t[1].layer,t[1].head))&&g(c,"style",b),2&e&&m(r,"is-active",t[1].show)},i:t,o:t,d(t){t&&s(n),e[4](null),N=!1,E()}}}let _l=500;function $l(t,e,n){let r=null,a=null,i=null,o={},l=null,s=new Map;ot.subscribe((t=>{s=t})),lt.set(o),lt.subscribe((t=>{n(1,o=t),null!=o.attention&&c(i)}));const c=t=>{if(void 0!==o.top)Ge(r).select(".modal-card").style("top",o.top+"px").style("left",o.top+"px").style("width",o.width+"px").style("height",o.height+"px");else{let t=+Ge(".dependency-svg").attr("height"),e=window.innerWidth;Ge(r).select(".modal-card").style("top",(t-420)/2+"px").style("left",(e-380)/2+"px")}let e=s.get([o.layer,o.head].toString());a.select("#atlas-arrow").select("path").attr("fill",e).attr("stroke",e);let n=Ge(document.body).append("svg").attr("height",200).attr("width",200).style("visibility","hidden");const i=nl(o.tokens.map((t=>t.token)),n,"0.9em");let l=250-xt(Object.entries(i.textTokenWidths).map((t=>t[1])));n.remove();let c=[];for(let t=0;t<o.tokens.length;t++){let e=-Math.PI/2+t*(2*Math.PI/o.tokens.length);c.push({x:Math.cos(e)*l,y:Math.sin(e)*l,angle:e,token:o.tokens[t].token,id:t})}let u=[];for(let t=0;t<o.tokens.length;t++)for(let e=0;e<o.tokens.length;e++){let n=o.attention[t][e];n>0&&u.push({source:t,target:e,attention:n,id:`${t}-${e}`})}u=u.sort(((t,e)=>e.attention-t.attention)).slice(0,150);let h=Ji().domain(pt(u.map((t=>t.attention)))).range([.2,.7]),d=Ji().domain([0,1]).range([.1,1]),f=t.append("g").attr("class","token-text-group").style("font-size","0.9em").style("cursor","default");f.selectAll("text").data(c,(t=>t.id)).join("text").attr("data-angle",(t=>t.angle)).attr("transform",(t=>`rotate(${180*t.angle/Math.PI})\n          translate(${l}, 0)\n          rotate(${t.angle>=Math.PI/2?180:0})\n        `)).attr("dominant-baseline","middle").attr("x",(t=>t.angle<Math.PI/2?6:-6)).attr("text-anchor",(t=>t.angle<Math.PI/2?"start":"end")).text((t=>t.token));let p=t.select(".token-text-group").clone(!0).remove();n=Ge(document.body).append("svg").attr("viewBox","0 0 500 500").attr("width",480).attr("height",480).style("visibility","hidden"),n.append((()=>p.node()));let g=n.select(".token-text-group").node().getBBox();n.remove();let y=250+g.y,v=_l-y-g.height,m=250+g.x,x=_l-m-g.width,w=Math.min(y,v,m,x);l+=Math.floor(w),c=[];for(let t=0;t<o.tokens.length;t++){let e=-Math.PI/2+t*(2*Math.PI/o.tokens.length);c.push({x:Math.cos(e)*l,y:Math.sin(e)*l,angle:e,token:o.tokens[t].token,id:t})}f.selectAll("rect").data(c,(t=>t.id)).join("rect").attr("transform",(t=>`rotate(${180*t.angle/Math.PI})\n          translate(${l}, 0)\n        `)).attr("x",0).attr("y",-5).attr("width",50).attr("height",15).style("fill","white").style("opacity",0).on("mouseover",((e,n)=>{a.select("#atlas-arrow").select("path").attr("opacity",.1),t.select(".path-group").selectAll("path.donut-link").style("opacity",.5),t.select(".path-group").selectAll("path.donut-link").filter((t=>t.source===n.id||t.target===n.id)).attr("marker-end","url(#atlas-arrow-hover)").style("stroke","hsl(36, 100%, 55%)").style("stroke-width",3).style("opacity",1).raise()})).on("mouseleave",(()=>{a.select("#atlas-arrow").select("path").attr("opacity",null),t.select(".path-group").selectAll("path.donut-link").attr("marker-end","url(#atlas-arrow)").style("stroke",e).style("stroke-width",(t=>h(t.attention))).style("opacity",1)})),f.selectAll("text").data(c,(t=>t.id)).join("text").attr("data-angle",(t=>t.angle)).attr("transform",(t=>`rotate(${180*t.angle/Math.PI})\n          translate(${l}, 0)\n          rotate(${t.angle>=Math.PI/2?180:0})\n        `)).attr("dominant-baseline","middle").attr("x",(t=>t.angle<Math.PI/2?6:-6)).attr("text-anchor",(t=>t.angle<Math.PI/2?"start":"end")).text((t=>t.token)).on("mouseover",((e,n)=>{a.select("#atlas-arrow").select("path").style("opacity",.5),t.select(".path-group").selectAll("path.donut-link").style("opacity",.1),t.select(".path-group").selectAll("path.donut-link").filter((t=>t.source===n.id||t.target===n.id)).attr("marker-end","url(#atlas-arrow-hover)").style("stroke","hsl(24, 95%, 59%)").style("opacity",1).style("stroke-width",3).raise()})).on("mouseleave",(()=>{a.select("#atlas-arrow").select("path").attr("opacity",null),t.select(".path-group").selectAll("path.donut-link").attr("marker-end","url(#atlas-arrow)").style("stroke",e).style("stroke-width",(t=>h(t.attention))).style("opacity",1)})),t.append("g").attr("class","path-group").selectAll("path.donut-link").data(u,(t=>t.id)).join("path").attr("class","donut-link").attr("marker-end","url(#atlas-arrow)").attr("d",(t=>{let e=c[t.source],n=c[t.target];const r=0,a=0,i=.4;let o=r+(e.x-r)*i,l=a+(e.y-r)*i,s=r+(n.x-r)*i,u=a+(n.y-r)*i;return`M ${e.x},${e.y} C${o}, ${l},\n          ${s}, ${u}, ${n.x},${n.y}`})).style("fill","none").style("stroke",e).style("stroke-width",(t=>h(t.attention))).style("opacity",(t=>d(t.attention))),t.append("g").attr("class","token-dot-group").selectAll("circle.token-dot").data(c,(t=>t.id)).join("circle").attr("class","token-dot").attr("cx",(t=>t.x)).attr("cy",(t=>t.y)).attr("r",1)};b((()=>{let t=Ge(r).select(".modal-card");(t=>{let e=0,r=0,a=0,i=0;const l=n=>{e=a-n.clientX,r=i-n.clientY,a=n.clientX,i=n.clientY,t.style.top=t.offsetTop-r+"px",t.style.left=t.offsetLeft-e+"px"},s=()=>{document.onmouseup=null,document.onmousemove=null,n(1,o.top=t.style.top,o),n(1,o.left=t.style.left,o),n(1,o.width=t.style.width,o),n(1,o.height=t.style.height,o)};document.querySelector(".modal-card-head").onmousedown=t=>{a=t.clientX,i=t.clientY,document.onmouseup=s,document.onmousemove=l}})(t.node()),a=t.select("svg.modal-svg").attr("viewBox","0 0 500 500").attr("width","100%").attr("height","100%"),a.append("rect").attr("width",_l).attr("height",_l).style("fill","hsla(0, 0%, 100%, 0)"),i=a.append("g").attr("class","donut").attr("transform","translate(250, 250)"),l=a.append("defs").attr("id","atlas-arrow-def").append("marker").attr("id","atlas-arrow").attr("viewBox",[0,0,10,10]).attr("refX",10).attr("refY",5).attr("markerWidth",12).attr("markerHeight",9).attr("orient","auto").attr("stroke-width",1).attr("markerUnits","userSpaceOnUse").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("stroke","gray").attr("fill","gray"),l=a.append("defs").attr("id","atlas-arrow-def-hover").append("marker").attr("id","atlas-arrow-hover").attr("viewBox",[0,0,10,10]).attr("refX",10).attr("refY",5).attr("markerWidth",12).attr("markerHeight",9).attr("orient","auto").attr("stroke-width",1).attr("markerUnits","userSpaceOnUse").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("stroke","hsl(24, 95%, 59%)").attr("fill","hsl(24, 95%, 59%)")}));return[r,o,()=>{n(1,o.show=!1,o),lt.set(o),a.select(".donut").selectAll("*").remove(),Ke(".radial-symbol").select("rect").classed("disabled",!1).classed("symbol-highlight",!1).style("fill","white").style("stroke","hsl(28, 7%, 60%)")},(t,e)=>null!=s&&void 0!==s.has&&s.has([t,e].toString())?s.get([t,e].toString()):"black",function(t){M[t?"unshift":"push"]((()=>{r=t,n(0,r)}))}]}class Ml extends R{constructor(t){super(),X(this,t,$l,bl,i,{})}}const Al=(t,e,n,r,a,i,o,l,s,c,u)=>{const h=t.list;let d=t.words.map((t=>({token:t})));if(void 0===e.tokens[0].id){let t={};e.tokens.forEach((e=>{let n=0;void 0===t[e.token]?t[e.token]=n+1:(n=t[e.token],t[e.token]+=1),e.id=`${rl(e.token)}-${n}`}))}null==c&&u(d,e);let f={};d.forEach((t=>{let e=0;void 0===f[t.token]?f[t.token]=e+1:(e=f[t.token],f[t.token]+=1),t.id=`${rl(t.token)}-${e}`}));let p=nl(d.map((t=>t.token)),n),g=p.textTokenWidths,y=p.textTokenHeight,v=function(){var t=Li,e=Ti;function n(n){var r,a,i,o,l,s,c,u=Array.from(n),h=u.length,d=new Map;for(a=0;a<h;++a)r=u[a],l=u[a]=new Ei(r),null!=(s=t(r,a,n))&&(s+="")&&(c=l.id=s,d.set(c,d.has(c)?zi:l)),null!=(s=e(r,a,n))&&(s+="")&&(l.parent=s);for(a=0;a<h;++a)if(s=(l=u[a]).parent){if(!(o=d.get(s)))throw new Error("missing: "+s);if(o===zi)throw new Error("ambiguous: "+s);o.children?o.children.push(l):o.children=[l],l.parent=o}else{if(i)throw new Error("multiple roots");i=l}if(!i)throw new Error("no root");if(i.parent=Si,i.eachBefore((function(t){t.depth=t.parent.depth+1,--h})).eachBefore(Ni),i.parent=null,h>0)throw new Error("cycle");return i}return n.id=function(e){return arguments.length?(t=ji(e),n):t},n.parentId=function(t){return arguments.length?(e=ji(t),n):e},n}().id((t=>t.child)).parentId((t=>t.parent))(h),m=Wi().separation(((t,e)=>Math.max(g[t.id],g[e.id]))).size([r-i.left-i.right,a-i.top-i.bottom-2*y])(v),x=n.append("g").attr("class","tree-group").attr("transform",`translate(${i.left}, ${i.top+y})`),w=m.links();for(let t=0;t<w.length;t++)w[t].left=+w[t].target.x>+w[t].source.x,w[t].vertical=Math.abs(+w[t].target.x-+w[t].source.x)<5;x.append("g").attr("class","link-group").selectAll("path").data(w,(t=>`${t.source.id}-${t.target.id}`)).join("path").attr("id",(t=>`link-${t.source.id}-${t.target.id}`)).attr("data-left",(t=>`${t.left} ${t.source.x} ${t.target.x}`)).attr("d",jo().x((t=>t.x)).y((t=>t.y)));let k=x.append("g").attr("class","link-text-group").selectAll("text.text-link").data(w,(t=>`${t.source.id}-${t.target.id}`)).join("text").attr("class","text-link");k.append("textPath").attr("href",(t=>`#link-${t.source.id}-${t.target.id}`)).attr("startOffset","50%").attr("side",(t=>t.left?"left":"right")).style("text-anchor","middle").style("dominant-baseline","end").text((t=>t.target.data.relation)),k.clone(!0).lower().attr("stroke-width",2).attr("stroke","white");let b=x.append("g").attr("class","node-group").selectAll("g").data(v.descendants()).join("g").attr("class",(t=>{let e=d[Number(t.id)],n="node node-"+e.id;return void 0!==c[e.token]&&c[e.token].forEach((t=>{n+=" node-"+t})),n})).attr("transform",(t=>`translate(${t.x}, ${t.y})`)).on("mouseover",(t=>o(d,t))).on("mouseleave",l);b.append("rect").attr("x",(t=>-(g[t.id]+s.left+s.right)/2)).attr("y",-(y+s.top+s.bottom)/2).attr("width",(t=>g[t.id]+s.left+s.right)).attr("height",y+s.top+s.bottom).attr("rx",5).style("fill","hsl(210, 25%, 98%)").style("stroke","hsl(180, 1%, 80%)"),b.append("text").attr("class","text-token").attr("y",1).text((t=>d[t.id].token))};function Nl(t,e,n){const r=t.slice();return r[50]=e[n],r}function El(t,e,n){const r=t.slice();return r[53]=e[n],r[54]=e,r[55]=n,r}function jl(t,e,n){const r=t.slice();return r[50]=e[n],r}function Sl(e){let n,r,a,i=e[50].name+"";return{c(){n=u("option"),r=d(i),n.__value=a=e[50].value,n.value=n.__value},m(t,e){l(t,n,e),o(n,r)},p:t,d(t){t&&s(n)}}}function zl(t){let e,n,a,i,c,h,v,m,x,w,k,b,_,$=t[53][0]+"",M=t[53][1]+"";function A(){t[10].call(n,t[53])}return{c(){e=u("label"),n=u("input"),i=f(),c=d($),h=f(),v=u("span"),m=d("("),x=d(M),w=d(")"),k=f(),g(n,"type","checkbox"),g(n,"data-rel",a=t[53][0]),g(n,"class","svelte-1x9nr6j"),g(v,"class","light-gray svelte-1x9nr6j"),g(e,"class","checkbox check-box-wrapper svelte-1x9nr6j")},m(r,a){l(r,e,a),o(e,n),n.checked=t[1][t[53][0]],o(e,i),o(e,c),o(e,h),o(e,v),o(v,m),o(v,x),o(v,w),o(e,k),b||(_=[p(n,"change",t[8]),p(n,"change",A)],b=!0)},p(e,r){t=e,1&r[0]&&a!==(a=t[53][0])&&g(n,"data-rel",a),3&r[0]&&(n.checked=t[1][t[53][0]]),1&r[0]&&$!==($=t[53][0]+"")&&y(c,$),1&r[0]&&M!==(M=t[53][1]+"")&&y(x,M)},d(t){t&&s(e),b=!1,r(_)}}}function Ll(e){let n,r,a,i=e[50].name+"";return{c(){n=u("option"),r=d(i),n.__value=a=e[50].value,n.value=n.__value},m(t,e){l(t,n,e),o(n,r)},p:t,d(t){t&&s(n)}}}function Tl(t){let e,n,a,i,h,d,y,v,x,w,k,b,_,$,M,A,N,E,j,S,z,L,T,H,q,O,X,R,Y,D,F,U,V,G,Q,K=Object.values(t[4]),Z=[];for(let e=0;e<K.length;e+=1)Z[e]=Sl(jl(t,K,e));let J=t[0],tt=[];for(let e=0;e<J.length;e+=1)tt[e]=zl(El(t,J,e));let et=Object.values(t[5]),nt=[];for(let e=0;e<et.length;e+=1)nt[e]=Ll(Nl(t,et,e));return U=new Ml({}),{c(){e=u("div"),n=u("div"),a=u("div"),i=u("div"),i.textContent="Current Sentence",h=f(),d=u("div"),y=u("div"),y.innerHTML='<div class="comparison-button svelte-1x9nr6j"><div class="icon-wrapper svelte-1x9nr6j"><img src="/dodrio/figures/edit.svg" alt="editing icon" class="svelte-1x9nr6j"/></div></div>',v=f(),x=u("div"),w=u("div"),k=u("select");for(let t=0;t<Z.length;t+=1)Z[t].c();b=f(),_=u("div"),$=u("div"),$.innerHTML='<div class="comparison-button svelte-1x9nr6j">Show Comparison</div>',M=f(),A=u("div"),N=u("div"),N.innerHTML='<div class="relation svelte-1x9nr6j">Syntactic Relations</div>',E=f(),j=u("div"),j.innerHTML='<img src="/dodrio/figures/gradient.png" alt="gradient guide" class="svelte-1x9nr6j"/>',S=f(),z=u("div");for(let t=0;t<tt.length;t+=1)tt[t].c();L=f(),T=u("div"),H=u("div"),q=u("div"),q.textContent="Dependencies predicted by attention heads with top",O=f(),X=u("div"),R=u("select");for(let t=0;t<nt.length;t+=1)nt[t].c();Y=f(),D=u("div"),D.innerHTML='<svg class="dependency-svg"></svg>',F=f(),B(U.$$.fragment),g(i,"class","dependency-label svelte-1x9nr6j"),g(y,"class","relation-container svelte-1x9nr6j"),g(d,"class","select-row select-row--edit svelte-1x9nr6j"),g(k,"name","instance-layout"),g(k,"id","instance-select"),g(k,"class","svelte-1x9nr6j"),g(w,"class","select svelte-1x9nr6j"),g(x,"class","select-row svelte-1x9nr6j"),g($,"class","relation-container svelte-1x9nr6j"),g(_,"class","select-row svelte-1x9nr6j"),m(_,"select-row--highlight",t[2]),g(N,"class","relation-container svelte-1x9nr6j"),g(A,"class","select-row svelte-1x9nr6j"),m(A,"select-row--highlight",t[3]),g(j,"class","gradient-guide svelte-1x9nr6j"),g(z,"class","relation-checkboxes svelte-1x9nr6j"),m(z,"hide",!t[3]),g(a,"class","svg-control-panel svelte-1x9nr6j"),g(n,"class","panel-container svelte-1x9nr6j"),g(q,"class","comparison-label svelte-1x9nr6j"),g(R,"name","head-list"),g(R,"id","head-select"),g(R,"class","svelte-1x9nr6j"),g(X,"class","select comparison-select svelte-1x9nr6j"),g(H,"class","comparison-control-panel svelte-1x9nr6j"),g(T,"class","comparison-panel-container hide svelte-1x9nr6j"),g(D,"class","svg-container svelte-1x9nr6j"),g(e,"class","graph-view svelte-1x9nr6j")},m(r,s){l(r,e,s),o(e,n),o(n,a),o(a,i),o(a,h),o(a,d),o(d,y),o(a,v),o(a,x),o(x,w),o(w,k);for(let t=0;t<Z.length;t+=1)Z[t].m(k,null);o(a,b),o(a,_),o(_,$),o(a,M),o(a,A),o(A,N),o(a,E),o(a,j),o(a,S),o(a,z);for(let t=0;t<tt.length;t+=1)tt[t].m(z,null);o(e,L),o(e,T),o(T,H),o(H,q),o(H,O),o(H,X),o(X,R);for(let t=0;t<nt.length;t+=1)nt[t].m(R,null);o(e,Y),o(e,D),l(r,F,s),I(U,r,s),V=!0,G||(Q=[p(y,"click",t[7]),p($,"click",t[6]),p(N,"click",t[9])],G=!0)},p(t,e){if(16&e[0]){let n;for(K=Object.values(t[4]),n=0;n<K.length;n+=1){const r=jl(t,K,n);Z[n]?Z[n].p(r,e):(Z[n]=Sl(r),Z[n].c(),Z[n].m(k,null))}for(;n<Z.length;n+=1)Z[n].d(1);Z.length=K.length}if(4&e[0]&&m(_,"select-row--highlight",t[2]),8&e[0]&&m(A,"select-row--highlight",t[3]),259&e[0]){let n;for(J=t[0],n=0;n<J.length;n+=1){const r=El(t,J,n);tt[n]?tt[n].p(r,e):(tt[n]=zl(r),tt[n].c(),tt[n].m(z,null))}for(;n<tt.length;n+=1)tt[n].d(1);tt.length=J.length}if(8&e[0]&&m(z,"hide",!t[3]),32&e[0]){let n;for(et=Object.values(t[5]),n=0;n<et.length;n+=1){const r=Nl(t,et,n);nt[n]?nt[n].p(r,e):(nt[n]=Ll(r),nt[n].c(),nt[n].m(R,null))}for(;n<nt.length;n+=1)nt[n].d(1);nt.length=et.length}},i(t){V||(P(U.$$.fragment,t),V=!0)},o(t){C(U.$$.fragment,t),V=!1},d(t){t&&s(e),c(Z,t),c(tt,t),c(nt,t),t&&s(F),W(U,t),G=!1,r(Q)}}}let Hl="hsl(0, 0%, 80%)",ql="hsl(36, 100%, 90%)",Pl="hsl(36, 100%, 80%)",Cl="hsl(36, 100%, 55%)";function Bl(t,e,n){const r=_();let a=null,i=null,o=null,l=null,s=null,c=null,u=null,h=[],d={},f=1562,p={},g=[],y=800,v=800,m=void 0,x=!1,w=!1,k={};et.subscribe((t=>{k=t,v=k.height-41,(k.inComparison&&!w||!k.inComparison&&w)&&W()}));let $=null;st.subscribe((t=>{$=t}));const M={top:10,left:15,right:15,bottom:10},A={top:3,left:3,right:3,bottom:3};let N=null;const E={saliency:{value:"saliency",name:"Saliency View"},dependency:{value:"dependency",name:"Dependency List"},tree:{value:"tree",name:"Dependency Tree"}};let j=!1,S=!1,z=!1,L=E.dependency,T="hsl(42, 95%, 58%)";T="hsl(36, 100%, 55%)";let H=!1;const q=()=>{a=Ge("svg.dependency-svg").attr("width",y).attr("height",v),a.append("rect").attr("class","border-rect").attr("width",y).attr("height",v).style("stroke","black").style("fill","none");let t=a.append("defs");t.append("marker").attr("id","dep-arrow").attr("viewBox",[0,0,10,10]).attr("refX",0).attr("refY",5).attr("markerWidth",10).attr("markerHeight",5).attr("orient","auto").attr("stroke-width",1).attr("markerUnits","userSpaceOnUse").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("stroke",Hl).attr("fill",Hl),t.clone(!0).select("marker").attr("id","dep-arrow-hover").select("path").attr("stroke",T).attr("fill",T),t.clone(!0).select("marker").attr("id","dep-attention-arc-arrow").select("path").attr("stroke","none").attr("refX",2).attr("fill","hsl(0, 0%, 10%)"),t.clone(!0).select("marker").attr("id","dep-attention-arrow").select("path").attr("stroke","none").attr("refX",2).attr("fill","hsl(0, 0%, 80%)");let e=a.append("defs").append("linearGradient").attr("id","top-opacity-gradient").attr("x2","0%").attr("y2","100%");e.append("stop").style("stop-opacity",1).style("stop-color","white").attr("offset","0"),e.append("stop").style("stop-opacity",1).style("stop-color","white").attr("offset","0.9"),e.append("stop").style("stop-opacity",0).style("stop-color","white").attr("offset","1"),e=a.append("defs").append("linearGradient").attr("id","bottom-opacity-gradient").attr("x2","0%").attr("y2","100%"),e.append("stop").style("stop-opacity",0).style("stop-color","white").attr("offset","0"),e.append("stop").style("stop-opacity",1).style("stop-color","white").attr("offset","0.5"),e.append("stop").style("stop-opacity",1).style("stop-color","white").attr("offset","1"),e=a.append("defs").append("linearGradient").attr("id","link-opacity-gradient-rl"),e.append("stop").style("stop-opacity",1).style("stop-color","hsl(0, 0%, 20%)").attr("offset","0"),e.append("stop").style("stop-opacity",1).style("stop-color","hsl(0, 0%, 70%)").attr("offset","0.6"),e.append("stop").style("stop-opacity",1).style("stop-color","hsl(0, 0%, 90%)").attr("offset","1"),e=a.append("defs").append("linearGradient").attr("id","link-opacity-gradient-lr"),e.append("stop").style("stop-opacity",1).style("stop-color","hsl(0, 0%, 90%)").attr("offset","0"),e.append("stop").style("stop-opacity",1).style("stop-color","hsl(0, 0%, 70%)").attr("offset","0.4"),e.append("stop").style("stop-opacity",1).style("stop-color","hsl(0, 0%, 20%)").attr("offset","1"),e=a.append("defs").append("linearGradient").attr("id","matched-link-opacity-gradient-rl"),e.append("stop").style("stop-opacity",1).style("stop-color",ql).attr("offset","0"),e.append("stop").style("stop-opacity",1).style("stop-color",Pl).attr("offset","0.6"),e.append("stop").style("stop-opacity",1).style("stop-color",Cl).attr("offset","1"),e=a.append("defs").append("linearGradient").attr("id","matched-link-opacity-gradient-lr"),e.append("stop").style("stop-opacity",1).style("stop-color",Cl).attr("offset","0"),e.append("stop").style("stop-opacity",1).style("stop-color",Pl).attr("offset","0.4"),e.append("stop").style("stop-opacity",1).style("stop-color",ql).attr("offset","1"),e=a.append("defs").append("linearGradient").attr("id","top-link-opacity-gradient-rl"),e.append("stop").style("stop-opacity",.8).style("stop-color","hsl(0, 0%, 20%)").attr("offset","0"),e.append("stop").style("stop-opacity",.8).style("stop-color","hsl(0, 0%, 70%)").attr("offset","0.3"),e.append("stop").style("stop-opacity",.8).style("stop-color","hsl(0, 0%, 90%)").attr("offset","1"),e=a.append("defs").append("linearGradient").attr("id","top-link-opacity-gradient-lr"),e.append("stop").style("stop-opacity",.8).style("stop-color","hsl(0, 0%, 90%)").attr("offset","0"),e.append("stop").style("stop-opacity",.8).style("stop-color","hsl(0, 0%, 70%)").attr("offset","0.7"),e.append("stop").style("stop-opacity",.8).style("stop-color","hsl(0, 0%, 20%)").attr("offset","1"),x=!0},P=t=>{let e=Ge(t.target).data()[0].id;at.set(e)},C=()=>{at.set(null)},B=(t,e)=>{let n=t[Ge(e.target).data()[0].id].id;at.set(n)},I=(t,e)=>{u={};let n=0;for(;al(e.tokens[n].token);)n+=1;for(let r=0;r<t.length&&!(n>=e.tokens.length);r++){let a=t[r].token;if(a!==e.tokens[n].token){let i=r+1<t.length?t[r+1].token:null;for(u[a]=[];e.tokens[n].token!==i&&(u[a].push(e.tokens[n].id),n+=1,!(n>=e.tokens.length)););}else n+=1}return it.set(u),u},W=()=>{a.attr("height",v);let t=O();var e,r;w?(n(2,w=!1),(t=>{let e=t.select(".token-group").attr("transform"),n=+e.replace(/translate\((.*),\s.*\)/,"$1"),r=+e.replace(/translate\(.*,\s(.*)\)/,"$1");il(t,+t.attr("width")-100),t.selectAll(".blocker").remove(),t.select(".token-group").transition("move-x").duration(500).ease(Ea).attr("transform",`translate(${n-100}, ${r})`),t.select(".comparison-head-name-group").remove(),t.selectAll(".attention-group").remove(),Ge(".comparison-panel-container").classed("hide",!0)})(a)):(n(2,w=!0),null==s?R(`/dodrio/data/sst2-attention-data/attention-${e=f,r=4,Array(Math.max(r-String(e).length+1,0)).join(0)+e}.json`).then((()=>kl(t,a,M,i,s,l,v,o,g,A,p,u,I))):kl(t,a,M,i,s,l,v,o,g,A,p,u,I))},O=()=>{let t=new Map;for(let e in d){if(!d[e]||void 0===c[e])continue;c[e].top_heads.forEach((e=>{t.has(e.head)?t.set(e.head,Math.max(e.acc,t.get(e.head))):t.set(e.head,e.acc)}))}return[...t.entries()].sort(((t,e)=>e[1]-t[1])).map((t=>({id:{layer:t[0][0],head:t[0][1]},acc:t[1]})))},X=async(t,e,r)=>{i=await Ba(t),i=i[f];let a=new Map;n(1,d={}),o=new Set,i.list.forEach((t=>{o.add(String([t.parent,t.child])),a.has(t.relation)?a.set(t.relation,a.get(t.relation)+1):(a.set(t.relation,1),n(1,d[t.relation]=!0,d))})),a=new Map([...a.entries()].sort(((t,e)=>e[1]-t[1]))),n(0,h=[...a.entries()]),l=await Ba(e),l=l[f],c=await Ba(r)},R=async t=>{s=await Ba(t)};b((async()=>{null!=i&&null!=l||X("/dodrio/data/sst2-dependencies.json","/dodrio/data/sst2-saliency-list-grad-l1.json","/dodrio/data/sst2-sorted-syntactic-heads.json"),(()=>{let t=Ge("#instance-select").property("value",L.value);t.on("change",(()=>{let e=t.property("value");if(e!==L.value)switch(e){case"saliency":"dependency"===L.value&&j&&a.select("g.token-group").style("display","none"),"tree"===L.value&&z&&a.select("g.tree-group").style("display","none"),S?(a.select("g.token-group-saliency").style("display",null),a.select("g.legend-group").style("display",null)):(x||q(),ll(l,a,y,M,A,u,P,C),S=!0),L=E[e];break;case"dependency":if(console.log("change to dependency view"),"tree"===L.value&&z&&a.select("g.tree-group").style("display","none"),"saliency"===L.value&&S&&(a.select("g.token-group-saliency").style("display","none"),a.select("g.legend-group").style("display","none")),j)a.select("g.token-group").style("display",null);else{x||q();let t=cl(i,l,u,a,g,A,M,0,P,C,I);g=t.tokenXs,p=t.textTokenWidths,j=!0}L=E[e];break;case"tree":console.log("change to tree view"),"dependency"===L.value&&j&&a.select("g.token-group").style("display","none"),"saliency"===L.value&&S&&(a.select("g.token-group-saliency").style("display","none"),a.select("g.legend-group").style("display","none")),z?a.select("g.tree-group").style("display",null):(x||q(),Al(i,l,a,y,v,M,B,C,A,u,I),z=!0),L=E[e]}}))})()}));const Y=()=>{let t=null;switch(L.value){case"saliency":x||q(),ll(l,a,y,M,A,u,P,C),S=!0;break;case"dependency":x||q(),t=cl(i,l,u,a,g,A,M,0,P,C,I),g=t.tokenXs,p=t.textTokenWidths,O(),j=!0;break;case"tree":x||q(),Al(i,l,a,y,v,M,B,C,A,u,I),z=!0}};K.subscribe((async t=>{void 0!==t.compHeight&&void 0!==t.compWidth&&(void 0===m||m.compHeight!==t.compHeight&&m.compWidth!==t.compWidth)&&(m=t,y=m.compWidth,v=m.compHeight-41,null==i||null==l?X("/dodrio/data/sst2-dependencies.json","/dodrio/data/sst2-saliency-list-grad-l1.json","/dodrio/data/sst2-sorted-syntactic-heads.json").then(Y):Y())})),rt.subscribe((t=>{t!==f&&(a.selectAll("*").remove(),x=!1,s=null,i=null,o=null,l=null,s=null,c=null,u=null,j=!1,S=!1,z=!1,f=t,X("/dodrio/data/sst2-dependencies.json","/dodrio/data/sst2-saliency-list-grad-l1.json","/dodrio/data/sst2-sorted-syntactic-heads.json").then(Y))})),at.subscribe((t=>{null!=a&&(null!=t?(N=t,a.selectAll(".node").filter(((t,e,n)=>Ge(n[e]).attr("class").includes("-"+N))).select("rect").style("stroke",T).style("stroke-width",2),a.selectAll(".arc-path").style("opacity",.8),a.selectAll(".arc-path").filter(((t,e,n)=>Ge(n[e]).attr("class").includes("-"+N))).classed("highlighted",!0).style("opacity",1).raise(),a.selectAll(".node-clone").filter(((t,e,n)=>Ge(n[e]).attr("class").includes("-"+N))).select("rect").style("stroke",T).style("opacity",1).style("stroke-width",2),a.selectAll(".matched-attention-path").classed("de-highlighted",!0),a.selectAll(".attention-path").style("opacity",.2),a.selectAll(".attention-path").filter(((t,e,n)=>Ge(n[e]).attr("class").includes("-"+N))).classed("highlighted",!0).style("opacity",1).raise(),a.selectAll(".attention-arc").style("opacity",.2),a.selectAll(".attention-arc").filter(((t,e,n)=>Ge(n[e]).attr("class").includes("-"+N))).classed("highlighted",!0).style("opacity",.9).raise()):(a.selectAll(".node").filter(((t,e,n)=>Ge(n[e]).attr("class").includes("-"+N))).select("rect").style("stroke","hsl(180, 1%, 80%)").style("stroke-width",1),a.selectAll(".arc-path").style("opacity",null),a.selectAll(".arc-path").filter(((t,e,n)=>Ge(n[e]).attr("class").includes("-"+N))).classed("highlighted",!1),a.selectAll(".node-clone").filter(((t,e,n)=>Ge(n[e]).attr("class").includes("-"+N))).select("rect").style("opacity",null).style("stroke","none"),a.selectAll(".matched-attention-path").classed("de-highlighted",!1),a.selectAll(".attention-path").style("opacity",null),a.selectAll(".attention-path").filter(((t,e,n)=>Ge(n[e]).attr("class").includes("-"+N))).classed("highlighted",!1).raise(),a.selectAll(".attention-arc").style("opacity",.5),a.selectAll(".attention-arc").filter(((t,e,n)=>Ge(n[e]).attr("class").includes("-"+N))).classed("highlighted",!1).raise(),N=t))}));return[h,d,w,H,E,{syntactic:{value:"syntactic",name:"syntactic correlations"},semantic:{value:"semantic",name:"semantic correlations "},importance:{value:"importance",name:"importance scores"}},()=>{r(w?"close":"open")},()=>{$.show=!0,st.set($)},t=>{let e=t.target.dataset.rel;n(1,d[e]=t.target.checked,d)},()=>{n(3,H=!H)},function(t){d[t[0]]=this.checked,n(1,d),n(0,h)}]}class Il extends R{constructor(t){super(),X(this,t,Bl,Tl,i,{},[-1,-1])}}function Wl(e){let n,r,a,i,c,h,y,v,x,w,k,b;return{c(){n=u("div"),r=u("div"),a=f(),i=u("div"),c=u("div"),h=u("div"),y=u("div"),y.innerHTML='<div class="expand-button svelte-1kp0yq1"><div class="icon-wrapper svelte-1kp0yq1"><img src="/dodrio/figures/arrow-forward-outline.svg" alt="expanding icon" class="svelte-1kp0yq1"/></div></div>',v=d("\n\n      Attention Head Overview"),x=f(),w=u("div"),w.innerHTML='<div class="atlas-svg-container svelte-1kp0yq1"><svg class="atlas-svg-full svelte-1kp0yq1"></svg></div> \n\n    <div class="legend-container svelte-1kp0yq1"><div class="svelte-1kp0yq1"><img src="/dodrio/figures/click.png" width="180px" alt="click guide" class="svelte-1kp0yq1"/></div> \n      <div class="bottom-images svelte-1kp0yq1"><img src="/dodrio/figures/size-legend.png" width="160px" alt="size legend" class="svelte-1kp0yq1"/> \n        <img src="/dodrio/figures/legend.png" width="200px" alt="color legend" class="svelte-1kp0yq1"/></div></div>',g(r,"class","triangle svelte-1kp0yq1"),m(r,"hidden",!e[0].show),g(y,"class","relation-container"),g(h,"class","select-row svelte-1kp0yq1"),g(c,"class","lower-atlas-label svelte-1kp0yq1"),g(i,"class","control-row svelte-1kp0yq1"),g(w,"class","svg-container svelte-1kp0yq1"),g(n,"class","atlas-view svelte-1kp0yq1")},m(t,s){l(t,n,s),o(n,r),o(n,a),o(n,i),o(i,c),o(c,h),o(h,y),o(c,v),o(n,x),o(n,w),e[3](n),k||(b=p(y,"click",e[2]),k=!0)},p(t,[e]){1&e&&m(r,"hidden",!t[0].show)},i:t,o:t,d(t){t&&s(n),e[3](null),k=!1,b()}}}function Ol(t,e,n){let r=null,a=null,i=null,o=null,l=null,s=null;tt.subscribe((t=>{s=t}));let c=null,u=null,h={layer:9,head:8},d=9,f=8;const p=tr(23,85,56),g=tr(328,85,56),y=tr(274,85,56);let v=1562;const m=_();let x=800,w=800,k=void 0;const $=40,A=10,N=10,E=3,j=(t,e)=>Math.round((t+Number.EPSILON)*10**e)/10**e,S=(t,e)=>Array(Math.max(e-String(t).length+1,0)).join(0)+t,z=()=>{const t=i.length,e=i[0].length,l=47;let v=x-210-l-A-N,m=w-$-E-20,k=Math.min(m,v);const b=Math.floor((m-8*(t-1))/t),_=b/2;let M=Math.floor((v-_-e*b)/(t-1)),S=Math.floor((m-t*b)/(t-1));r=Ge(".atlas-svg-full").attr("viewbox",`0 0 ${v+l} ${m}`).attr("width",v+l).attr("height",m+20),r.append("rect").attr("class","border-rect").attr("width",k).attr("height",k).style("stroke","black").style("fill","none");let z=r.append("g").attr("class","donut-group").attr("transform",`translate(${A+_+l},\n        ${_+20})`),T={hueScale:Ji().domain([-1,0,1]).range([p,g,y]),lightnessScale:Ji().domain([0,1]).range([130,40]),outRadiusScale:Ji().domain([0,1]).range([10,_]),ringRadiusScale:Ji().domain([0,1]).range([4,7])},H=z.selectAll("g.donut").data(a).join("g").attr("class","donut").attr("transform",(e=>`translate(${e.head*(2*_+M)},\n        ${(t-e.layer-1)*(2*_+S)})`)).style("pointer-events","fill").style("cursor","pointer");H.each(((t,e,n)=>L(t,e,n,T))),H.on("mouseover",((t,e)=>{let n=t.currentTarget.getBoundingClientRect(),r=n.right-n.left,a=n.x+r/2,i=n.y-90;s.html=`\n        <div class='tooltip-tb' style='display: flex; flex-direction: column;\n          justify-content: center; font-weight: 600;'>\n          <div> Layer ${e.layer+1} Head ${e.head+1} </div>\n          <div style='font-size: 12px; opacity: 0.6;'> Semantic: ${j(e.semantic,2)} </div>\n          <div style='font-size: 12px; opacity: 0.6;'> Syntactic ${j(e.syntactic,2)} </div>\n          <div style='font-size: 12px; opacity: 0.6;'> Importance: ${j(e.confidence,2)} </div>\n        </div>\n        `,s.width=130,s.maxWidth=130,s.left=a-s.width/2,s.top=i,s.fontSize="0.8em",s.show=!0,tt.set(s);let o=Ge(t.currentTarget);o.classed("selected")||o.select(".donut-rect").style("opacity",1)})).on("mouseleave",(t=>{s.show=!1,tt.set(s);let e=Ge(t.currentTarget);e.classed("selected")||e.select(".donut-rect").style("opacity",0)})).on("click",((t,e)=>{n(0,c.show=!0,c),n(0,c.attention=i[e.layer][e.head],c),n(0,c.tokens=o.tokens.map((t=>({token:t.token}))),c),n(0,c.layer=e.layer,c),n(0,c.head=e.head,c),ct.set(c)})).on("dblclick",(t=>{let e=Ge(t.currentTarget);if(e.classed("selected"));else{let t=Ge(z.select(`#donut-rect-${d}-${f}`).node().parentNode);t.select(".donut-rect").style("fill","hsl(0, 0%, 80%)").style("opacity",0),t.classed("selected",!1),e.select(".donut-rect").style("fill","hsl(27, 47%, 13%)").style("opacity",1),e.classed("selected",!0),d=+e.data()[0].layer,f=+e.data()[0].head,h.layer=d,h.head=f,ut.set(h)}})),z.selectAll("g.row-line-group").data(Array(t-1).fill(0).map(((t,e)=>e))).join("g").attr("class","row-line-group").append("path").attr("d",(n=>`M${-_}\n        ${(t-n-1-.5)*(2*_+S)}\n        L${e*(2*_+M)-_}\n        ${(t-n-1-.5)*(2*_+S)}`)).style("stroke","hsla(0, 0%, 0%, 0.1)"),r.append("g").attr("class","name-group").attr("transform",`translate(${A}, ${_+20})`).selectAll("g.layer-name-group").data(Array(t).fill(0).map(((t,e)=>e))).join("g").attr("class","layer-name-group").attr("transform",(e=>`translate(37,\n        ${(t-e-1)*(2*_+S)})`)).append("text").text((t=>t>0?t+1:"Layer "+(t+1))),r.append("g").attr("class","name-group").attr("transform",`translate(${A+l+_},\n        9)`).selectAll("g.head-name-group").data(Array(t).fill(0).map(((t,e)=>e))).join("g").attr("class","head-name-group").attr("transform",(t=>`translate(${t*(2*_+M)},\n        0)`)).append("text").text((t=>t>0?t+1:"Head "+(t+1))),Ge(u).select(".head-arrow").style("top","30px").style("left",v-170+"px"),Ge(u).select(".layer-arrow").style("top","70px").style("left",v+10+"px");let q=Ge(z.select(`#donut-rect-${d}-${f}`).node().parentNode);q.select(".donut-rect").style("fill","hsl(27, 47%, 13%)").style("opacity",1),q.classed("selected",!0)},L=(t,e,n,r)=>{let a=Ge(n[e]),o=r.outRadiusScale(t.confidence),s=r.ringRadiusScale(t.confidence),c=Math.max(0,o-s),u=2*r.outRadiusScale.range()[1];a.append("rect").attr("class","donut-rect").attr("id",`donut-rect-${t.layer}-${t.head}`).attr("x",-u/2).attr("y",-u/2).attr("rx",5).attr("width",u).attr("height",u).style("fill","hsl(0, 0%, 80%)").style("opacity",0),a.append("circle").attr("cx",0).attr("cy",0).attr("r",o).style("fill","#FDFCFC").style("opacity",1);let h=bo().outerRadius(o).innerRadius(c).startAngle(0).endAngle(2*Math.PI),d=tr(r.hueScale(t.syntactic-t.semantic));d.l=r.lightnessScale(Math.max(t.semantic,t.syntactic)),a.append("path").attr("class","donut-chart").attr("d",h).style("fill",d);let f=[];for(let e=0;e<l;e++){let n=-Math.PI/2+e*(2*Math.PI/l);f.push({x:Math.cos(n)*c,y:Math.sin(n)*c,token:t.token,id:e})}let p=[];for(let e=0;e<l;e++)for(let n=0;n<l;n++){let r=i[t.layer][t.head][e][n];r>0&&p.push({source:e,target:n,attention:r,id:`${e}-${n}`})}p=p.sort(((t,e)=>e.attention-t.attention)).slice(0,150);let g=Ji().domain(pt(p.map((t=>t.attention)))).range([.2,.7]),y=Ji().domain([0,1]).range([.1,1]);a.selectAll("path.donut-link").data(p,(t=>t.id)).join("path").attr("class","donut-link").attr("d",(t=>{let e=f[t.source],n=f[t.target];const r=0,a=0,i=.4;let o=r+(e.x-r)*i,l=a+(e.y-r)*i,s=r+(n.x-r)*i,c=a+(n.y-r)*i;return`M ${e.x},${e.y} C${o}, ${l},\n          ${s}, ${c}, ${n.x},${n.y}`})).style("fill","none").style("stroke",d).style("stroke-width",(t=>g(t.attention))).style("opacity",(t=>y(t.attention)))},T=async(t,e,n)=>{i=await Ba(t),a=await Ba(n),o=await Ba(e),o=o[v],l=o.tokens.length};return b((async()=>{null!=i&&null!=a&&null!=o||T(`/dodrio/data/sst2-attention-data/attention-${S(v,4)}.json`,"/dodrio/data/sst2-saliency-list-grad-l1.json","/dodrio/data/sst2-atlas.json")})),rt.subscribe((async t=>{t!==v&&(v=t,o=await Ba("/dodrio/data/sst2-saliency-list-grad-l1.json"),o=o[v],l=o.tokens.length,r.select("*").remove(),z())})),ct.subscribe((t=>{n(0,c=t)})),Z.subscribe((async t=>{void 0!==t.compHeight&&void 0!==t.compWidth&&(void 0===k||k.compHeight!==t.compHeight&&k.compWidth!==t.compWidth)&&(k=t,x=k.compWidth,w=k.compHeight,null==i||null==a||null==o?T(`/dodrio/data/sst2-attention-data/attention-${S(v,4)}.json`,"/dodrio/data/sst2-saliency-list-grad-l1.json","/dodrio/data/sst2-atlas.json").then(z):z())})),[c,u,()=>{n(0,c.show=!1,c),ct.set(c),m("close")},function(t){M[t?"unshift":"push"]((()=>{u=t,n(1,u)}))}]}class Xl extends R{constructor(t){super(),X(this,t,Ol,Wl,i,{})}}function Rl(e){let n,r,a,i,c,h,p,v,m,x=e[1].layer+1+"",w=e[1].head+1+"";return{c(){n=u("div"),r=u("div"),a=d("Layer "),i=d(x),c=d(" Head "),h=d(w),v=f(),m=u("div"),m.innerHTML='<svg class="side-svg svelte-18n2a3m"></svg>',g(r,"class","side-title svelte-18n2a3m"),g(r,"style",p="color: "+e[2](e[1].layer,e[1].head)),g(m,"class","svg-container"),g(n,"class","atlas-side svelte-18n2a3m")},m(t,s){l(t,n,s),o(n,r),o(r,a),o(r,i),o(r,c),o(r,h),o(n,v),o(n,m),e[3](n)},p(t,[e]){2&e&&x!==(x=t[1].layer+1+"")&&y(i,x),2&e&&w!==(w=t[1].head+1+"")&&y(h,w),2&e&&p!==(p="color: "+t[2](t[1].layer,t[1].head))&&g(r,"style",p)},i:t,o:t,d(t){t&&s(n),e[3](null)}}}let Yl=500;function Dl(t,e,n){let r=null,a=null,i=null,o=null,l=new Map;ot.subscribe((t=>{l=t}));let s={};ct.subscribe((t=>{n(1,s=t),null!=s.attention&&(i.selectAll("*").remove(),c(i))}));const c=t=>{let e=l.get([s.layer,s.head].toString());a.select("#atlas-side-arrow").select("path").attr("fill",e).attr("stroke",e);let n=Ge(document.body).append("svg").attr("height",200).attr("width",200).style("visibility","hidden");const r=nl(s.tokens.map((t=>t.token)),n,"0.9em");let i=250-xt(Object.entries(r.textTokenWidths).map((t=>t[1])));n.remove();let o=[];for(let t=0;t<s.tokens.length;t++){let e=-Math.PI/2+t*(2*Math.PI/s.tokens.length);o.push({x:Math.cos(e)*i,y:Math.sin(e)*i,angle:e,token:s.tokens[t].token,id:t})}let c=[];for(let t=0;t<s.tokens.length;t++)for(let e=0;e<s.tokens.length;e++){let n=s.attention[t][e];n>0&&c.push({source:t,target:e,attention:n,id:`${t}-${e}`})}c=c.sort(((t,e)=>e.attention-t.attention)).slice(0,150);let u=Ji().domain(pt(c.map((t=>t.attention)))).range([.5,2]),h=Ji().domain([0,1]).range([.1,1]),d=t.append("g").attr("class","token-text-group").style("font-size","0.9em").style("cursor","default");d.selectAll("text").data(o,(t=>t.id)).join("text").attr("data-angle",(t=>t.angle)).attr("transform",(t=>`rotate(${180*t.angle/Math.PI})\n          translate(${i}, 0)\n          rotate(${t.angle>=Math.PI/2?180:0})\n        `)).attr("dominant-baseline","middle").attr("x",(t=>t.angle<Math.PI/2?6:-6)).attr("text-anchor",(t=>t.angle<Math.PI/2?"start":"end")).text((t=>t.token));let f=t.select(".token-text-group").clone(!0).remove();n=Ge(document.body).append("svg").attr("viewBox","0 0 500 500").attr("width",480).attr("height",480).style("visibility","hidden"),n.append((()=>f.node()));let p=n.select(".token-text-group").node().getBBox();n.remove();let g=250+p.y,y=Yl-g-p.height,v=250+p.x,m=Yl-v-p.width,x=Math.min(g,y,v,m);i+=Math.floor(x),o=[];for(let t=0;t<s.tokens.length;t++){let e=-Math.PI/2+t*(2*Math.PI/s.tokens.length);o.push({x:Math.cos(e)*i,y:Math.sin(e)*i,angle:e,token:s.tokens[t].token,id:t})}d.selectAll("rect").data(o,(t=>t.id)).join("rect").attr("transform",(t=>`rotate(${180*t.angle/Math.PI})\n          translate(${i}, 0)\n        `)).attr("x",0).attr("y",-5).attr("width",50).attr("height",15).style("fill","white").style("opacity",0).on("mouseover",((e,n)=>{a.select("#atlas-side-arrow").select("path").attr("opacity",.1),t.select(".path-group").selectAll("path.donut-link").style("opacity",.1),t.select(".path-group").selectAll("path.donut-link").filter((t=>t.source===n.id||t.target===n.id)).attr("marker-end","url(#atlas-side-arrow-hover)").style("stroke","hsl(36, 100%, 55%)").style("stroke-width",3).style("opacity",1).raise()})).on("mouseleave",(()=>{a.select("#atlas-side-arrow").select("path").attr("opacity",null),t.select(".path-group").selectAll("path.donut-link").attr("marker-end","url(#atlas-side-arrow)").style("stroke",e).style("stroke-width",(t=>u(t.attention))).style("opacity",1)})),d.selectAll("text").data(o,(t=>t.id)).join("text").attr("data-angle",(t=>t.angle)).attr("transform",(t=>`rotate(${180*t.angle/Math.PI})\n          translate(${i}, 0)\n          rotate(${t.angle>=Math.PI/2?180:0})\n        `)).attr("dominant-baseline","middle").attr("x",(t=>t.angle<Math.PI/2?6:-6)).attr("text-anchor",(t=>t.angle<Math.PI/2?"start":"end")).text((t=>t.token)).on("mouseover",((e,n)=>{a.select("#atlas-side-arrow").select("path").attr("opacity",.1),t.select(".path-group").selectAll("path.donut-link").style("opacity",.1),t.select(".path-group").selectAll("path.donut-link").filter((t=>t.source===n.id||t.target===n.id)).attr("marker-end","url(#atlas-side-arrow-hover)").style("stroke","hsl(36, 100%, 55%)").style("stroke-width",3).style("opacity",1).raise()})).on("mouseleave",(()=>{a.select("#atlas-side-arrow").select("path").attr("opacity",null),t.select(".path-group").selectAll("path.donut-link").attr("marker-end","url(#atlas-side-arrow)").style("stroke",e).style("stroke-width",(t=>u(t.attention))).style("opacity",1)})),t.append("g").attr("class","path-group").selectAll("path.donut-link").data(c,(t=>t.id)).join("path").attr("class","donut-link").attr("marker-end","url(#atlas-side-arrow)").attr("d",(t=>{let e=o[t.source],n=o[t.target];const r=0,a=0,i=.4;let l=r+(e.x-r)*i,s=a+(e.y-r)*i,c=r+(n.x-r)*i,u=a+(n.y-r)*i;return`M ${e.x},${e.y} C${l}, ${s},\n          ${c}, ${u}, ${n.x},${n.y}`})).style("fill","none").style("stroke",e).style("stroke-width",(t=>u(t.attention))).style("opacity",(t=>h(t.attention))),t.append("g").attr("class","token-dot-group").selectAll("circle.token-dot").data(o,(t=>t.id)).join("circle").attr("class","token-dot").attr("cx",(t=>t.x)).attr("cy",(t=>t.y)).attr("r",1)};b((()=>{let t=Ge(r).select(".svg-container");a=t.select("svg.side-svg").attr("viewBox","0 0 500 500").attr("width","100%").attr("height","100%"),a.append("rect").attr("width",Yl).attr("height",Yl).style("fill","hsla(0, 0%, 100%, 0)"),i=a.append("g").attr("class","donut").attr("transform","translate(250, 250)"),o=a.append("defs").attr("id","atlas-side-arrow-def").append("marker").attr("id","atlas-side-arrow").attr("viewBox",[0,0,10,10]).attr("refX",10).attr("refY",5).attr("markerWidth",12).attr("markerHeight",9).attr("orient","auto").attr("stroke-width",1).attr("markerUnits","userSpaceOnUse").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("stroke","gray").attr("fill","gray"),o=a.append("defs").attr("id","atlas-side-arrow-def-hover").append("marker").attr("id","atlas-side-arrow-hover").attr("viewBox",[0,0,10,10]).attr("refX",10).attr("refY",5).attr("markerWidth",12).attr("markerHeight",9).attr("orient","auto").attr("stroke-width",1).attr("markerUnits","userSpaceOnUse").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("stroke","hsl(24, 95%, 59%)").attr("fill","hsl(24, 95%, 59%)")}));return[r,s,(t,e)=>null!=l&&void 0!==l.has&&l.has([t,e].toString())?l.get([t,e].toString()):"black",function(t){M[t?"unshift":"push"]((()=>{r=t,n(0,r)}))}]}class Fl extends R{constructor(t){super(),X(this,t,Dl,Rl,i,{})}}function Ul(e){let n,r=e[0].html+"";return{c(){n=u("div"),g(n,"class","tooltip svelte-b3tml5"),g(n,"style",e[2])},m(t,a){l(t,n,a),n.innerHTML=r,e[3](n)},p(t,[e]){1&e&&r!==(r=t[0].html+"")&&(n.innerHTML=r),4&e&&g(n,"style",t[2])},i:t,o:t,d(t){t&&s(n),e[3](null)}}}function Vl(t,e,n){let r,a={show:!1,html:"null",left:0,top:0,width:80,maxWidth:80,fontSize:"1em"},i=null;return tt.subscribe((t=>{let e=Ge(i);t.show?(e.style("visibility","visible"),Ge(i).transition().duration(100).ease(Na).style("opacity",1)):Ge(i).transition().delay(100).duration(200).ease(Na).style("opacity",0).on("end",(function(){Ge(this).style("visibility","hidden")})),n(0,a=t)})),b((()=>{Ge(i).style("visibility","hidden"),tt.set(a)})),t.$$.update=()=>{1&t.$$.dirty&&n(2,r=`left: ${a.left}px; top: ${a.top}px;\n    width: ${a.width}px; max-width: ${a.maxWidth}px;\n    font-size: ${a.fontSize}`)},[a,i,r,function(t){M[t?"unshift":"push"]((()=>{i=t,n(1,i)}))}]}class Gl extends R{constructor(t){super(),X(this,t,Vl,Ul,i,{})}}function Ql(e){let n,r,a,i,c,d,y,v,m,x,w,k,b,_;return{c(){n=u("div"),r=u("div"),a=u("div"),a.textContent="Attention Head Overview",i=f(),c=u("div"),d=u("div"),d.innerHTML='<div class="expand-button svelte-1gxmc0v"><div class="icon-wrapper svelte-1gxmc0v"><img src="/dodrio/figures/expand-outline.svg" alt="expanding icon" class="svelte-1gxmc0v"/></div>\n          Show Detail</div>',y=f(),v=u("div"),v.innerHTML='<img src="/dodrio/figures/color-legend.png" alt="expanding icon" class="svelte-1gxmc0v"/>',m=f(),x=u("div"),w=u("div"),k=h("svg"),g(a,"class","lower-atlas-label svelte-1gxmc0v"),g(d,"class","relation-container"),g(c,"class","select-row svelte-1gxmc0v"),g(v,"class","color-legend svelte-1gxmc0v"),g(r,"class","control-row svelte-1gxmc0v"),g(k,"class","atlas-svg"),g(w,"class","atlas-svg-container svelte-1gxmc0v"),g(x,"class","svg-container svelte-1gxmc0v"),g(n,"class","atlas-view svelte-1gxmc0v")},m(t,s){l(t,n,s),o(n,r),o(r,a),o(r,i),o(r,c),o(c,d),o(r,y),o(r,v),o(n,m),o(n,x),o(x,w),o(w,k),e[4](k),e[5](n),b||(_=p(d,"click",e[3]),b=!0)},p:t,i:t,o:t,d(t){t&&s(n),e[4](null),e[5](null),b=!1,_()}}}let Kl=1562;function Zl(t,e,n){let r=null,a=null,i=null,o=null,l=null,s=null;tt.subscribe((t=>{s=t}));let c=null,u={layer:9,head:8},h=9,d=8,f=new Map;const p=tr(23,85,56),g=tr(328,85,56),y=tr(274,85,56),v=_();let m=800,x=800,w=void 0;const k=40,$=10,A=10,N=3,E=(t,e)=>Math.round((t+Number.EPSILON)*10**e)/10**e,j=(t,e)=>Array(Math.max(e-String(t).length+1,0)).join(0)+t,S=()=>{const t=i.length,e=i[0].length;let o=m-35-$-A,l=x-k-N-17,v=Math.min(l,o);const w=Math.floor((l-8*(t-1))/t),b=w/2;let _=Math.floor((o-b-e*w)/(t-1)),M=Math.floor((l-t*w)/(t-1));n(0,r=Ge(r).attr("width",o+35).attr("height",l+17)),r.append("rect").attr("class","border-rect").attr("width",v).attr("height",v).style("stroke","black").style("fill","none");let j=r.append("g").attr("class","donut-group").attr("transform",`translate(${$+b+35},\n        ${b+17})`),S={hueScale:Ji().domain([-1,0,1]).range([p,g,y]),lightnessScale:Ji().domain([0,1]).range([130,40]),outRadiusScale:Ji().domain([0,1]).range([3,b]),ringRadiusScale:Ji().domain([0,1]).range([4,7])},L=j.selectAll("g.donut").data(a).join("g").attr("class","donut").style("cursor","pointer").attr("transform",(e=>`translate(${e.head*(2*b+_)},\n        ${(t-e.layer-1)*(2*b+M)})`));L.each(((t,e,n)=>z(t,e,n,S))),ot.set(f),L.on("mouseover",((t,e)=>{let n=t.currentTarget.getBoundingClientRect(),r=n.right-n.left,a=n.x+r/2,i=n.y-90;s.html=`\n        <div class='tooltip-tb' style='display: flex; flex-direction: column;\n          justify-content: center; font-weight: 800;'>\n          <div> Layer ${e.layer+1} Head ${e.head+1} </div>\n          <div style='font-size: 12px; opacity: 0.6;'> Semantic: ${E(e.semantic,2)} </div>\n          <div style='font-size: 12px; opacity: 0.6;'> Syntactic ${E(e.syntactic,2)} </div>\n          <div style='font-size: 12px; opacity: 0.6;'> Importance: ${E(e.confidence,2)} </div>\n        </div>\n        `,s.width=130,s.maxWidth=130,s.left=a-s.width/2,s.top=i,s.fontSize="0.8em",s.show=!0,tt.set(s);let o=Ge(t.currentTarget);o.classed("selected")||o.select(".donut-rect").style("opacity",1)})).on("mouseleave",(t=>{s.show=!1,tt.set(s);let e=Ge(t.currentTarget);e.classed("selected")||e.select(".donut-rect").style("opacity",0)})).on("click",(t=>{let e=Ge(t.currentTarget);if(e.classed("selected"));else{let t=Ge(j.select(`#donut-rect-${h}-${d}`).node().parentNode);t.select(".donut-rect").style("fill","hsl(0, 0%, 80%)").style("opacity",0),t.classed("selected",!1),e.select(".donut-rect").style("fill","hsl(27, 47%, 13%)").style("opacity",1),e.classed("selected",!0),h=+e.data()[0].layer,d=+e.data()[0].head,u.layer=h,u.head=d,ut.set(u)}})),j.selectAll("g.row-line-group").data(Array(t-1).fill(0).map(((t,e)=>e))).join("g").attr("class","row-line-group").append("path").attr("d",(n=>`M${-b}\n        ${(t-n-1-.5)*(2*b+M)}\n        L${e*(2*b+_)-b}\n        ${(t-n-1-.5)*(2*b+M)}`)).style("stroke","hsla(0, 0%, 0%, 0.1)"),r.append("g").attr("class","name-group").attr("transform",`translate(${$}, ${b+17})`).selectAll("g.layer-name-group").data(Array(t).fill(0).map(((t,e)=>e))).join("g").attr("class","layer-name-group").attr("transform",(e=>`translate(30,\n        ${(t-e-1)*(2*b+M)})`)).append("text").text((t=>t>0?t+1:"Layer "+(t+1))),r.append("g").attr("class","name-group").attr("transform",`translate(${$+35+b},\n        5)`).selectAll("g.head-name-group").data(Array(t).fill(0).map(((t,e)=>e))).join("g").attr("class","head-name-group").attr("transform",(t=>`translate(${t*(2*b+_)},\n        0)`)).append("text").text((t=>t>0?t+1:"Head "+(t+1))),Ge(c).select(".head-arrow").style("top","30px").style("left",o-170+"px"),Ge(c).select(".layer-arrow").style("top","70px").style("left",o+10+"px");let T=Ge(j.select(`#donut-rect-${h}-${d}`).node().parentNode);T.select(".donut-rect").style("fill","hsl(27, 47%, 13%)").style("opacity",1),T.classed("selected",!0)};ut.subscribe((t=>{if(u=t,u.layer!==h||u.head!==d){let t=r.select("g.donut-group"),e=Ge(t.select(`#donut-rect-${h}-${d}`).node().parentNode);e.select(".donut-rect").style("fill","hsl(0, 0%, 80%)").style("opacity",0),e.classed("selected",!1),h=u.layer,d=u.head;let n=Ge(t.select(`#donut-rect-${h}-${d}`).node().parentNode);n.select(".donut-rect").style("fill","hsl(27, 47%, 13%)").style("opacity",1),n.classed("selected",!0)}}));const z=(t,e,n,r)=>{let a=Ge(n[e]),i=r.outRadiusScale(t.confidence),o=r.ringRadiusScale(t.confidence),s=Math.max(0,i-o),c=2*r.outRadiusScale.range()[1];a.append("rect").attr("class","donut-rect").attr("id",`donut-rect-${t.layer}-${t.head}`).attr("x",-c/2).attr("y",-c/2).attr("rx",5).attr("width",c).attr("height",c).style("fill","hsl(0, 0%, 80%)").style("opacity",0);let u=bo().outerRadius(i).innerRadius(0).startAngle(0).endAngle(2*Math.PI),h=tr(r.hueScale(t.syntactic-t.semantic));h.l=r.lightnessScale(Math.max(t.semantic,t.syntactic)),f.set([t.layer,t.head].toString(),h.formatHex()),a.append("path").attr("class","donut-chart").attr("d",u).style("fill",h);let d=[];for(let e=0;e<l;e++){let n=-Math.PI/2+e*(2*Math.PI/l);d.push({x:Math.cos(n)*s,y:Math.sin(n)*s,token:t.token,id:e})}},L=async(t,e,n)=>{i=await Ba(t),a=await Ba(n),o=await Ba(e),o=o[1562],l=o.tokens.length};b((async()=>{null!=i&&null!=a&&null!=o||L(`/dodrio/data/sst2-attention-data/attention-${j(Kl,4)}.json`,"/dodrio/data/sst2-saliency-list-grad-l1.json","/dodrio/data/sst2-atlas.json")})),J.subscribe((async t=>{void 0!==t.compHeight&&void 0!==t.compWidth&&(void 0===w||w.compHeight!==t.compHeight&&w.compWidth!==t.compWidth)&&(w=t,m=w.compWidth,x=w.compHeight,null==i||null==a||null==o?L(`/dodrio/data/sst2-attention-data/attention-${j(Kl,4)}.json`,"/dodrio/data/sst2-saliency-list-grad-l1.json","/dodrio/data/sst2-atlas.json").then(S):S())}));return[r,c,v,()=>v("open"),function(t){M[t?"unshift":"push"]((()=>{r=t,n(0,r)}))},function(t){M[t?"unshift":"push"]((()=>{c=t,n(1,c)}))}]}class Jl extends R{constructor(t){super(),X(this,t,Zl,Ql,i,{})}}function ts(e){let n;return{c(){n=u("div"),g(n,"class","tooltip svelte-1tyk1ci"),g(n,"style",e[2])},m(t,r){l(t,n,r),n.innerHTML=e[0],e[9](n)},p(t,[e]){1&e&&(n.innerHTML=t[0]),4&e&&g(n,"style",t[2])},i:t,o:t,d(t){t&&s(n),e[9](null)}}}function es(t,e,n){let r,{tooltipShow:a=!1}=e,{tooltipHtml:i="1.23"}=e,{left:o=0}=e,{top:l=0}=e,{width:s=80}=e,{maxWidth:c=80}=e,{fontSize:u="1em"}=e,h=null;return t.$$set=t=>{"tooltipShow"in t&&n(3,a=t.tooltipShow),"tooltipHtml"in t&&n(0,i=t.tooltipHtml),"left"in t&&n(4,o=t.left),"top"in t&&n(5,l=t.top),"width"in t&&n(6,s=t.width),"maxWidth"in t&&n(7,c=t.maxWidth),"fontSize"in t&&n(8,u=t.fontSize)},t.$$.update=()=>{496&t.$$.dirty&&n(2,r=`left: ${o}px; top: ${l}px; width: ${s}px; max-width: \n              ${c}px; font-size: ${u}`),10&t.$$.dirty&&function(){if(null===h)return;let t=Ge(h);a?(t.style("visibility","visible"),Ge(h).transition().duration(200).ease(Na).style("opacity",1)):Ge(h).transition().duration(200).ease(Na).style("opacity",0).on("end",(function(){Ge(this).style("visibility","hidden")}))}()},[i,h,r,a,o,l,s,c,u,function(t){M[t?"unshift":"push"]((()=>{h=t,n(1,h)}))}]}class ns extends R{constructor(t){super(),X(this,t,es,ts,i,{tooltipShow:3,tooltipHtml:0,left:4,top:5,width:6,maxWidth:7,fontSize:8})}}function rs(t){let e,n,r,a,i,c,d={left:t[2],top:t[3],tooltipHtml:t[4],width:as,tooltipShow:t[5],fontSize:os,maxWidth:is};return r=new ns({props:d}),t[6](r),{c(){e=u("div"),n=u("div"),B(r.$$.fragment),a=f(),i=h("svg"),g(i,"class","embedding-svg"),g(n,"class","svg-container"),g(e,"class","embedding-view")},m(s,u){l(s,e,u),o(e,n),I(r,n,null),o(n,a),o(n,i),t[7](i),c=!0},p(t,[e]){const n={};4&e&&(n.left=t[2]),8&e&&(n.top=t[3]),16&e&&(n.tooltipHtml=t[4]),32&e&&(n.tooltipShow=t[5]),r.$set(n)},i(t){c||(P(r.$$.fragment,t),c=!0)},o(t){C(r.$$.fragment,t),c=!1},d(n){n&&s(e),t[6](null),W(r),t[7](null)}}}let as=150,is=200,os="0.65em",ls="rgb(100, 149, 237)",ss=.3;function cs(t,e,n){let r=void 0,a=null,i=null,o=23,l=-1,s=null,c=null,u=null,h=0,d=0,f="tooltip",p=!1,g={0:"red",1:"skyblue"},y=["negative","positive"];const v=()=>{const t=function(){var t,e,n,r=Po,a=Co,i=Oo,o=Io,l=Wo,s=[0,1/0],c=[[-1/0,-1/0],[1/0,1/0]],u=250,h=Nr,d=zt("start","zoom","end"),f=500,p=0,g=10;function y(t){t.property("__zoom",Bo).on("wheel.zoom",_).on("mousedown.zoom",$).on("dblclick.zoom",M).filter(l).on("touchstart.zoom",A).on("touchmove.zoom",N).on("touchend.zoom touchcancel.zoom",E).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function v(t,e){return(e=Math.max(s[0],Math.min(s[1],e)))===t.k?t:new Lo(e,t.x,t.y)}function m(t,e,n){var r=e[0]-n[0]*t.k,a=e[1]-n[1]*t.k;return r===t.x&&a===t.y?t:new Lo(t.k,r,a)}function x(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function w(t,e,n,r){t.on("start.zoom",(function(){k(this,arguments).event(r).start()})).on("interrupt.zoom end.zoom",(function(){k(this,arguments).event(r).end()})).tween("zoom",(function(){var t=this,i=arguments,o=k(t,i).event(r),l=a.apply(t,i),s=null==n?x(l):"function"==typeof n?n.apply(t,i):n,c=Math.max(l[1][0]-l[0][0],l[1][1]-l[0][1]),u=t.__zoom,d="function"==typeof e?e.apply(t,i):e,f=h(u.invert(s).concat(c/u.k),d.invert(s).concat(c/d.k));return function(t){if(1===t)t=d;else{var e=f(t),n=c/e[2];t=new Lo(n,s[0]-e[0]*n,s[1]-e[1]*n)}o.zoom(null,t)}}))}function k(t,e,n){return!n&&t.__zooming||new b(t,e)}function b(t,e){this.that=t,this.args=e,this.active=0,this.sourceEvent=null,this.extent=a.apply(t,e),this.taps=0}function _(t,...e){if(r.apply(this,arguments)){var n=k(this,e).event(t),a=this.__zoom,l=Math.max(s[0],Math.min(s[1],a.k*Math.pow(2,o.apply(this,arguments)))),u=Qe(t);if(n.wheel)n.mouse[0][0]===u[0]&&n.mouse[0][1]===u[1]||(n.mouse[1]=a.invert(n.mouse[0]=u)),clearTimeout(n.wheel);else{if(a.k===l)return;n.mouse=[u,a.invert(u)],Qr(this),n.start()}qo(t),n.wheel=setTimeout(h,150),n.zoom("mouse",i(m(v(a,l),n.mouse[0],n.mouse[1]),n.extent,c))}function h(){n.wheel=null,n.end()}}function $(t,...e){if(!n&&r.apply(this,arguments)){var a=k(this,e,!0).event(t),o=Ge(t.view).on("mousemove.zoom",d,!0).on("mouseup.zoom",f,!0),l=Qe(t,s),s=t.currentTarget,u=t.clientX,h=t.clientY;tn(t.view),Ho(t),a.mouse=[l,this.__zoom.invert(l)],Qr(this),a.start()}function d(t){if(qo(t),!a.moved){var e=t.clientX-u,n=t.clientY-h;a.moved=e*e+n*n>p}a.event(t).zoom("mouse",i(m(a.that.__zoom,a.mouse[0]=Qe(t,s),a.mouse[1]),a.extent,c))}function f(t){o.on("mousemove.zoom mouseup.zoom",null),en(t.view,a.moved),qo(t),a.event(t).end()}}function M(t,...e){if(r.apply(this,arguments)){var n=this.__zoom,o=Qe(t.changedTouches?t.changedTouches[0]:t,this),l=n.invert(o),s=n.k*(t.shiftKey?.5:2),h=i(m(v(n,s),o,l),a.apply(this,e),c);qo(t),u>0?Ge(this).transition().duration(u).call(w,h,o,t):Ge(this).call(y.transform,h,o,t)}}function A(n,...a){if(r.apply(this,arguments)){var i,o,l,s,c=n.touches,u=c.length,h=k(this,a,n.changedTouches.length===u).event(n);for(Ho(n),o=0;o<u;++o)s=[s=Qe(l=c[o],this),this.__zoom.invert(s),l.identifier],h.touch0?h.touch1||h.touch0[2]===s[2]||(h.touch1=s,h.taps=0):(h.touch0=s,i=!0,h.taps=1+!!t);t&&(t=clearTimeout(t)),i&&(h.taps<2&&(e=s[0],t=setTimeout((function(){t=null}),f)),Qr(this),h.start())}}function N(t,...e){if(this.__zooming){var n,r,a,o,l=k(this,e).event(t),s=t.changedTouches,u=s.length;for(qo(t),n=0;n<u;++n)a=Qe(r=s[n],this),l.touch0&&l.touch0[2]===r.identifier?l.touch0[0]=a:l.touch1&&l.touch1[2]===r.identifier&&(l.touch1[0]=a);if(r=l.that.__zoom,l.touch1){var h=l.touch0[0],d=l.touch0[1],f=l.touch1[0],p=l.touch1[1],g=(g=f[0]-h[0])*g+(g=f[1]-h[1])*g,y=(y=p[0]-d[0])*y+(y=p[1]-d[1])*y;r=v(r,Math.sqrt(g/y)),a=[(h[0]+f[0])/2,(h[1]+f[1])/2],o=[(d[0]+p[0])/2,(d[1]+p[1])/2]}else{if(!l.touch0)return;a=l.touch0[0],o=l.touch0[1]}l.zoom("touch",i(m(r,a,o),l.extent,c))}}function E(t,...r){if(this.__zooming){var a,i,o=k(this,r).event(t),l=t.changedTouches,s=l.length;for(Ho(t),n&&clearTimeout(n),n=setTimeout((function(){n=null}),f),a=0;a<s;++a)i=l[a],o.touch0&&o.touch0[2]===i.identifier?delete o.touch0:o.touch1&&o.touch1[2]===i.identifier&&delete o.touch1;if(o.touch1&&!o.touch0&&(o.touch0=o.touch1,delete o.touch1),o.touch0)o.touch0[1]=this.__zoom.invert(o.touch0[0]);else if(o.end(),2===o.taps&&(i=Qe(i,this),Math.hypot(e[0]-i[0],e[1]-i[1])<g)){var c=Ge(this).on("dblclick.zoom");c&&c.apply(this,arguments)}}}return y.transform=function(t,e,n,r){var a=t.selection?t.selection():t;a.property("__zoom",Bo),t!==a?w(t,e,n,r):a.interrupt().each((function(){k(this,arguments).event(r).start().zoom(null,"function"==typeof e?e.apply(this,arguments):e).end()}))},y.scaleBy=function(t,e,n,r){y.scaleTo(t,(function(){return this.__zoom.k*("function"==typeof e?e.apply(this,arguments):e)}),n,r)},y.scaleTo=function(t,e,n,r){y.transform(t,(function(){var t=a.apply(this,arguments),r=this.__zoom,o=null==n?x(t):"function"==typeof n?n.apply(this,arguments):n,l=r.invert(o),s="function"==typeof e?e.apply(this,arguments):e;return i(m(v(r,s),o,l),t,c)}),n,r)},y.translateBy=function(t,e,n,r){y.transform(t,(function(){return i(this.__zoom.translate("function"==typeof e?e.apply(this,arguments):e,"function"==typeof n?n.apply(this,arguments):n),a.apply(this,arguments),c)}),null,r)},y.translateTo=function(t,e,n,r,o){y.transform(t,(function(){var t=a.apply(this,arguments),o=this.__zoom,l=null==r?x(t):"function"==typeof r?r.apply(this,arguments):r;return i(To.translate(l[0],l[1]).scale(o.k).translate("function"==typeof e?-e.apply(this,arguments):-e,"function"==typeof n?-n.apply(this,arguments):-n),t,c)}),r,o)},b.prototype={event:function(t){return t&&(this.sourceEvent=t),this},start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,e){return this.mouse&&"mouse"!==t&&(this.mouse[1]=e.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=e.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=e.invert(this.touch1[0])),this.that.__zoom=e,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){var e=Ge(this.that).datum();d.call(t,this.that,new zo(t,{sourceEvent:this.sourceEvent,target:y,type:t,transform:this.that.__zoom,dispatch:d}),e)}},y.wheelDelta=function(t){return arguments.length?(o="function"==typeof t?t:So(+t),y):o},y.filter=function(t){return arguments.length?(r="function"==typeof t?t:So(!!t),y):r},y.touchable=function(t){return arguments.length?(l="function"==typeof t?t:So(!!t),y):l},y.extent=function(t){return arguments.length?(a="function"==typeof t?t:So([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),y):a},y.scaleExtent=function(t){return arguments.length?(s[0]=+t[0],s[1]=+t[1],y):[s[0],s[1]]},y.translateExtent=function(t){return arguments.length?(c[0][0]=+t[0][0],c[1][0]=+t[1][0],c[0][1]=+t[0][1],c[1][1]=+t[1][1],y):[[c[0][0],c[0][1]],[c[1][0],c[1][1]]]},y.constrain=function(t){return arguments.length?(i=t,y):i},y.duration=function(t){return arguments.length?(u=+t,y):u},y.interpolate=function(t){return arguments.length?(h=t,y):h},y.on=function(){var t=d.on.apply(d,arguments);return t===d?y:t},y.clickDistance=function(t){return arguments.length?(p=(t=+t)*t,y):Math.sqrt(p)},y.tapDistance=function(t){return arguments.length?(g=+t,y):g},y}().on("zoom",(t=>{e.select("g").attr("transform",t.transform)})).scaleExtent([.5,10]);let e=Ge(a).attr("width",s).attr("height",c).attr("viewBox",[0,0,s,c]).style("fill","#eee").call(t),r=Ji().domain([Math.min(...i.map((({coords:t})=>t[0]))),Math.max(...i.map((({coords:t})=>t[0])))]).range([0,s]),l=Ji().domain([Math.min(...i.map((({coords:t})=>t[1]))),Math.max(...i.map((({coords:t})=>t[1])))]).range([c,0]);e.append("g").selectAll("dot").data(i).enter().append("circle").attr("id",(function(t){return"circle-"+t.id})).attr("cx",(function(t){return r(t.coords[0])})).attr("cy",(function(t){return l(t.coords[1])})).attr("r",(function(t){return t.id==o?7:5})).style("fill",(function(t){return g[t.label]})).style("opacity",(function(t){return t.id==o?1:ss})).style("stroke",(function(t){return t.id==o?ls:"white"})).style("stroke-width","2px").on("click",m).on("mouseover",(function(t,e){!function(t,e){let r=t.currentTarget.getBoundingClientRect(),a=r.right-r.left,i=r.x+a/2,o=r.y-40+window.scrollY;n(5,p=!0),n(4,f=e.sentence.substring(0,40)+"..."),n(2,h=i-as/2),n(3,d=o)}(t,e),function(t){Ge(a).selectAll("circle").filter((function(){return this.id!="circle-"+o&&this.id!="circle-"+t.id})).style("opacity",.2),t.id!=o&&(Ge(a).select("#circle-"+t.id).attr("r",7).style("opacity",1),Ge(a).select("#circle-"+t.id).raise())}(e)})).on("mouseleave",(function(t,e){n(5,p=!1),function(t){Ge(a).selectAll("circle").filter((function(){return this.id!="circle-"+o&&this.id!="circle-"+t.id})).style("opacity",ss),t.id!=o&&Ge(a).select("#circle-"+t.id).attr("r",5).style("opacity",ss)}(e)})),e.select("#circle-"+o).raise();let u=[...i.map((({label:t})=>t))].filter(((t,e,n)=>n.indexOf(t)===e)),v=12,x=e.selectAll(".legend").data(u).enter().append("g").attr("class","legend").attr("transform",(function(t,e){return"translate(0,"+14*e+")"}));x.append("rect").attr("x",s-100).attr("y",c-v*(u.length+1)).attr("width",v).attr("height",v).style("fill",(function(t){return g[t]})),x.append("text").attr("x",s-95+v).attr("y",c-v*u.length).style("text-anchor","start").style("dominant-baseline","text-after-edge").style("fill","black").style("font-size","0.7em").text((function(t){return t+" ("+y[t]+")"}))};function m(t,e){Ge(a).select("#circle-"+o).attr("r",5).style("opacity",ss).style("stroke","white"),nt.set(e.id),Ge(this).attr("r",7).style("opacity",1).style("stroke",ls).raise()}const x=async()=>{i=await Ba("/dodrio/data/embedding-list-sst2.json"),v()};return G.subscribe((t=>{void 0!==t.compHeight&&void 0!==t.compWidth&&(void 0===r||r.compHeight!==t.compHeight&&r.compWidth!==t.compWidth)&&(r=t,s=r.compWidth,c=r.compHeight,s=300,c=300,x())})),b((()=>{s=350,c=300,x()})),nt.subscribe((t=>{n(10,o=t)})),t.$$.update=()=>{3073&t.$$.dirty&&(Ge(a).select("#circle-"+l).attr("r",5).style("opacity",ss).style("stroke","white"),Ge(a).select("#circle-"+o).attr("r",7).style("opacity",1).style("stroke",ls).raise(),n(11,l=o))},[a,u,h,d,f,p,function(t){M[t?"unshift":"push"]((()=>{u=t,n(1,u)}))},function(t){M[t?"unshift":"push"]((()=>{a=t,n(0,a)}))}]}class us extends R{constructor(t){super(),X(this,t,cs,rs,i,{})}}function hs(t,e,n){const r=t.slice();return r[10]=e[n],r}function ds(t){let e,n,r,i,c,h,m,x,w,k,b,_,$,M,A,N,E,j,S=t[10].id+"",z=t[10].sentence+"",L=t[10].true_label+"",T=t[10].predicted_label+"",H=Number(t[10].logit_distance.toFixed(2))+"";return{c(){e=u("tr"),n=u("td"),r=d(S),i=f(),c=u("td"),h=d(z),m=f(),x=u("td"),w=d(L),k=f(),b=u("td"),_=d(T),$=f(),M=u("td"),A=d(H),N=f(),v(n,"display","none"),g(n,"class","svelte-os3oqa"),g(c,"class","text-row svelte-os3oqa"),g(x,"class","number-row svelte-os3oqa"),g(b,"class","number-row svelte-os3oqa"),g(M,"class","number-row svelte-os3oqa"),g(e,"class","svelte-os3oqa")},m(s,u){l(s,e,u),o(e,n),o(n,r),o(e,i),o(e,c),o(c,h),o(e,m),o(e,x),o(x,w),o(e,k),o(e,b),o(b,_),o(e,$),o(e,M),o(M,A),o(e,N),E||(j=p(e,"click",(function(){a(t[3](this))&&t[3](this).apply(this,arguments)})),E=!0)},p(e,n){t=e,1&n&&S!==(S=t[10].id+"")&&y(r,S),1&n&&z!==(z=t[10].sentence+"")&&y(h,z),1&n&&L!==(L=t[10].true_label+"")&&y(w,L),1&n&&T!==(T=t[10].predicted_label+"")&&y(_,T),1&n&&H!==(H=Number(t[10].logit_distance.toFixed(2))+"")&&y(A,H)},d(t){t&&s(e),E=!1,j()}}}function fs(e){let n,i,h,y,x,w,k,b,_,$,M,A,N,E,j,S,z,L,T,H,q,P,C,B,I,W,O,X,R,Y,D,F,U,V=e[0],G=[];for(let t=0;t<V.length;t+=1)G[t]=ds(hs(e,V,t));return{c(){n=u("div"),i=u("table"),h=u("thead"),y=u("tr"),x=u("th"),x.textContent="id",w=f(),k=u("th"),b=u("div"),_=d("Sentence\n            "),$=u("img"),A=f(),N=u("th"),E=u("div"),j=d("True\n            "),S=u("img"),L=f(),T=u("th"),H=u("div"),q=d("Predicted\n            "),P=u("img"),B=f(),I=u("th"),W=u("div"),O=d("Error\n            "),X=u("img"),Y=f(),D=u("tbody");for(let t=0;t<G.length;t+=1)G[t].c();v(x,"display","none"),g(x,"class","svelte-os3oqa"),$.src!==(M=e[1].sentence.up?"/dodrio/figures/up.svg":"/dodrio/figures/down.svg")&&g($,"src",M),g($,"alt","sort logo"),g($,"class","svelte-os3oqa"),m($,"selected",e[1].sentence.selected),g(b,"class","sentence-div svelte-os3oqa"),g(k,"class","sentence svelte-os3oqa"),S.src!==(z=e[1].true_label.up?"/dodrio/figures/up.svg":"/dodrio/figures/down.svg")&&g(S,"src",z),g(S,"alt","sort logo"),g(S,"class","svelte-os3oqa"),m(S,"selected",e[1].true_label.selected),g(E,"class","true-div svelte-os3oqa"),g(N,"class","true svelte-os3oqa"),P.src!==(C=e[1].predicted_label.up?"/dodrio/figures/up.svg":"/dodrio/figures/down.svg")&&g(P,"src",C),g(P,"alt","sort logo"),g(P,"class","svelte-os3oqa"),m(P,"selected",e[1].predicted_label.selected),g(H,"class","predicted-div svelte-os3oqa"),g(T,"class","predicted svelte-os3oqa"),X.src!==(R=e[1].logit_distance.up?"/dodrio/figures/up.svg":"/dodrio/figures/down.svg")&&g(X,"src",R),g(X,"alt","sort logo"),g(X,"class","svelte-os3oqa"),m(X,"selected",e[1].logit_distance.selected),g(W,"class","error-div svelte-os3oqa"),g(I,"class","error svelte-os3oqa"),g(y,"class","svelte-os3oqa"),g(i,"class","svelte-os3oqa"),g(n,"class","table-view")},m(t,r){l(t,n,r),o(n,i),o(i,h),o(h,y),o(y,x),o(y,w),o(y,k),o(k,b),o(b,_),o(b,$),o(y,A),o(y,N),o(N,E),o(E,j),o(E,S),o(y,L),o(y,T),o(T,H),o(H,q),o(H,P),o(y,B),o(y,I),o(I,W),o(W,O),o(W,X),o(i,Y),o(i,D);for(let t=0;t<G.length;t+=1)G[t].m(D,null);F||(U=[p(x,"click",(function(){a(e[2]("id"))&&e[2]("id").apply(this,arguments)})),p(k,"click",(function(){a(e[2]("sentence"))&&e[2]("sentence").apply(this,arguments)})),p(N,"click",(function(){a(e[2]("true_label"))&&e[2]("true_label").apply(this,arguments)})),p(T,"click",(function(){a(e[2]("predicted_label"))&&e[2]("predicted_label").apply(this,arguments)})),p(I,"click",(function(){a(e[2]("logit_distance"))&&e[2]("logit_distance").apply(this,arguments)}))],F=!0)},p(t,[n]){if(e=t,2&n&&$.src!==(M=e[1].sentence.up?"/dodrio/figures/up.svg":"/dodrio/figures/down.svg")&&g($,"src",M),2&n&&m($,"selected",e[1].sentence.selected),2&n&&S.src!==(z=e[1].true_label.up?"/dodrio/figures/up.svg":"/dodrio/figures/down.svg")&&g(S,"src",z),2&n&&m(S,"selected",e[1].true_label.selected),2&n&&P.src!==(C=e[1].predicted_label.up?"/dodrio/figures/up.svg":"/dodrio/figures/down.svg")&&g(P,"src",C),2&n&&m(P,"selected",e[1].predicted_label.selected),2&n&&X.src!==(R=e[1].logit_distance.up?"/dodrio/figures/up.svg":"/dodrio/figures/down.svg")&&g(X,"src",R),2&n&&m(X,"selected",e[1].logit_distance.selected),9&n){let t;for(V=e[0],t=0;t<V.length;t+=1){const r=hs(e,V,t);G[t]?G[t].p(r,n):(G[t]=ds(r),G[t].c(),G[t].m(D,null))}for(;t<G.length;t+=1)G[t].d(1);G.length=V.length}},i:t,o:t,d(t){t&&s(n),c(G,t),F=!1,r(U)}}}let ps="hsla(0, 0%, 0%, 0.1)";function gs(t,e,n){let r,a,i=void 0,o=[],l=23,s=0,c="true_label",u=!1,h={sentence:{selected:!1,up:!1},true_label:{selected:!1,up:!1},predicted_label:{selected:!1,up:!1},logit_distance:{selected:!1,up:!1}},d={col:"id",ascending:!0};return Q.subscribe((t=>{void 0!==t.compHeight&&void 0!==t.compWidth&&(void 0===i||i.compHeight!==t.compHeight&&i.compWidth!==t.compWidth)&&(i=t)})),nt.subscribe((t=>{n(5,l=t)})),b((async()=>{n(0,o=await Ba("/dodrio/data/table-list-sst2.json"))})),t.$$.update=()=>{611&t.$$.dirty&&n(2,r=t=>{n(7,c=t),d.col==t?(n(9,d.ascending=!d.ascending,d),n(1,h[t].up=d.ascending,h),n(1,h),n(9,d),n(0,o),n(5,l),n(6,s)):(void 0!==h[d.col]&&n(1,h[d.col].selected=!1,h),n(9,d.col=t,d),n(9,d.ascending=!0,d),n(1,h[t].selected=!0,h),n(1,h[t].up=!0,h),n(1,h),n(9,d),n(0,o),n(5,l),n(6,s));let e=d.ascending?1:-1;n(0,o=o.sort(((n,r)=>n[t]<r[t]?-1*e:n[t]>r[t]?1*e:0))),o.forEach((function(t,e){t.id==l&&(o.splice(e,1),o.unshift(t))})),document.getElementsByTagName("table")[0].children[1].children[s].style="background-color: inherit;",document.getElementsByTagName("table")[0].children[1].children[0].style="background-color: "+ps,n(6,s=0),n(8,u=!1)}),64&t.$$.dirty&&n(3,a=t=>{nt.set(t.cells[0].innerText),n(8,u=!1),document.getElementsByTagName("table")[0].children[1].children[s].style="background-color: inherit;",t.style="background-color: "+ps,n(6,s=t.rowIndex-1)}),484&t.$$.dirty&&(document.getElementsByTagName("table")[0]&&document.getElementsByTagName("table")[0].children[1].children[s]&&u&&r(c),n(8,u=!0))},[o,h,r,a]}class ys extends R{constructor(t){super(),X(this,t,gs,fs,i,{})}}function vs(t){let e,n,a,i,c,h,d,y,v,x,w,k,b,_,$,M,A,N,E,j,S,z,L,T,H,q,O;return b=new ys({}),T=new us({}),{c(){e=u("div"),n=u("div"),a=u("div"),i=f(),c=u("div"),h=u("div"),d=u("header"),y=u("p"),y.textContent="Select Input Sentence",v=f(),x=u("button"),w=f(),k=u("section"),B(b.$$.fragment),_=f(),$=u("footer"),M=u("div"),A=u("button"),A.textContent="Cancel",N=f(),E=u("button"),E.textContent="Add",j=f(),S=u("div"),z=u("header"),z.innerHTML='<p class="modal-card-title center svelte-14c981o">Instance Embedding</p>',L=f(),B(T.$$.fragment),g(a,"class","modal-background"),g(y,"class","modal-card-title svelte-14c981o"),g(x,"class","delete"),g(x,"aria-label","close"),g(d,"class","modal-card-head svelte-14c981o"),g(k,"class","modal-card-body svelte-14c981o"),g(A,"class","button is-smaller svelte-14c981o"),g(E,"class","button is-success is-smaller svelte-14c981o"),g(M,"class","button-container"),g($,"class","modal-card-foot svelte-14c981o"),g(h,"class","modal-card svelte-14c981o"),g(z,"class","modal-card-head svelte-14c981o"),g(S,"class","embedding-div svelte-14c981o"),g(c,"class","modal-container svelte-14c981o"),g(n,"class","modal"),g(n,"id","input-modal"),m(n,"is-active",t[1].show),g(e,"class","modal-component")},m(r,s){l(r,e,s),o(e,n),o(n,a),o(n,i),o(n,c),o(c,h),o(h,d),o(d,y),o(d,v),o(d,x),o(h,w),o(h,k),I(b,k,null),o(h,_),o(h,$),o($,M),o(M,A),o(M,N),o(M,E),o(c,j),o(c,S),o(S,z),o(S,L),I(T,S,null),t[4](e),H=!0,q||(O=[p(a,"click",t[2]),p(x,"click",t[2]),p(A,"click",t[2]),p(E,"click",t[3])],q=!0)},p(t,[e]){2&e&&m(n,"is-active",t[1].show)},i(t){H||(P(b.$$.fragment,t),P(T.$$.fragment,t),H=!0)},o(t){C(b.$$.fragment,t),C(T.$$.fragment,t),H=!1},d(n){n&&s(e),W(b),W(T),t[4](null),q=!1,r(O)}}}function ms(t,e,n){let r;const a=_();let i={show:!1},o=null;nt.subscribe((t=>{o=t})),st.set(i),st.subscribe((t=>{n(1,i=t)}));return b((()=>{})),[r,i,()=>{n(1,i.show=!1,i),st.set(i),a("xClicked",{preImage:i.preImage})},()=>{n(1,i.show=!1,i),rt.set(o),a("xClicked",{preImage:i.preImage})},function(t){M[t?"unshift":"push"]((()=>{r=t,n(0,r)}))}]}class xs extends R{constructor(t){super(),X(this,t,ms,vs,i,{})}}function ws(t){let e,n,r,a,i,c,d,y,v,x,w,k,b,_,$,M,A,N,E,j,S,z,L,T,H,q,O,X,R,Y,F,U,V,G;n=new D({});return a=new Gl({props:{}}),t[14](a),w=new Il({}),w.$on("close",t[13]),w.$on("open",t[12]),$=new el({}),N=new Jl({}),N.$on("open",t[9]),S=new Xl({}),S.$on("close",t[10]),T=new Fl({}),q=new xs({}),q.$on("xClicked",ks),q.$on("urlTyped",bs),{c(){e=u("div"),B(n.$$.fragment),r=f(),B(a.$$.fragment),i=f(),c=u("div"),d=u("div"),y=f(),v=u("div"),x=u("div"),B(w.$$.fragment),k=f(),b=u("div"),_=u("div"),B($.$$.fragment),M=f(),A=u("div"),B(N.$$.fragment),E=f(),j=u("div"),B(S.$$.fragment),z=f(),L=u("div"),B(T.$$.fragment),H=f(),B(q.$$.fragment),O=f(),X=u("div"),R=u("div"),Y=h("svg"),F=h("path"),g(d,"class","select-container svelte-o6q0yz"),g(x,"class","instance-container svelte-o6q0yz"),g(_,"class","graph-container svelte-o6q0yz"),g(A,"class","lower-atlas-container svelte-o6q0yz"),g(b,"class","lower-container svelte-o6q0yz"),g(j,"class","atlas-container svelte-o6q0yz"),g(j,"style","visibility=hidden"),g(L,"class","atlas-sidebar svelte-o6q0yz"),m(L,"hidden",!t[3].show),g(v,"class","attention-container svelte-o6q0yz"),g(F,"fill","none"),g(F,"stroke","currentColor"),g(F,"stroke-linecap","round"),g(F,"stroke-linejoin","round"),g(F,"stroke-width","80"),g(F,"d","M112 184l144 144 144-144"),g(Y,"class","icon-down svelte-o6q0yz"),g(Y,"viewBox","0 0 512 512"),m(Y,"up-down",!t[2]),g(R,"class","icon-wrapper svelte-o6q0yz"),g(X,"class","down-button svelte-o6q0yz"),g(c,"class","main-content svelte-o6q0yz"),g(e,"class","main")},m(s,u){l(s,e,u),I(n,e,null),o(e,r),I(a,e,null),o(e,i),o(e,c),o(c,d),o(c,y),o(c,v),o(v,x),I(w,x,null),t[15](x),o(v,k),o(v,b),o(b,_),I($,_,null),t[16](_),o(b,M),o(b,A),I(N,A,null),t[17](A),t[18](b),o(v,E),o(v,j),I(S,j,null),t[19](j),o(v,z),o(v,L),I(T,L,null),o(c,H),I(q,c,null),o(c,O),o(c,X),o(X,R),o(R,Y),o(Y,F),t[20](X),U=!0,V||(G=p(R,"click",t[11]),V=!0)},p(t,[e]){a.$set({}),8&e&&m(L,"hidden",!t[3].show),4&e&&m(Y,"up-down",!t[2])},i(t){U||(P(n.$$.fragment,t),P(a.$$.fragment,t),P(w.$$.fragment,t),P($.$$.fragment,t),P(N.$$.fragment,t),P(S.$$.fragment,t),P(T.$$.fragment,t),P(q.$$.fragment,t),U=!0)},o(t){C(n.$$.fragment,t),C(a.$$.fragment,t),C(w.$$.fragment,t),C($.$$.fragment,t),C(N.$$.fragment,t),C(S.$$.fragment,t),C(T.$$.fragment,t),C(q.$$.fragment,t),U=!1},d(r){r&&s(e),W(n),t[14](null),W(a),W(w),t[15](null),W($),t[16](null),W(N),t[17](null),t[18](null),W(S),t[19](null),W(T),W(q),t[20](null),V=!1,G()}}}const ks=()=>{},bs=()=>{};function _s(t,e,n){let r,a=null,i=null,o=null,l=!0,s=50,c=20;tt.subscribe((t=>{}));let u={};ct.subscribe((t=>{n(3,u=t)}));let h=null,d=null,f={compWidth:null,compHeight:null},p=null,g=null,y={compWidth:null,compHeight:null},v={};et.subscribe((t=>{v=t}));let m=null,x={compWidth:null,compHeight:null},w=null,k={compWidth:null,compHeight:null};const _=()=>{Ge(m).select(".legend-container").style("display","none");let t=Ge(m).select(".atlas-svg-container").style("width","100%").style("height","100%").select(".atlas-svg-full");i=t.attr("width"),o=t.attr("height"),t.attr("width",null).attr("height",null).style("padding-top","36px").style("padding-left","8px").style("width","100%").style("height","100%"),n(7,m.style.width=k.compWidth+"px",m),n(7,m.style.height=k.compHeight+"px",m),n(7,m.style.opacity=0,m);const e=()=>{n(7,m.style.display="none",m),n(7,m.style.visibility="",m),n(7,m.style.width="1000px",m),n(7,m.style.height="100%",m),Ge(m).select(".legend-container").style("display",null),Ge(m).select(".atlas-svg-container").style("width",null).style("height",null).select(".atlas-svg-full").style("padding-top",null).style("padding-left",null).style("width",null).style("height",null).attr("width",i).attr("height",o),m.removeEventListener("transitionend",e)};m.addEventListener("transitionend",e)};return b((()=>{f.compWidth=Math.floor(d.clientWidth),f.compHeight=Math.floor(d.clientHeight),V.set(f),y.compWidth=Math.floor(g.clientWidth),y.compHeight=Math.floor(g.clientHeight)-5,K.set(y),p=Math.floor(g.clientHeight),k.compWidth=Math.floor(w.clientWidth),k.compHeight=Math.floor(w.clientHeight),J.set(k),x.compWidth=Math.floor(m.clientWidth-10),x.compHeight=Math.floor(m.clientHeight-10),Z.set(x),n(7,m.style.opacity="0",m),n(7,m.style.visibility="hidden",m),_(),n(1,r.style.top=Math.floor(g.clientHeight)+50-c/2+"px",r),n(1,r.style.left=f.compWidth-s/2+"px",r),n(1,r.style.width=s+"px",r),n(1,r.style.height=c+"px",r),n(1,r.style.visibility="visible",r)})),[a,r,l,u,h,d,g,m,w,()=>{n(7,m.style.display="",m),n(7,m.style.opacity="1",m)},_,()=>{l?(n(6,g.style.height="100%",g),n(4,h.style.bottom=`-${f.compHeight-10}px`,h),n(1,r.style.top=p+50-c/2+f.compHeight-10+"px",r),v.height=Math.floor(g.clientHeight)-5,v.inComparison=!0,et.set(v)):(n(6,g.style.height="34%",g),n(4,h.style.bottom="0px",h),n(1,r.style.top=p+50-c/2+"px",r),v.height=p-5,v.inComparison=!1,et.set(v)),n(2,l=!l)},()=>{n(6,g.style.height="100%",g),n(4,h.style.bottom=`-${f.compHeight-10}px`,h),n(1,r.style.top=p+50-c/2+f.compHeight-10+"px",r),n(2,l=!1),v.height=Math.floor(g.clientHeight)-5,v.inComparison=!0,et.set(v)},()=>{n(6,g.style.height="34%",g),n(4,h.style.bottom="0px",h),n(1,r.style.top=p+50-c/2+"px",r),n(2,l=!0),v.height=p-5,v.inComparison=!1,et.set(v)},function(t){M[t?"unshift":"push"]((()=>{a=t,n(0,a)}))},function(t){M[t?"unshift":"push"]((()=>{g=t,n(6,g)}))},function(t){M[t?"unshift":"push"]((()=>{d=t,n(5,d)}))},function(t){M[t?"unshift":"push"]((()=>{w=t,n(8,w)}))},function(t){M[t?"unshift":"push"]((()=>{h=t,n(4,h)}))},function(t){M[t?"unshift":"push"]((()=>{m=t,n(7,m)}))},function(t){M[t?"unshift":"push"]((()=>{r=t,n(1,r)}))}]}class $s extends R{constructor(t){super(),X(this,t,_s,ws,i,{})}}function Ms(e){let n,r,a;return r=new $s({}),{c(){n=u("div"),B(r.$$.fragment),g(n,"class","app-page")},m(t,e){l(t,n,e),I(r,n,null),a=!0},p:t,i(t){a||(P(r.$$.fragment,t),a=!0)},o(t){C(r.$$.fragment,t),a=!1},d(t){t&&s(n),W(r)}}}return new class extends R{constructor(t){super(),X(this,t,null,Ms,i,{})}}({target:document.body,props:{}})}();
//# sourceMappingURL=bundle.js.map
